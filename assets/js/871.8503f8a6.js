/*! For license information please see 871.8503f8a6.js.LICENSE.txt */
"use strict";(globalThis.webpackChunkresearch=globalThis.webpackChunkresearch||[]).push([[871],{223:(t,e,n)=>{n.d(e,{Dk:()=>r.Dk,Sx:()=>r.Sx,Wp:()=>r.Wp});var r=n(9943);(0,r.KO)("firebase","12.6.0","app")},722:(t,e,n)=>{n.d(e,{$b:()=>i,Vy:()=>u});const r=[];var i;!function(t){t[t.DEBUG=0]="DEBUG",t[t.VERBOSE=1]="VERBOSE",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.ERROR=4]="ERROR",t[t.SILENT=5]="SILENT"}(i||(i={}));const s={debug:i.DEBUG,verbose:i.VERBOSE,info:i.INFO,warn:i.WARN,error:i.ERROR,silent:i.SILENT},o=i.INFO,a={[i.DEBUG]:"log",[i.VERBOSE]:"log",[i.INFO]:"info",[i.WARN]:"warn",[i.ERROR]:"error"},c=(t,e,...n)=>{if(e<t.logLevel)return;const r=(new Date).toISOString(),i=a[e];if(!i)throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`);console[i](`[${r}]  ${t.name}:`,...n)};class u{constructor(t){this.name=t,this._logLevel=o,this._logHandler=c,this._userLogHandler=null,r.push(this)}get logLevel(){return this._logLevel}set logLevel(t){if(!(t in i))throw new TypeError(`Invalid value "${t}" assigned to \`logLevel\``);this._logLevel=t}setLogLevel(t){this._logLevel="string"==typeof t?s[t]:t}get logHandler(){return this._logHandler}set logHandler(t){if("function"!=typeof t)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t}get userLogHandler(){return this._userLogHandler}set userLogHandler(t){this._userLogHandler=t}debug(...t){this._userLogHandler&&this._userLogHandler(this,i.DEBUG,...t),this._logHandler(this,i.DEBUG,...t)}log(...t){this._userLogHandler&&this._userLogHandler(this,i.VERBOSE,...t),this._logHandler(this,i.VERBOSE,...t)}info(...t){this._userLogHandler&&this._userLogHandler(this,i.INFO,...t),this._logHandler(this,i.INFO,...t)}warn(...t){this._userLogHandler&&this._userLogHandler(this,i.WARN,...t),this._logHandler(this,i.WARN,...t)}error(...t){this._userLogHandler&&this._userLogHandler(this,i.ERROR,...t),this._logHandler(this,i.ERROR,...t)}}},734:(t,e,n)=>{n.d(e,{cY:()=>l,FA:()=>_,g:()=>T,dM:()=>E,u:()=>a,Uj:()=>o,p9:()=>R,bD:()=>S,T9:()=>h,mS:()=>c,Ku:()=>x,ZQ:()=>p,sr:()=>m,zJ:()=>d,zW:()=>v,nr:()=>y,Ov:()=>w,gE:()=>f,eX:()=>b});const r=function(t){const e=[];let n=0;for(let r=0;r<t.length;r++){let i=t.charCodeAt(r);i<128?e[n++]=i:i<2048?(e[n++]=i>>6|192,e[n++]=63&i|128):55296==(64512&i)&&r+1<t.length&&56320==(64512&t.charCodeAt(r+1))?(i=65536+((1023&i)<<10)+(1023&t.charCodeAt(++r)),e[n++]=i>>18|240,e[n++]=i>>12&63|128,e[n++]=i>>6&63|128,e[n++]=63&i|128):(e[n++]=i>>12|224,e[n++]=i>>6&63|128,e[n++]=63&i|128)}return e},i={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let i=0;i<t.length;i+=3){const e=t[i],s=i+1<t.length,o=s?t[i+1]:0,a=i+2<t.length,c=a?t[i+2]:0,u=e>>2,h=(3&e)<<4|o>>4;let l=(15&o)<<2|c>>6,d=63&c;a||(d=64,s||(l=64)),r.push(n[u],n[h],n[l],n[d])}return r.join("")},encodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(t):this.encodeByteArray(r(t),e)},decodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):function(t){const e=[];let n=0,r=0;for(;n<t.length;){const i=t[n++];if(i<128)e[r++]=String.fromCharCode(i);else if(i>191&&i<224){const s=t[n++];e[r++]=String.fromCharCode((31&i)<<6|63&s)}else if(i>239&&i<365){const s=((7&i)<<18|(63&t[n++])<<12|(63&t[n++])<<6|63&t[n++])-65536;e[r++]=String.fromCharCode(55296+(s>>10)),e[r++]=String.fromCharCode(56320+(1023&s))}else{const s=t[n++],o=t[n++];e[r++]=String.fromCharCode((15&i)<<12|(63&s)<<6|63&o)}}return e.join("")}(this.decodeStringToByteArray(t,e))},decodeStringToByteArray(t,e){this.init_();const n=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let i=0;i<t.length;){const e=n[t.charAt(i++)],o=i<t.length?n[t.charAt(i)]:0;++i;const a=i<t.length?n[t.charAt(i)]:64;++i;const c=i<t.length?n[t.charAt(i)]:64;if(++i,null==e||null==o||null==a||null==c)throw new s;const u=e<<2|o>>4;if(r.push(u),64!==a){const t=o<<4&240|a>>2;if(r.push(t),64!==c){const t=a<<6&192|c;r.push(t)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t,t>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}};class s extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const o=function(t){return function(t){const e=r(t);return i.encodeByteArray(e,!0)}(t).replace(/\./g,"")},a=function(t){try{return i.decodeString(t,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function c(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if("undefined"!=typeof globalThis)return globalThis;throw new Error("Unable to locate global object.")}const u=()=>{try{return c().__FIREBASE_DEFAULTS__||(()=>{if("undefined"==typeof process||void 0===process.env)return;const t=process.env.__FIREBASE_DEFAULTS__;return t?JSON.parse(t):void 0})()||(()=>{if("undefined"==typeof document)return;let t;try{t=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(n){return}const e=t&&a(t[1]);return e&&JSON.parse(e)})()}catch(t){return void console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${t}`)}},h=()=>u()?.config;class l{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((t,e)=>{this.resolve=t,this.reject=e})}wrapCallback(t){return(e,n)=>{e?this.reject(e):this.resolve(n),"function"==typeof t&&(this.promise.catch(()=>{}),1===t.length?t(e):t(e,n))}}}function d(t){try{return(t.startsWith("http://")||t.startsWith("https://")?new URL(t).hostname:t).endsWith(".cloudworkstations.dev")}catch{return!1}}async function f(t){return(await fetch(t,{credentials:"include"})).ok}function p(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function g(){const t=u()?.forceEnvironment;if("node"===t)return!0;if("browser"===t)return!1;try{return"[object process]"===Object.prototype.toString.call(globalThis.process)}catch(e){return!1}}function m(){const t="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0;return"object"==typeof t&&void 0!==t.id}function y(){return!g()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function w(){return!g()&&!!navigator.userAgent&&(navigator.userAgent.includes("Safari")||navigator.userAgent.includes("WebKit"))&&!navigator.userAgent.includes("Chrome")}function v(){try{return"object"==typeof indexedDB}catch(t){return!1}}function b(){return new Promise((t,e)=>{try{let n=!0;const r="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(r);i.onsuccess=()=>{i.result.close(),n||self.indexedDB.deleteDatabase(r),t(!0)},i.onupgradeneeded=()=>{n=!1},i.onerror=()=>{e(i.error?.message||"")}}catch(n){e(n)}})}function E(){return!("undefined"==typeof navigator||!navigator.cookieEnabled)}class T extends Error{constructor(t,e,n){super(e),this.code=t,this.customData=n,this.name="FirebaseError",Object.setPrototypeOf(this,T.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,_.prototype.create)}}class _{constructor(t,e,n){this.service=t,this.serviceName=e,this.errors=n}create(t,...e){const n=e[0]||{},r=`${this.service}/${t}`,i=this.errors[t],s=i?function(t,e){return t.replace(I,(t,n)=>{const r=e[n];return null!=r?String(r):`<${n}?>`})}(i,n):"Error",o=`${this.serviceName}: ${s} (${r}).`;return new T(r,o,n)}}const I=/\{\$([^}]+)}/g;function S(t,e){if(t===e)return!0;const n=Object.keys(t),r=Object.keys(e);for(const i of n){if(!r.includes(i))return!1;const n=t[i],s=e[i];if(C(n)&&C(s)){if(!S(n,s))return!1}else if(n!==s)return!1}for(const i of r)if(!n.includes(i))return!1;return!0}function C(t){return null!==t&&"object"==typeof t}const A=1e3,D=2,N=144e5,k=.5;function R(t,e=A,n=D){const r=e*Math.pow(n,t),i=Math.round(k*r*(Math.random()-.5)*2);return Math.min(N,r+i)}function x(t){return t&&t._delegate?t._delegate:t}},1711:(t,e,n)=>{n.d(e,{h1:()=>a,uA:()=>i});var r=n(734);class i{constructor(t,e,n){this.name=t,this.instanceFactory=e,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(t){return this.instantiationMode=t,this}setMultipleInstances(t){return this.multipleInstances=t,this}setServiceProps(t){return this.serviceProps=t,this}setInstanceCreatedCallback(t){return this.onInstanceCreated=t,this}}const s="[DEFAULT]";class o{constructor(t,e){this.name=t,this.container=e,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(t){const e=this.normalizeInstanceIdentifier(t);if(!this.instancesDeferred.has(e)){const t=new r.cY;if(this.instancesDeferred.set(e,t),this.isInitialized(e)||this.shouldAutoInitialize())try{const n=this.getOrInitializeService({instanceIdentifier:e});n&&t.resolve(n)}catch(n){}}return this.instancesDeferred.get(e).promise}getImmediate(t){const e=this.normalizeInstanceIdentifier(t?.identifier),n=t?.optional??!1;if(!this.isInitialized(e)&&!this.shouldAutoInitialize()){if(n)return null;throw Error(`Service ${this.name} is not available`)}try{return this.getOrInitializeService({instanceIdentifier:e})}catch(r){if(n)return null;throw r}}getComponent(){return this.component}setComponent(t){if(t.name!==this.name)throw Error(`Mismatching Component ${t.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=t,this.shouldAutoInitialize()){if(function(t){return"EAGER"===t.instantiationMode}(t))try{this.getOrInitializeService({instanceIdentifier:s})}catch(e){}for(const[t,n]of this.instancesDeferred.entries()){const r=this.normalizeInstanceIdentifier(t);try{const t=this.getOrInitializeService({instanceIdentifier:r});n.resolve(t)}catch(e){}}}}clearInstance(t=s){this.instancesDeferred.delete(t),this.instancesOptions.delete(t),this.instances.delete(t)}async delete(){const t=Array.from(this.instances.values());await Promise.all([...t.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...t.filter(t=>"_delete"in t).map(t=>t._delete())])}isComponentSet(){return null!=this.component}isInitialized(t=s){return this.instances.has(t)}getOptions(t=s){return this.instancesOptions.get(t)||{}}initialize(t={}){const{options:e={}}=t,n=this.normalizeInstanceIdentifier(t.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const r=this.getOrInitializeService({instanceIdentifier:n,options:e});for(const[i,s]of this.instancesDeferred.entries()){n===this.normalizeInstanceIdentifier(i)&&s.resolve(r)}return r}onInit(t,e){const n=this.normalizeInstanceIdentifier(e),r=this.onInitCallbacks.get(n)??new Set;r.add(t),this.onInitCallbacks.set(n,r);const i=this.instances.get(n);return i&&t(i,n),()=>{r.delete(t)}}invokeOnInitCallbacks(t,e){const n=this.onInitCallbacks.get(e);if(n)for(const r of n)try{r(t,e)}catch{}}getOrInitializeService({instanceIdentifier:t,options:e={}}){let n=this.instances.get(t);if(!n&&this.component&&(n=this.component.instanceFactory(this.container,{instanceIdentifier:(r=t,r===s?void 0:r),options:e}),this.instances.set(t,n),this.instancesOptions.set(t,e),this.invokeOnInitCallbacks(n,t),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,t,n)}catch{}var r;return n||null}normalizeInstanceIdentifier(t=s){return this.component?this.component.multipleInstances?t:s:t}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class a{constructor(t){this.name=t,this.providers=new Map}addComponent(t){const e=this.getProvider(t.name);if(e.isComponentSet())throw new Error(`Component ${t.name} has already been registered with ${this.name}`);e.setComponent(t)}addOrOverwriteComponent(t){this.getProvider(t.name).isComponentSet()&&this.providers.delete(t.name),this.addComponent(t)}getProvider(t){if(this.providers.has(t))return this.providers.get(t);const e=new o(t,this);return this.providers.set(t,e),e}getProviders(){return Array.from(this.providers.values())}}},4297:(t,e,n)=>{n.d(e,{P2:()=>m});const r=(t,e)=>e.some(e=>t instanceof e);let i,s;const o=new WeakMap,a=new WeakMap,c=new WeakMap,u=new WeakMap,h=new WeakMap;let l={get(t,e,n){if(t instanceof IDBTransaction){if("done"===e)return a.get(t);if("objectStoreNames"===e)return t.objectStoreNames||c.get(t);if("store"===e)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return p(t[e])},set:(t,e,n)=>(t[e]=n,!0),has:(t,e)=>t instanceof IDBTransaction&&("done"===e||"store"===e)||e in t};function d(t){return t!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(s||(s=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(t)?function(...e){return t.apply(g(this),e),p(o.get(this))}:function(...e){return p(t.apply(g(this),e))}:function(e,...n){const r=t.call(g(this),e,...n);return c.set(r,e.sort?e.sort():[e]),p(r)}}function f(t){return"function"==typeof t?d(t):(t instanceof IDBTransaction&&function(t){if(a.has(t))return;const e=new Promise((e,n)=>{const r=()=>{t.removeEventListener("complete",i),t.removeEventListener("error",s),t.removeEventListener("abort",s)},i=()=>{e(),r()},s=()=>{n(t.error||new DOMException("AbortError","AbortError")),r()};t.addEventListener("complete",i),t.addEventListener("error",s),t.addEventListener("abort",s)});a.set(t,e)}(t),r(t,i||(i=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction]))?new Proxy(t,l):t)}function p(t){if(t instanceof IDBRequest)return function(t){const e=new Promise((e,n)=>{const r=()=>{t.removeEventListener("success",i),t.removeEventListener("error",s)},i=()=>{e(p(t.result)),r()},s=()=>{n(t.error),r()};t.addEventListener("success",i),t.addEventListener("error",s)});return e.then(e=>{e instanceof IDBCursor&&o.set(e,t)}).catch(()=>{}),h.set(e,t),e}(t);if(u.has(t))return u.get(t);const e=f(t);return e!==t&&(u.set(t,e),h.set(e,t)),e}const g=t=>h.get(t);function m(t,e,{blocked:n,upgrade:r,blocking:i,terminated:s}={}){const o=indexedDB.open(t,e),a=p(o);return r&&o.addEventListener("upgradeneeded",t=>{r(p(o.result),t.oldVersion,t.newVersion,p(o.transaction),t)}),n&&o.addEventListener("blocked",t=>n(t.oldVersion,t.newVersion,t)),a.then(t=>{s&&t.addEventListener("close",()=>s()),i&&t.addEventListener("versionchange",t=>i(t.oldVersion,t.newVersion,t))}).catch(()=>{}),a}const y=["get","getKey","getAll","getAllKeys","count"],w=["put","add","delete","clear"],v=new Map;function b(t,e){if(!(t instanceof IDBDatabase)||e in t||"string"!=typeof e)return;if(v.get(e))return v.get(e);const n=e.replace(/FromIndex$/,""),r=e!==n,i=w.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!i&&!y.includes(n))return;const s=async function(t,...e){const s=this.transaction(t,i?"readwrite":"readonly");let o=s.store;return r&&(o=o.index(e.shift())),(await Promise.all([o[n](...e),i&&s.done]))[0]};return v.set(e,s),s}l=(t=>({...t,get:(e,n,r)=>b(e,n)||t.get(e,n,r),has:(e,n)=>!!b(e,n)||t.has(e,n)}))(l)},7673:(t,e,n)=>{n.d(e,{P5:()=>At});var r=n(9943),i=n(722),s=n(734),o=n(1711),a=n(4297);const c="@firebase/installations",u="0.6.19",h=1e4,l=`w:${u}`,d="FIS_v2",f=36e5,p={"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"not-registered":"Firebase Installation is not registered.","installation-not-found":"Firebase Installation not found.","request-failed":'{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',"app-offline":"Could not process request. Application offline.","delete-pending-registration":"Can't delete installation while there is a pending registration request."},g=new s.FA("installations","Installations",p);function m(t){return t instanceof s.g&&t.code.includes("request-failed")}function y({projectId:t}){return`https://firebaseinstallations.googleapis.com/v1/projects/${t}/installations`}function w(t){return{token:t.token,requestStatus:2,expiresIn:(e=t.expiresIn,Number(e.replace("s","000"))),creationTime:Date.now()};var e}async function v(t,e){const n=(await e.json()).error;return g.create("request-failed",{requestName:t,serverCode:n.code,serverMessage:n.message,serverStatus:n.status})}function b({apiKey:t}){return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":t})}function E(t,{refreshToken:e}){const n=b(t);return n.append("Authorization",function(t){return`${d} ${t}`}(e)),n}async function T(t){const e=await t();return e.status>=500&&e.status<600?t():e}function _(t){return new Promise(e=>{setTimeout(e,t)})}const I=/^[cdef][\w-]{21}$/;function S(){try{const t=new Uint8Array(17);(self.crypto||self.msCrypto).getRandomValues(t),t[0]=112+t[0]%16;const e=function(t){const e=(n=t,btoa(String.fromCharCode(...n)).replace(/\+/g,"-").replace(/\//g,"_"));var n;return e.substr(0,22)}(t);return I.test(e)?e:""}catch{return""}}function C(t){return`${t.appName}!${t.appId}`}const A=new Map;function D(t,e){const n=C(t);N(n,e),function(t,e){const n=R();n&&n.postMessage({key:t,fid:e});x()}(n,e)}function N(t,e){const n=A.get(t);if(n)for(const r of n)r(e)}let k=null;function R(){return!k&&"BroadcastChannel"in self&&(k=new BroadcastChannel("[Firebase] FID Change"),k.onmessage=t=>{N(t.data.key,t.data.fid)}),k}function x(){0===A.size&&k&&(k.close(),k=null)}const O="firebase-installations-store";let M=null;function L(){return M||(M=(0,a.P2)("firebase-installations-database",1,{upgrade:(t,e)=>{if(0===e)t.createObjectStore(O)}})),M}async function P(t,e){const n=C(t),r=(await L()).transaction(O,"readwrite"),i=r.objectStore(O),s=await i.get(n);return await i.put(e,n),await r.done,s&&s.fid===e.fid||D(t,e.fid),e}async function V(t){const e=C(t),n=(await L()).transaction(O,"readwrite");await n.objectStore(O).delete(e),await n.done}async function F(t,e){const n=C(t),r=(await L()).transaction(O,"readwrite"),i=r.objectStore(O),s=await i.get(n),o=e(s);return void 0===o?await i.delete(n):await i.put(o,n),await r.done,!o||s&&s.fid===o.fid||D(t,o.fid),o}async function U(t){let e;const n=await F(t.appConfig,n=>{const r=function(t){const e=t||{fid:S(),registrationStatus:0};return q(e)}(n),i=function(t,e){if(0===e.registrationStatus){if(!navigator.onLine){return{installationEntry:e,registrationPromise:Promise.reject(g.create("app-offline"))}}const n={fid:e.fid,registrationStatus:1,registrationTime:Date.now()},r=async function(t,e){try{const n=await async function({appConfig:t,heartbeatServiceProvider:e},{fid:n}){const r=y(t),i=b(t),s=e.getImmediate({optional:!0});if(s){const t=await s.getHeartbeatsHeader();t&&i.append("x-firebase-client",t)}const o={fid:n,authVersion:d,appId:t.appId,sdkVersion:l},a={method:"POST",headers:i,body:JSON.stringify(o)},c=await T(()=>fetch(r,a));if(c.ok){const t=await c.json();return{fid:t.fid||n,registrationStatus:2,refreshToken:t.refreshToken,authToken:w(t.authToken)}}throw await v("Create Installation",c)}(t,e);return P(t.appConfig,n)}catch(n){throw m(n)&&409===n.customData.serverCode?await V(t.appConfig):await P(t.appConfig,{fid:e.fid,registrationStatus:0}),n}}(t,n);return{installationEntry:n,registrationPromise:r}}return 1===e.registrationStatus?{installationEntry:e,registrationPromise:j(t)}:{installationEntry:e}}(t,r);return e=i.registrationPromise,i.installationEntry});return""===n.fid?{installationEntry:await e}:{installationEntry:n,registrationPromise:e}}async function j(t){let e=await B(t.appConfig);for(;1===e.registrationStatus;)await _(100),e=await B(t.appConfig);if(0===e.registrationStatus){const{installationEntry:e,registrationPromise:n}=await U(t);return n||e}return e}function B(t){return F(t,t=>{if(!t)throw g.create("installation-not-found");return q(t)})}function q(t){return 1===(e=t).registrationStatus&&e.registrationTime+h<Date.now()?{fid:t.fid,registrationStatus:0}:t;var e}async function $({appConfig:t,heartbeatServiceProvider:e},n){const r=function(t,{fid:e}){return`${y(t)}/${e}/authTokens:generate`}(t,n),i=E(t,n),s=e.getImmediate({optional:!0});if(s){const t=await s.getHeartbeatsHeader();t&&i.append("x-firebase-client",t)}const o={installation:{sdkVersion:l,appId:t.appId}},a={method:"POST",headers:i,body:JSON.stringify(o)},c=await T(()=>fetch(r,a));if(c.ok){return w(await c.json())}throw await v("Generate Auth Token",c)}async function z(t,e=!1){let n;const r=await F(t.appConfig,r=>{if(!G(r))throw g.create("not-registered");const i=r.authToken;if(!e&&function(t){return 2===t.requestStatus&&!function(t){const e=Date.now();return e<t.creationTime||t.creationTime+t.expiresIn<e+f}(t)}(i))return r;if(1===i.requestStatus)return n=async function(t,e){let n=await K(t.appConfig);for(;1===n.authToken.requestStatus;)await _(100),n=await K(t.appConfig);const r=n.authToken;return 0===r.requestStatus?z(t,e):r}(t,e),r;{if(!navigator.onLine)throw g.create("app-offline");const e=function(t){const e={requestStatus:1,requestTime:Date.now()};return{...t,authToken:e}}(r);return n=async function(t,e){try{const n=await $(t,e),r={...e,authToken:n};return await P(t.appConfig,r),n}catch(n){if(!m(n)||401!==n.customData.serverCode&&404!==n.customData.serverCode){const n={...e,authToken:{requestStatus:0}};await P(t.appConfig,n)}else await V(t.appConfig);throw n}}(t,e),e}});return n?await n:r.authToken}function K(t){return F(t,t=>{if(!G(t))throw g.create("not-registered");const e=t.authToken;return 1===(n=e).requestStatus&&n.requestTime+h<Date.now()?{...t,authToken:{requestStatus:0}}:t;var n})}function G(t){return void 0!==t&&2===t.registrationStatus}async function H(t,e=!1){const n=t;await async function(t){const{registrationPromise:e}=await U(t);e&&await e}(n);return(await z(n,e)).token}function Q(t){return g.create("missing-app-config-values",{valueName:t})}const W="installations",X=t=>{const e=t.getProvider("app").getImmediate(),n=function(t){if(!t||!t.options)throw Q("App Configuration");if(!t.name)throw Q("App Name");const e=["projectId","apiKey","appId"];for(const n of e)if(!t.options[n])throw Q(n);return{appName:t.name,projectId:t.options.projectId,apiKey:t.options.apiKey,appId:t.options.appId}}(e);return{app:e,appConfig:n,heartbeatServiceProvider:(0,r.j6)(e,"heartbeat"),_delete:()=>Promise.resolve()}},Y=t=>{const e=t.getProvider("app").getImmediate(),n=(0,r.j6)(e,W).getImmediate();return{getId:()=>async function(t){const e=t,{installationEntry:n,registrationPromise:r}=await U(e);return r?r.catch(console.error):z(e).catch(console.error),n.fid}(n),getToken:t=>H(n,t)}};(0,r.om)(new o.uA(W,X,"PUBLIC")),(0,r.om)(new o.uA("installations-internal",Y,"PRIVATE")),(0,r.KO)(c,u),(0,r.KO)(c,u,"esm2020");const J="analytics",Z="https://www.googletagmanager.com/gtag/js",tt=new i.Vy("@firebase/analytics"),et={"already-exists":"A Firebase Analytics instance with the appId {$id}  already exists. Only one Firebase Analytics instance can be created for each appId.","already-initialized":"initializeAnalytics() cannot be called again with different options than those it was initially called with. It can be called again with the same options to return the existing instance, or getAnalytics() can be used to get a reference to the already-initialized instance.","already-initialized-settings":"Firebase Analytics has already been initialized.settings() must be called before initializing any Analytics instanceor it will have no effect.","interop-component-reg-failed":"Firebase Analytics Interop Component failed to instantiate: {$reason}","invalid-analytics-context":"Firebase Analytics is not supported in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","indexeddb-unavailable":"IndexedDB unavailable or restricted in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","fetch-throttle":"The config fetch request timed out while in an exponential backoff state. Unix timestamp in milliseconds when fetch request throttling ends: {$throttleEndTimeMillis}.","config-fetch-failed":"Dynamic config fetch failed: [{$httpStatus}] {$responseMessage}","no-api-key":'The "apiKey" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid API key.',"no-app-id":'The "appId" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid app ID.',"no-client-id":'The "client_id" field is empty.',"invalid-gtag-resource":"Trusted Types detected an invalid gtag resource: {$gtagURL}."},nt=new s.FA("analytics","Analytics",et);function rt(t){if(!t.startsWith(Z)){const e=nt.create("invalid-gtag-resource",{gtagURL:t});return tt.warn(e.message),""}return t}function it(t){return Promise.all(t.map(t=>t.catch(t=>t)))}function st(t,e){const n=function(t,e){let n;return window.trustedTypes&&(n=window.trustedTypes.createPolicy(t,e)),n}("firebase-js-sdk-policy",{createScriptURL:rt}),r=document.createElement("script"),i=`${Z}?l=${t}&id=${e}`;r.src=n?n?.createScriptURL(i):i,r.async=!0,document.head.appendChild(r)}function ot(t,e,n,r){return async function(i,...s){try{if("event"===i){const[r,i]=s;await async function(t,e,n,r,i){try{let s=[];if(i&&i.send_to){let t=i.send_to;Array.isArray(t)||(t=[t]);const r=await it(n);for(const n of t){const t=r.find(t=>t.measurementId===n),i=t&&e[t.appId];if(!i){s=[];break}s.push(i)}}0===s.length&&(s=Object.values(e)),await Promise.all(s),t("event",r,i||{})}catch(s){tt.error(s)}}(t,e,n,r,i)}else if("config"===i){const[i,o]=s;await async function(t,e,n,r,i,s){const o=r[i];try{if(o)await e[o];else{const t=(await it(n)).find(t=>t.measurementId===i);t&&await e[t.appId]}}catch(a){tt.error(a)}t("config",i,s)}(t,e,n,r,i,o)}else if("consent"===i){const[e,n]=s;t("consent",e,n)}else if("get"===i){const[e,n,r]=s;t("get",e,n,r)}else if("set"===i){const[e]=s;t("set",e)}else t(i,...s)}catch(o){tt.error(o)}}}const at=new class{constructor(t={},e=1e3){this.throttleMetadata=t,this.intervalMillis=e}getThrottleMetadata(t){return this.throttleMetadata[t]}setThrottleMetadata(t,e){this.throttleMetadata[t]=e}deleteThrottleMetadata(t){delete this.throttleMetadata[t]}};function ct(t){return new Headers({Accept:"application/json","x-goog-api-key":t})}async function ut(t,e=at,n){const{appId:r,apiKey:i,measurementId:s}=t.options;if(!r)throw nt.create("no-app-id");if(!i){if(s)return{measurementId:s,appId:r};throw nt.create("no-api-key")}const o=e.getThrottleMetadata(r)||{backoffCount:0,throttleEndTimeMillis:Date.now()},a=new lt;return setTimeout(async()=>{a.abort()},void 0!==n?n:6e4),ht({appId:r,apiKey:i,measurementId:s},o,a,e)}async function ht(t,{throttleEndTimeMillis:e,backoffCount:n},r,i=at){const{appId:o,measurementId:a}=t;try{await function(t,e){return new Promise((n,r)=>{const i=Math.max(e-Date.now(),0),s=setTimeout(n,i);t.addEventListener(()=>{clearTimeout(s),r(nt.create("fetch-throttle",{throttleEndTimeMillis:e}))})})}(r,e)}catch(c){if(a)return tt.warn(`Timed out fetching this Firebase app's measurement ID from the server. Falling back to the measurement ID ${a} provided in the "measurementId" field in the local Firebase config. [${c?.message}]`),{appId:o,measurementId:a};throw c}try{const e=await async function(t){const{appId:e,apiKey:n}=t,r={method:"GET",headers:ct(n)},i="https://firebase.googleapis.com/v1alpha/projects/-/apps/{app-id}/webConfig".replace("{app-id}",e),s=await fetch(i,r);if(200!==s.status&&304!==s.status){let t="";try{const e=await s.json();e.error?.message&&(t=e.error.message)}catch(o){}throw nt.create("config-fetch-failed",{httpStatus:s.status,responseMessage:t})}return s.json()}(t);return i.deleteThrottleMetadata(o),e}catch(c){const e=c;if(!function(t){if(!(t instanceof s.g&&t.customData))return!1;const e=Number(t.customData.httpStatus);return 429===e||500===e||503===e||504===e}(e)){if(i.deleteThrottleMetadata(o),a)return tt.warn(`Failed to fetch this Firebase app's measurement ID from the server. Falling back to the measurement ID ${a} provided in the "measurementId" field in the local Firebase config. [${e?.message}]`),{appId:o,measurementId:a};throw c}const u=503===Number(e?.customData?.httpStatus)?(0,s.p9)(n,i.intervalMillis,30):(0,s.p9)(n,i.intervalMillis),h={throttleEndTimeMillis:Date.now()+u,backoffCount:n+1};return i.setThrottleMetadata(o,h),tt.debug(`Calling attemptFetch again in ${u} millis`),ht(t,h,r,i)}}class lt{constructor(){this.listeners=[]}addEventListener(t){this.listeners.push(t)}abort(){this.listeners.forEach(t=>t())}}let dt,ft;function pt(t){ft=t}function gt(t){dt=t}async function mt(t,e,n,r,i,o,a){const c=ut(t);c.then(e=>{n[e.measurementId]=e.appId,t.options.measurementId&&e.measurementId!==t.options.measurementId&&tt.warn(`The measurement ID in the local Firebase config (${t.options.measurementId}) does not match the measurement ID fetched from the server (${e.measurementId}). To ensure analytics events are always sent to the correct Analytics property, update the measurement ID field in the local config or remove it from the local config.`)}).catch(t=>tt.error(t)),e.push(c);const u=async function(){if(!(0,s.zW)())return tt.warn(nt.create("indexeddb-unavailable",{errorInfo:"IndexedDB is not available in this environment."}).message),!1;try{await(0,s.eX)()}catch(t){return tt.warn(nt.create("indexeddb-unavailable",{errorInfo:t?.toString()}).message),!1}return!0}().then(t=>t?r.getId():void 0),[h,l]=await Promise.all([c,u]);(function(t){const e=window.document.getElementsByTagName("script");for(const n of Object.values(e))if(n.src&&n.src.includes(Z)&&n.src.includes(t))return n;return null})(o)||st(o,h.measurementId),ft&&(i("consent","default",ft),pt(void 0)),i("js",new Date);const d=a?.config??{};return d.origin="firebase",d.update=!0,null!=l&&(d.firebase_id=l),i("config",h.measurementId,d),dt&&(i("set",dt),gt(void 0)),h.measurementId}class yt{constructor(t){this.app=t}_delete(){return delete wt[this.app.options.appId],Promise.resolve()}}let wt={},vt=[];const bt={};let Et,Tt,_t="dataLayer",It="gtag",St=!1;function Ct(t,e,n){!function(){const t=[];if((0,s.sr)()&&t.push("This is a browser extension environment."),(0,s.dM)()||t.push("Cookies are not available."),t.length>0){const e=t.map((t,e)=>`(${e+1}) ${t}`).join(" "),n=nt.create("invalid-analytics-context",{errorInfo:e});tt.warn(n.message)}}();const r=t.options.appId;if(!r)throw nt.create("no-app-id");if(!t.options.apiKey){if(!t.options.measurementId)throw nt.create("no-api-key");tt.warn(`The "apiKey" field is empty in the local Firebase config. This is needed to fetch the latest measurement ID for this Firebase app. Falling back to the measurement ID ${t.options.measurementId} provided in the "measurementId" field in the local Firebase config.`)}if(null!=wt[r])throw nt.create("already-exists",{id:r});if(!St){!function(t){let e=[];Array.isArray(window[t])?e=window[t]:window[t]=e}(_t);const{wrappedGtag:t,gtagCore:e}=function(t,e,n,r,i){let s=function(...t){window[r].push(arguments)};return window[i]&&"function"==typeof window[i]&&(s=window[i]),window[i]=ot(s,t,e,n),{gtagCore:s,wrappedGtag:window[i]}}(wt,vt,bt,_t,It);Tt=t,Et=e,St=!0}wt[r]=mt(t,vt,bt,e,Et,_t,n);return new yt(t)}function At(t=(0,r.Sx)()){t=(0,s.Ku)(t);const e=(0,r.j6)(t,J);return e.isInitialized()?e.getImmediate():function(t,e={}){const n=(0,r.j6)(t,J);if(n.isInitialized()){const t=n.getImmediate();if((0,s.bD)(e,n.getOptions()))return t;throw nt.create("already-initialized")}const i=n.initialize({options:e});return i}(t)}function Dt(t,e,n){t=(0,s.Ku)(t),async function(t,e,n,r){if(r&&r.global){const e={};for(const t of Object.keys(n))e[`user_properties.${t}`]=n[t];return t("set",e),Promise.resolve()}t("config",await e,{update:!0,user_properties:n})}(Tt,wt[t.app.options.appId],e,n).catch(t=>tt.error(t))}const Nt="@firebase/analytics",kt="0.10.19";(0,r.om)(new o.uA(J,(t,{options:e})=>Ct(t.getProvider("app").getImmediate(),t.getProvider("installations-internal").getImmediate(),e),"PUBLIC")),(0,r.om)(new o.uA("analytics-internal",function(t){try{const e=t.getProvider(J).getImmediate();return{logEvent:(t,n,r)=>function(t,e,n,r){t=(0,s.Ku)(t),async function(t,e,n,r,i){if(i&&i.global)t("event",n,r);else{const i=await e;t("event",n,{...r,send_to:i})}}(Tt,wt[t.app.options.appId],e,n,r).catch(t=>tt.error(t))}(e,t,n,r),setUserProperties:(t,n)=>Dt(e,t,n)}}catch(e){throw nt.create("interop-component-reg-failed",{reason:e})}},"PRIVATE")),(0,r.KO)(Nt,kt),(0,r.KO)(Nt,kt,"esm2020")},8185:(t,e,n)=>{n.d(e,{rJ:()=>Ya,H9:()=>Ja,GG:()=>Yc,_A:()=>ic,aQ:()=>Zc,My:()=>Uc,P:()=>Lc,BN:()=>Jc});var r,i,s=n(9943),o=n(1711),a=n(722),c=n(734),u="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},h={};(function(){var t;function e(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.C=Array(this.blockSize),this.o=this.h=0,this.u()}function n(t,e,n){n||(n=0);const r=Array(16);if("string"==typeof e)for(var i=0;i<16;++i)r[i]=e.charCodeAt(n++)|e.charCodeAt(n++)<<8|e.charCodeAt(n++)<<16|e.charCodeAt(n++)<<24;else for(i=0;i<16;++i)r[i]=e[n++]|e[n++]<<8|e[n++]<<16|e[n++]<<24;e=t.g[0],n=t.g[1],i=t.g[2];let s,o=t.g[3];s=e+(o^n&(i^o))+r[0]+3614090360&4294967295,s=o+(i^(e=n+(s<<7&4294967295|s>>>25))&(n^i))+r[1]+3905402710&4294967295,o=e+(s<<12&4294967295|s>>>20),s=i+(n^o&(e^n))+r[2]+606105819&4294967295,s=n+(e^(i=o+(s<<17&4294967295|s>>>15))&(o^e))+r[3]+3250441966&4294967295,s=e+(o^(n=i+(s<<22&4294967295|s>>>10))&(i^o))+r[4]+4118548399&4294967295,s=o+(i^(e=n+(s<<7&4294967295|s>>>25))&(n^i))+r[5]+1200080426&4294967295,o=e+(s<<12&4294967295|s>>>20),s=i+(n^o&(e^n))+r[6]+2821735955&4294967295,s=n+(e^(i=o+(s<<17&4294967295|s>>>15))&(o^e))+r[7]+4249261313&4294967295,s=e+(o^(n=i+(s<<22&4294967295|s>>>10))&(i^o))+r[8]+1770035416&4294967295,s=o+(i^(e=n+(s<<7&4294967295|s>>>25))&(n^i))+r[9]+2336552879&4294967295,o=e+(s<<12&4294967295|s>>>20),s=i+(n^o&(e^n))+r[10]+4294925233&4294967295,s=n+(e^(i=o+(s<<17&4294967295|s>>>15))&(o^e))+r[11]+2304563134&4294967295,s=e+(o^(n=i+(s<<22&4294967295|s>>>10))&(i^o))+r[12]+1804603682&4294967295,s=o+(i^(e=n+(s<<7&4294967295|s>>>25))&(n^i))+r[13]+4254626195&4294967295,o=e+(s<<12&4294967295|s>>>20),s=i+(n^o&(e^n))+r[14]+2792965006&4294967295,s=n+(e^(i=o+(s<<17&4294967295|s>>>15))&(o^e))+r[15]+1236535329&4294967295,s=e+(i^o&((n=i+(s<<22&4294967295|s>>>10))^i))+r[1]+4129170786&4294967295,s=o+(n^i&((e=n+(s<<5&4294967295|s>>>27))^n))+r[6]+3225465664&4294967295,o=e+(s<<9&4294967295|s>>>23),s=i+(e^n&(o^e))+r[11]+643717713&4294967295,s=n+(o^e&((i=o+(s<<14&4294967295|s>>>18))^o))+r[0]+3921069994&4294967295,s=e+(i^o&((n=i+(s<<20&4294967295|s>>>12))^i))+r[5]+3593408605&4294967295,s=o+(n^i&((e=n+(s<<5&4294967295|s>>>27))^n))+r[10]+38016083&4294967295,o=e+(s<<9&4294967295|s>>>23),s=i+(e^n&(o^e))+r[15]+3634488961&4294967295,s=n+(o^e&((i=o+(s<<14&4294967295|s>>>18))^o))+r[4]+3889429448&4294967295,s=e+(i^o&((n=i+(s<<20&4294967295|s>>>12))^i))+r[9]+568446438&4294967295,s=o+(n^i&((e=n+(s<<5&4294967295|s>>>27))^n))+r[14]+3275163606&4294967295,o=e+(s<<9&4294967295|s>>>23),s=i+(e^n&(o^e))+r[3]+4107603335&4294967295,s=n+(o^e&((i=o+(s<<14&4294967295|s>>>18))^o))+r[8]+1163531501&4294967295,s=e+(i^o&((n=i+(s<<20&4294967295|s>>>12))^i))+r[13]+2850285829&4294967295,s=o+(n^i&((e=n+(s<<5&4294967295|s>>>27))^n))+r[2]+4243563512&4294967295,o=e+(s<<9&4294967295|s>>>23),s=i+(e^n&(o^e))+r[7]+1735328473&4294967295,s=n+(o^e&((i=o+(s<<14&4294967295|s>>>18))^o))+r[12]+2368359562&4294967295,s=e+((n=i+(s<<20&4294967295|s>>>12))^i^o)+r[5]+4294588738&4294967295,s=o+((e=n+(s<<4&4294967295|s>>>28))^n^i)+r[8]+2272392833&4294967295,o=e+(s<<11&4294967295|s>>>21),s=i+(o^e^n)+r[11]+1839030562&4294967295,s=n+((i=o+(s<<16&4294967295|s>>>16))^o^e)+r[14]+4259657740&4294967295,s=e+((n=i+(s<<23&4294967295|s>>>9))^i^o)+r[1]+2763975236&4294967295,s=o+((e=n+(s<<4&4294967295|s>>>28))^n^i)+r[4]+1272893353&4294967295,o=e+(s<<11&4294967295|s>>>21),s=i+(o^e^n)+r[7]+4139469664&4294967295,s=n+((i=o+(s<<16&4294967295|s>>>16))^o^e)+r[10]+3200236656&4294967295,s=e+((n=i+(s<<23&4294967295|s>>>9))^i^o)+r[13]+681279174&4294967295,s=o+((e=n+(s<<4&4294967295|s>>>28))^n^i)+r[0]+3936430074&4294967295,o=e+(s<<11&4294967295|s>>>21),s=i+(o^e^n)+r[3]+3572445317&4294967295,s=n+((i=o+(s<<16&4294967295|s>>>16))^o^e)+r[6]+76029189&4294967295,s=e+((n=i+(s<<23&4294967295|s>>>9))^i^o)+r[9]+3654602809&4294967295,s=o+((e=n+(s<<4&4294967295|s>>>28))^n^i)+r[12]+3873151461&4294967295,o=e+(s<<11&4294967295|s>>>21),s=i+(o^e^n)+r[15]+530742520&4294967295,s=n+((i=o+(s<<16&4294967295|s>>>16))^o^e)+r[2]+3299628645&4294967295,s=e+(i^((n=i+(s<<23&4294967295|s>>>9))|~o))+r[0]+4096336452&4294967295,s=o+(n^((e=n+(s<<6&4294967295|s>>>26))|~i))+r[7]+1126891415&4294967295,o=e+(s<<10&4294967295|s>>>22),s=i+(e^(o|~n))+r[14]+2878612391&4294967295,s=n+(o^((i=o+(s<<15&4294967295|s>>>17))|~e))+r[5]+4237533241&4294967295,s=e+(i^((n=i+(s<<21&4294967295|s>>>11))|~o))+r[12]+1700485571&4294967295,s=o+(n^((e=n+(s<<6&4294967295|s>>>26))|~i))+r[3]+2399980690&4294967295,o=e+(s<<10&4294967295|s>>>22),s=i+(e^(o|~n))+r[10]+4293915773&4294967295,s=n+(o^((i=o+(s<<15&4294967295|s>>>17))|~e))+r[1]+2240044497&4294967295,s=e+(i^((n=i+(s<<21&4294967295|s>>>11))|~o))+r[8]+1873313359&4294967295,s=o+(n^((e=n+(s<<6&4294967295|s>>>26))|~i))+r[15]+4264355552&4294967295,o=e+(s<<10&4294967295|s>>>22),s=i+(e^(o|~n))+r[6]+2734768916&4294967295,s=n+(o^((i=o+(s<<15&4294967295|s>>>17))|~e))+r[13]+1309151649&4294967295,s=e+(i^((n=i+(s<<21&4294967295|s>>>11))|~o))+r[4]+4149444226&4294967295,s=o+(n^((e=n+(s<<6&4294967295|s>>>26))|~i))+r[11]+3174756917&4294967295,o=e+(s<<10&4294967295|s>>>22),s=i+(e^(o|~n))+r[2]+718787259&4294967295,s=n+(o^((i=o+(s<<15&4294967295|s>>>17))|~e))+r[9]+3951481745&4294967295,t.g[0]=t.g[0]+e&4294967295,t.g[1]=t.g[1]+(i+(s<<21&4294967295|s>>>11))&4294967295,t.g[2]=t.g[2]+i&4294967295,t.g[3]=t.g[3]+o&4294967295}function s(t,e){this.h=e;const n=[];let r=!0;for(let i=t.length-1;i>=0;i--){const s=0|t[i];r&&s==e||(n[i]=s,r=!1)}this.g=n}!function(t,e){function n(){}n.prototype=e.prototype,t.F=e.prototype,t.prototype=new n,t.prototype.constructor=t,t.D=function(t,n,r){for(var i=Array(arguments.length-2),s=2;s<arguments.length;s++)i[s-2]=arguments[s];return e.prototype[n].apply(t,i)}}(e,function(){this.blockSize=-1}),e.prototype.u=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0},e.prototype.v=function(t,e){void 0===e&&(e=t.length);const r=e-this.blockSize,i=this.C;let s=this.h,o=0;for(;o<e;){if(0==s)for(;o<=r;)n(this,t,o),o+=this.blockSize;if("string"==typeof t){for(;o<e;)if(i[s++]=t.charCodeAt(o++),s==this.blockSize){n(this,i),s=0;break}}else for(;o<e;)if(i[s++]=t[o++],s==this.blockSize){n(this,i),s=0;break}}this.h=s,this.o+=e},e.prototype.A=function(){var t=Array((this.h<56?this.blockSize:2*this.blockSize)-this.h);t[0]=128;for(var e=1;e<t.length-8;++e)t[e]=0;e=8*this.o;for(var n=t.length-8;n<t.length;++n)t[n]=255&e,e/=256;for(this.v(t),t=Array(16),e=0,n=0;n<4;++n)for(let r=0;r<32;r+=8)t[e++]=this.g[n]>>>r&255;return t};var o={};function a(t){return-128<=t&&t<128?function(t,e){var n=o;return Object.prototype.hasOwnProperty.call(n,t)?n[t]:n[t]=e(t)}(t,function(t){return new s([0|t],t<0?-1:0)}):new s([0|t],t<0?-1:0)}function c(t){if(isNaN(t)||!isFinite(t))return u;if(t<0)return g(c(-t));const e=[];let n=1;for(let r=0;t>=n;r++)e[r]=t/n|0,n*=4294967296;return new s(e,0)}var u=a(0),l=a(1),d=a(16777216);function f(t){if(0!=t.h)return!1;for(let e=0;e<t.g.length;e++)if(0!=t.g[e])return!1;return!0}function p(t){return-1==t.h}function g(t){const e=t.g.length,n=[];for(let r=0;r<e;r++)n[r]=~t.g[r];return new s(n,~t.h).add(l)}function m(t,e){return t.add(g(e))}function y(t,e){for(;(65535&t[e])!=t[e];)t[e+1]+=t[e]>>>16,t[e]&=65535,e++}function w(t,e){this.g=t,this.h=e}function v(t,e){if(f(e))throw Error("division by zero");if(f(t))return new w(u,u);if(p(t))return e=v(g(t),e),new w(g(e.g),g(e.h));if(p(e))return e=v(t,g(e)),new w(g(e.g),e.h);if(t.g.length>30){if(p(t)||p(e))throw Error("slowDivide_ only works with positive integers.");for(var n=l,r=e;r.l(t)<=0;)n=b(n),r=b(r);var i=E(n,1),s=E(r,1);for(r=E(r,2),n=E(n,2);!f(r);){var o=s.add(r);o.l(t)<=0&&(i=i.add(n),s=o),r=E(r,1),n=E(n,1)}return e=m(t,i.j(e)),new w(i,e)}for(i=u;t.l(e)>=0;){for(n=Math.max(1,Math.floor(t.m()/e.m())),r=(r=Math.ceil(Math.log(n)/Math.LN2))<=48?1:Math.pow(2,r-48),o=(s=c(n)).j(e);p(o)||o.l(t)>0;)o=(s=c(n-=r)).j(e);f(s)&&(s=l),i=i.add(s),t=m(t,o)}return new w(i,t)}function b(t){const e=t.g.length+1,n=[];for(let r=0;r<e;r++)n[r]=t.i(r)<<1|t.i(r-1)>>>31;return new s(n,t.h)}function E(t,e){const n=e>>5;e%=32;const r=t.g.length-n,i=[];for(let s=0;s<r;s++)i[s]=e>0?t.i(s+n)>>>e|t.i(s+n+1)<<32-e:t.i(s+n);return new s(i,t.h)}(t=s.prototype).m=function(){if(p(this))return-g(this).m();let t=0,e=1;for(let n=0;n<this.g.length;n++){const r=this.i(n);t+=(r>=0?r:4294967296+r)*e,e*=4294967296}return t},t.toString=function(t){if((t=t||10)<2||36<t)throw Error("radix out of range: "+t);if(f(this))return"0";if(p(this))return"-"+g(this).toString(t);const e=c(Math.pow(t,6));var n=this;let r="";for(;;){const i=v(n,e).g;let s=(((n=m(n,i.j(e))).g.length>0?n.g[0]:n.h)>>>0).toString(t);if(f(n=i))return s+r;for(;s.length<6;)s="0"+s;r=s+r}},t.i=function(t){return t<0?0:t<this.g.length?this.g[t]:this.h},t.l=function(t){return p(t=m(this,t))?-1:f(t)?0:1},t.abs=function(){return p(this)?g(this):this},t.add=function(t){const e=Math.max(this.g.length,t.g.length),n=[];let r=0;for(let i=0;i<=e;i++){let e=r+(65535&this.i(i))+(65535&t.i(i)),s=(e>>>16)+(this.i(i)>>>16)+(t.i(i)>>>16);r=s>>>16,e&=65535,s&=65535,n[i]=s<<16|e}return new s(n,-2147483648&n[n.length-1]?-1:0)},t.j=function(t){if(f(this)||f(t))return u;if(p(this))return p(t)?g(this).j(g(t)):g(g(this).j(t));if(p(t))return g(this.j(g(t)));if(this.l(d)<0&&t.l(d)<0)return c(this.m()*t.m());const e=this.g.length+t.g.length,n=[];for(var r=0;r<2*e;r++)n[r]=0;for(r=0;r<this.g.length;r++)for(let e=0;e<t.g.length;e++){const i=this.i(r)>>>16,s=65535&this.i(r),o=t.i(e)>>>16,a=65535&t.i(e);n[2*r+2*e]+=s*a,y(n,2*r+2*e),n[2*r+2*e+1]+=i*a,y(n,2*r+2*e+1),n[2*r+2*e+1]+=s*o,y(n,2*r+2*e+1),n[2*r+2*e+2]+=i*o,y(n,2*r+2*e+2)}for(t=0;t<e;t++)n[t]=n[2*t+1]<<16|n[2*t];for(t=e;t<2*e;t++)n[t]=0;return new s(n,0)},t.B=function(t){return v(this,t).h},t.and=function(t){const e=Math.max(this.g.length,t.g.length),n=[];for(let r=0;r<e;r++)n[r]=this.i(r)&t.i(r);return new s(n,this.h&t.h)},t.or=function(t){const e=Math.max(this.g.length,t.g.length),n=[];for(let r=0;r<e;r++)n[r]=this.i(r)|t.i(r);return new s(n,this.h|t.h)},t.xor=function(t){const e=Math.max(this.g.length,t.g.length),n=[];for(let r=0;r<e;r++)n[r]=this.i(r)^t.i(r);return new s(n,this.h^t.h)},e.prototype.digest=e.prototype.A,e.prototype.reset=e.prototype.u,e.prototype.update=e.prototype.v,i=h.Md5=e,s.prototype.add=s.prototype.add,s.prototype.multiply=s.prototype.j,s.prototype.modulo=s.prototype.B,s.prototype.compare=s.prototype.l,s.prototype.toNumber=s.prototype.m,s.prototype.toString=s.prototype.toString,s.prototype.getBits=s.prototype.i,s.fromNumber=c,s.fromString=function t(e,n){if(0==e.length)throw Error("number format error: empty string");if((n=n||10)<2||36<n)throw Error("radix out of range: "+n);if("-"==e.charAt(0))return g(t(e.substring(1),n));if(e.indexOf("-")>=0)throw Error('number format error: interior "-" character');const r=c(Math.pow(n,8));let i=u;for(let o=0;o<e.length;o+=8){var s=Math.min(8,e.length-o);const t=parseInt(e.substring(o,o+s),n);s<8?(s=c(Math.pow(n,s)),i=i.j(s).add(c(t))):(i=i.j(r),i=i.add(c(t)))}return i},r=h.Integer=s}).apply(void 0!==u?u:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{});var l,d,f,p,g,m,y,w,v="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},b={};(function(){var t,e=Object.defineProperty;var n=function(t){t=["object"==typeof globalThis&&globalThis,t,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof v&&v];for(var e=0;e<t.length;++e){var n=t[e];if(n&&n.Math==Math)return n}throw Error("Cannot find global object")}(this);function r(t,r){if(r)t:{var i=n;t=t.split(".");for(var s=0;s<t.length-1;s++){var o=t[s];if(!(o in i))break t;i=i[o]}(r=r(s=i[t=t[t.length-1]]))!=s&&null!=r&&e(i,t,{configurable:!0,writable:!0,value:r})}}r("Symbol.dispose",function(t){return t||Symbol("Symbol.dispose")}),r("Array.prototype.values",function(t){return t||function(){return this[Symbol.iterator]()}}),r("Object.entries",function(t){return t||function(t){var e,n=[];for(e in t)Object.prototype.hasOwnProperty.call(t,e)&&n.push([e,t[e]]);return n}});var i=i||{},s=this||self;function o(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}function a(t,e,n){return t.call.apply(t.bind,arguments)}function c(t,e,n){return(c=a).apply(null,arguments)}function u(t,e){var n=Array.prototype.slice.call(arguments,1);return function(){var e=n.slice();return e.push.apply(e,arguments),t.apply(this,e)}}function h(t,e){function n(){}n.prototype=e.prototype,t.Z=e.prototype,t.prototype=new n,t.prototype.constructor=t,t.Ob=function(t,n,r){for(var i=Array(arguments.length-2),s=2;s<arguments.length;s++)i[s-2]=arguments[s];return e.prototype[n].apply(t,i)}}var E="undefined"!=typeof AsyncContext&&"function"==typeof AsyncContext.Snapshot?t=>t&&AsyncContext.Snapshot.wrap(t):t=>t;function _(t){const e=t.length;if(e>0){const n=Array(e);for(let r=0;r<e;r++)n[r]=t[r];return n}return[]}function I(t,e){for(let r=1;r<arguments.length;r++){const e=arguments[r];var n=typeof e;if("array"==(n="object"!=n?n:e?Array.isArray(e)?"array":n:"null")||"object"==n&&"number"==typeof e.length){n=t.length||0;const r=e.length||0;t.length=n+r;for(let i=0;i<r;i++)t[n+i]=e[i]}else t.push(e)}}function S(t){s.setTimeout(()=>{throw t},0)}function C(){var t=R;let e=null;return t.g&&(e=t.g,t.g=t.g.next,t.g||(t.h=null),e.next=null),e}var A=new class{constructor(t,e){this.i=t,this.j=e,this.h=0,this.g=null}get(){let t;return this.h>0?(this.h--,t=this.g,this.g=t.next,t.next=null):t=this.i(),t}}(()=>new D,t=>t.reset());class D{constructor(){this.next=this.g=this.h=null}set(t,e){this.h=t,this.g=e,this.next=null}reset(){this.next=this.g=this.h=null}}let N,k=!1,R=new class{constructor(){this.h=this.g=null}add(t,e){const n=A.get();n.set(t,e),this.h?this.h.next=n:this.g=n,this.h=n}},x=()=>{const t=Promise.resolve(void 0);N=()=>{t.then(O)}};function O(){for(var t;t=C();){try{t.h.call(t.g)}catch(n){S(n)}var e=A;e.j(t),e.h<100&&(e.h++,t.next=e.g,e.g=t)}k=!1}function M(){this.u=this.u,this.C=this.C}function L(t,e){this.type=t,this.g=this.target=e,this.defaultPrevented=!1}M.prototype.u=!1,M.prototype.dispose=function(){this.u||(this.u=!0,this.N())},M.prototype[Symbol.dispose]=function(){this.dispose()},M.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()},L.prototype.h=function(){this.defaultPrevented=!0};var P=function(){if(!s.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{const t=()=>{};s.addEventListener("test",t,e),s.removeEventListener("test",t,e)}catch(n){}return t}();function V(t){return/^[\s\xa0]*$/.test(t)}function F(t,e){L.call(this,t?t.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,t&&this.init(t,e)}h(F,L),F.prototype.init=function(t,e){const n=this.type=t.type,r=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;this.target=t.target||t.srcElement,this.g=e,(e=t.relatedTarget)||("mouseover"==n?e=t.fromElement:"mouseout"==n&&(e=t.toElement)),this.relatedTarget=e,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType=t.pointerType,this.state=t.state,this.i=t,t.defaultPrevented&&F.Z.h.call(this)},F.prototype.h=function(){F.Z.h.call(this);const t=this.i;t.preventDefault?t.preventDefault():t.returnValue=!1};var U="closure_listenable_"+(1e6*Math.random()|0),j=0;function B(t,e,n,r,i){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!r,this.ha=i,this.key=++j,this.da=this.fa=!1}function q(t){t.da=!0,t.listener=null,t.proxy=null,t.src=null,t.ha=null}function $(t,e,n){for(const r in t)e.call(n,t[r],r,t)}function z(t){const e={};for(const n in t)e[n]=t[n];return e}const K="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function G(t,e){let n,r;for(let i=1;i<arguments.length;i++){for(n in r=arguments[i],r)t[n]=r[n];for(let e=0;e<K.length;e++)n=K[e],Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}}function H(t){this.src=t,this.g={},this.h=0}function Q(t,e){const n=e.type;if(n in t.g){var r,i=t.g[n],s=Array.prototype.indexOf.call(i,e,void 0);(r=s>=0)&&Array.prototype.splice.call(i,s,1),r&&(q(e),0==t.g[n].length&&(delete t.g[n],t.h--))}}function W(t,e,n,r){for(let i=0;i<t.length;++i){const s=t[i];if(!s.da&&s.listener==e&&s.capture==!!n&&s.ha==r)return i}return-1}H.prototype.add=function(t,e,n,r,i){const s=t.toString();(t=this.g[s])||(t=this.g[s]=[],this.h++);const o=W(t,e,r,i);return o>-1?(e=t[o],n||(e.fa=!1)):((e=new B(e,this.src,s,!!r,i)).fa=n,t.push(e)),e};var X="closure_lm_"+(1e6*Math.random()|0),Y={};function J(t,e,n,r,i){if(r&&r.once)return et(t,e,n,r,i);if(Array.isArray(e)){for(let s=0;s<e.length;s++)J(t,e[s],n,r,i);return null}return n=ct(n),t&&t[U]?t.J(e,n,o(r)?!!r.capture:!!r,i):tt(t,e,n,!1,r,i)}function tt(t,e,n,r,i,s){if(!e)throw Error("Invalid event type");const a=o(i)?!!i.capture:!!i;let c=ot(t);if(c||(t[X]=c=new H(t)),(n=c.add(e,n,r,a,s)).proxy)return n;if(r=function(){function t(n){return e.call(t.src,t.listener,n)}const e=st;return t}(),n.proxy=r,r.src=t,r.listener=n,t.addEventListener)P||(i=a),void 0===i&&(i=!1),t.addEventListener(e.toString(),r,i);else if(t.attachEvent)t.attachEvent(it(e.toString()),r);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(r)}return n}function et(t,e,n,r,i){if(Array.isArray(e)){for(let s=0;s<e.length;s++)et(t,e[s],n,r,i);return null}return n=ct(n),t&&t[U]?t.K(e,n,o(r)?!!r.capture:!!r,i):tt(t,e,n,!0,r,i)}function nt(t,e,n,r,i){if(Array.isArray(e))for(var s=0;s<e.length;s++)nt(t,e[s],n,r,i);else r=o(r)?!!r.capture:!!r,n=ct(n),t&&t[U]?(t=t.i,(s=String(e).toString())in t.g&&((n=W(e=t.g[s],n,r,i))>-1&&(q(e[n]),Array.prototype.splice.call(e,n,1),0==e.length&&(delete t.g[s],t.h--)))):t&&(t=ot(t))&&(e=t.g[e.toString()],t=-1,e&&(t=W(e,n,r,i)),(n=t>-1?e[t]:null)&&rt(n))}function rt(t){if("number"!=typeof t&&t&&!t.da){var e=t.src;if(e&&e[U])Q(e.i,t);else{var n=t.type,r=t.proxy;e.removeEventListener?e.removeEventListener(n,r,t.capture):e.detachEvent?e.detachEvent(it(n),r):e.addListener&&e.removeListener&&e.removeListener(r),(n=ot(e))?(Q(n,t),0==n.h&&(n.src=null,e[X]=null)):q(t)}}}function it(t){return t in Y?Y[t]:Y[t]="on"+t}function st(t,e){if(t.da)t=!0;else{e=new F(e,this);const n=t.listener,r=t.ha||t.src;t.fa&&rt(t),t=n.call(r,e)}return t}function ot(t){return(t=t[X])instanceof H?t:null}var at="__closure_events_fn_"+(1e9*Math.random()>>>0);function ct(t){return"function"==typeof t?t:(t[at]||(t[at]=function(e){return t.handleEvent(e)}),t[at])}function ut(){M.call(this),this.i=new H(this),this.M=this,this.G=null}function ht(t,e){var n,r=t.G;if(r)for(n=[];r;r=r.G)n.push(r);if(t=t.M,r=e.type||e,"string"==typeof e)e=new L(e,t);else if(e instanceof L)e.target=e.target||t;else{var i=e;G(e=new L(r,t),i)}let s,o;if(i=!0,n)for(o=n.length-1;o>=0;o--)s=e.g=n[o],i=lt(s,r,!0,e)&&i;if(s=e.g=t,i=lt(s,r,!0,e)&&i,i=lt(s,r,!1,e)&&i,n)for(o=0;o<n.length;o++)s=e.g=n[o],i=lt(s,r,!1,e)&&i}function lt(t,e,n,r){if(!(e=t.i.g[String(e)]))return!0;e=e.concat();let i=!0;for(let s=0;s<e.length;++s){const o=e[s];if(o&&!o.da&&o.capture==n){const e=o.listener,n=o.ha||o.src;o.fa&&Q(t.i,o),i=!1!==e.call(n,r)&&i}}return i&&!r.defaultPrevented}function dt(t){t.g=function(t,e){if("function"!=typeof t){if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=c(t.handleEvent,t)}return Number(e)>2147483647?-1:s.setTimeout(t,e||0)}(()=>{t.g=null,t.i&&(t.i=!1,dt(t))},t.l);const e=t.h;t.h=null,t.m.apply(null,e)}h(ut,M),ut.prototype[U]=!0,ut.prototype.removeEventListener=function(t,e,n,r){nt(this,t,e,n,r)},ut.prototype.N=function(){if(ut.Z.N.call(this),this.i){var t=this.i;for(const e in t.g){const n=t.g[e];for(let t=0;t<n.length;t++)q(n[t]);delete t.g[e],t.h--}}this.G=null},ut.prototype.J=function(t,e,n,r){return this.i.add(String(t),e,!1,n,r)},ut.prototype.K=function(t,e,n,r){return this.i.add(String(t),e,!0,n,r)};class ft extends M{constructor(t,e){super(),this.m=t,this.l=e,this.h=null,this.i=!1,this.g=null}j(t){this.h=arguments,this.g?this.i=!0:dt(this)}N(){super.N(),this.g&&(s.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function pt(t){M.call(this),this.h=t,this.g={}}h(pt,M);var gt=[];function mt(t){$(t.g,function(t,e){this.g.hasOwnProperty(e)&&rt(t)},t),t.g={}}pt.prototype.N=function(){pt.Z.N.call(this),mt(this)},pt.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var yt=s.JSON.stringify,wt=s.JSON.parse,vt=class{stringify(t){return s.JSON.stringify(t,void 0)}parse(t){return s.JSON.parse(t,void 0)}};function bt(){}function Et(){}var Tt={OPEN:"a",hb:"b",ERROR:"c",tb:"d"};function _t(){L.call(this,"d")}function It(){L.call(this,"c")}h(_t,L),h(It,L);var St={},Ct=null;function At(){return Ct=Ct||new ut}function Dt(t){L.call(this,St.Ia,t)}function Nt(t){const e=At();ht(e,new Dt(e))}function kt(t,e){L.call(this,St.STAT_EVENT,t),this.stat=e}function Rt(t){const e=At();ht(e,new kt(e,t))}function xt(t,e){L.call(this,St.Ja,t),this.size=e}function Ot(t,e){if("function"!=typeof t)throw Error("Fn must not be null and must be a function");return s.setTimeout(function(){t()},e)}function Mt(){this.g=!0}function Lt(t,e,n,r){t.info(function(){return"XMLHTTP TEXT ("+e+"): "+function(t,e){if(!t.g)return e;if(!e)return null;try{const s=JSON.parse(e);if(s)for(t=0;t<s.length;t++)if(Array.isArray(s[t])){var n=s[t];if(!(n.length<2)){var r=n[1];if(Array.isArray(r)&&!(r.length<1)){var i=r[0];if("noop"!=i&&"stop"!=i&&"close"!=i)for(let t=1;t<r.length;t++)r[t]=""}}}return yt(s)}catch(s){return e}}(t,n)+(r?" "+r:"")})}St.Ia="serverreachability",h(Dt,L),St.STAT_EVENT="statevent",h(kt,L),St.Ja="timingevent",h(xt,L),Mt.prototype.ua=function(){this.g=!1},Mt.prototype.info=function(){};var Pt,Vt={NO_ERROR:0,cb:1,qb:2,pb:3,kb:4,ob:5,rb:6,Ga:7,TIMEOUT:8,ub:9},Ft={ib:"complete",Fb:"success",ERROR:"error",Ga:"abort",xb:"ready",yb:"readystatechange",TIMEOUT:"timeout",sb:"incrementaldata",wb:"progress",lb:"downloadprogress",Nb:"uploadprogress"};function Ut(){}function jt(t){return encodeURIComponent(String(t))}function Bt(t){var e=1;t=t.split(":");const n=[];for(;e>0&&t.length;)n.push(t.shift()),e--;return t.length&&n.push(t.join(":")),n}function qt(t,e,n,r){this.j=t,this.i=e,this.l=n,this.S=r||1,this.V=new pt(this),this.H=45e3,this.J=null,this.o=!1,this.u=this.B=this.A=this.M=this.F=this.T=this.D=null,this.G=[],this.g=null,this.C=0,this.m=this.v=null,this.X=-1,this.K=!1,this.P=0,this.O=null,this.W=this.L=this.U=this.R=!1,this.h=new $t}function $t(){this.i=null,this.g="",this.h=!1}h(Ut,bt),Ut.prototype.g=function(){return new XMLHttpRequest},Pt=new Ut;var zt={},Kt={};function Gt(t,e,n){t.M=1,t.A=ye(de(e)),t.u=n,t.R=!0,Ht(t,null)}function Ht(t,e){t.F=Date.now(),Xt(t),t.B=de(t.A);var n=t.B,r=t.S;Array.isArray(r)||(r=[String(r)]),Re(n.i,"t",r),t.C=0,n=t.j.L,t.h=new $t,t.g=wn(t.j,n?e:null,!t.u),t.P>0&&(t.O=new ft(c(t.Y,t,t.g),t.P)),e=t.V,n=t.g,r=t.ba;var i="readystatechange";Array.isArray(i)||(i&&(gt[0]=i.toString()),i=gt);for(let s=0;s<i.length;s++){const t=J(n,i[s],r||e.handleEvent,!1,e.h||e);if(!t)break;e.g[t.key]=t}e=t.J?z(t.J):{},t.u?(t.v||(t.v="POST"),e["Content-Type"]="application/x-www-form-urlencoded",t.g.ea(t.B,t.v,t.u,e)):(t.v="GET",t.g.ea(t.B,t.v,null,e)),Nt(),function(t,e,n,r,i,s){t.info(function(){if(t.g)if(s){var o="",a=s.split("&");for(let t=0;t<a.length;t++){var c=a[t].split("=");if(c.length>1){const t=c[0];c=c[1];const e=t.split("_");o=e.length>=2&&"type"==e[1]?o+(t+"=")+c+"&":o+(t+"=redacted&")}}}else o=null;else o=s;return"XMLHTTP REQ ("+r+") [attempt "+i+"]: "+e+"\n"+n+"\n"+o})}(t.i,t.v,t.B,t.l,t.S,t.u)}function Qt(t){return!!t.g&&("GET"==t.v&&2!=t.M&&t.j.Aa)}function Wt(t,e){var n=t.C,r=e.indexOf("\n",n);return-1==r?Kt:(n=Number(e.substring(n,r)),isNaN(n)?zt:(r+=1)+n>e.length?Kt:(e=e.slice(r,r+n),t.C=r+n,e))}function Xt(t){t.T=Date.now()+t.H,Yt(t,t.H)}function Yt(t,e){if(null!=t.D)throw Error("WatchDog timer not null");t.D=Ot(c(t.aa,t),e)}function Jt(t){t.D&&(s.clearTimeout(t.D),t.D=null)}function Zt(t){0==t.j.I||t.K||fn(t.j,t)}function te(t){Jt(t);var e=t.O;e&&"function"==typeof e.dispose&&e.dispose(),t.O=null,mt(t.V),t.g&&(e=t.g,t.g=null,e.abort(),e.dispose())}function ee(t,e){try{var n=t.j;if(0!=n.I&&(n.g==t||oe(n.h,t)))if(!t.L&&oe(n.h,t)&&3==n.I){try{var r=n.Ba.g.parse(e)}catch(h){r=null}if(Array.isArray(r)&&3==r.length){var i=r;if(0==i[0]){t:if(!n.v){if(n.g){if(!(n.g.F+3e3<t.F))break t;dn(n),en(n)}un(n),Rt(18)}}else n.xa=i[1],0<n.xa-n.K&&i[2]<37500&&n.F&&0==n.A&&!n.C&&(n.C=Ot(c(n.Va,n),6e3));se(n.h)<=1&&n.ta&&(n.ta=void 0)}else gn(n,11)}else if((t.L||n.g==t)&&dn(n),!V(e))for(i=n.Ba.g.parse(e),e=0;e<i.length;e++){let c=i[e];const h=c[0];if(!(h<=n.K))if(n.K=h,c=c[1],2==n.I)if("c"==c[0]){n.M=c[1],n.ba=c[2];const e=c[3];null!=e&&(n.ka=e,n.j.info("VER="+n.ka));const i=c[4];null!=i&&(n.za=i,n.j.info("SVER="+n.za));const h=c[5];null!=h&&"number"==typeof h&&h>0&&(r=1.5*h,n.O=r,n.j.info("backChannelRequestTimeoutMs_="+r)),r=n;const l=t.g;if(l){const t=l.g?l.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(t){var s=r.h;s.g||-1==t.indexOf("spdy")&&-1==t.indexOf("quic")&&-1==t.indexOf("h2")||(s.j=s.l,s.g=new Set,s.h&&(ae(s,s.h),s.h=null))}if(r.G){const t=l.g?l.g.getResponseHeader("X-HTTP-Session-Id"):null;t&&(r.wa=t,me(r.J,r.G,t))}}n.I=3,n.l&&n.l.ra(),n.aa&&(n.T=Date.now()-t.F,n.j.info("Handshake RTT: "+n.T+"ms"));var o=t;if((r=n).na=yn(r,r.L?r.ba:null,r.W),o.L){ce(r.h,o);var a=o,u=r.O;u&&(a.H=u),a.D&&(Jt(a),Xt(a)),r.g=o}else cn(r);n.i.length>0&&rn(n)}else"stop"!=c[0]&&"close"!=c[0]||gn(n,7);else 3==n.I&&("stop"==c[0]||"close"==c[0]?"stop"==c[0]?gn(n,7):tn(n):"noop"!=c[0]&&n.l&&n.l.qa(c),n.A=0)}Nt()}catch(h){}}qt.prototype.ba=function(t){t=t.target;const e=this.O;e&&3==Xe(t)?e.j():this.Y(t)},qt.prototype.Y=function(t){try{if(t==this.g)t:{const c=Xe(this.g),u=this.g.ya();this.g.ca();if(!(c<3)&&(3!=c||this.g&&(this.h.h||this.g.la()||Ye(this.g)))){this.K||4!=c||7==u||Nt(),Jt(this);var e=this.g.ca();this.X=e;var n=function(t){if(!Qt(t))return t.g.la();const e=Ye(t.g);if(""===e)return"";let n="";const r=e.length,i=4==Xe(t.g);if(!t.h.i){if("undefined"==typeof TextDecoder)return te(t),Zt(t),"";t.h.i=new s.TextDecoder}for(let s=0;s<r;s++)t.h.h=!0,n+=t.h.i.decode(e[s],{stream:!(i&&s==r-1)});return e.length=0,t.h.g+=n,t.C=0,t.h.g}(this);if(this.o=200==e,function(t,e,n,r,i,s,o){t.info(function(){return"XMLHTTP RESP ("+r+") [ attempt "+i+"]: "+e+"\n"+n+"\n"+s+" "+o})}(this.i,this.v,this.B,this.l,this.S,c,e),this.o){if(this.U&&!this.L){e:{if(this.g){var r,i=this.g;if((r=i.g?i.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!V(r)){var o=r;break e}}o=null}if(!(t=o)){this.o=!1,this.m=3,Rt(12),te(this),Zt(this);break t}Lt(this.i,this.l,t,"Initial handshake response via X-HTTP-Initial-Response"),this.L=!0,ee(this,t)}if(this.R){let e;for(t=!0;!this.K&&this.C<n.length;){if(e=Wt(this,n),e==Kt){4==c&&(this.m=4,Rt(14),t=!1),Lt(this.i,this.l,null,"[Incomplete Response]");break}if(e==zt){this.m=4,Rt(15),Lt(this.i,this.l,n,"[Invalid Chunk]"),t=!1;break}Lt(this.i,this.l,e,null),ee(this,e)}if(Qt(this)&&0!=this.C&&(this.h.g=this.h.g.slice(this.C),this.C=0),4!=c||0!=n.length||this.h.h||(this.m=1,Rt(16),t=!1),this.o=this.o&&t,t){if(n.length>0&&!this.W){this.W=!0;var a=this.j;a.g==this&&a.aa&&!a.P&&(a.j.info("Great, no buffering proxy detected. Bytes received: "+n.length),hn(a),a.P=!0,Rt(11))}}else Lt(this.i,this.l,n,"[Invalid Chunked Response]"),te(this),Zt(this)}else Lt(this.i,this.l,n,null),ee(this,n);4==c&&te(this),this.o&&!this.K&&(4==c?fn(this.j,this):(this.o=!1,Xt(this)))}else(function(t){const e={};t=(t.g&&Xe(t)>=2&&t.g.getAllResponseHeaders()||"").split("\r\n");for(let r=0;r<t.length;r++){if(V(t[r]))continue;var n=Bt(t[r]);const i=n[0];if("string"!=typeof(n=n[1]))continue;n=n.trim();const s=e[i]||[];e[i]=s,s.push(n)}!function(t,e){for(const n in t)e.call(void 0,t[n],n,t)}(e,function(t){return t.join(", ")})})(this.g),400==e&&n.indexOf("Unknown SID")>0?(this.m=3,Rt(12)):(this.m=0,Rt(13)),te(this),Zt(this)}}}catch(Z){}},qt.prototype.cancel=function(){this.K=!0,te(this)},qt.prototype.aa=function(){this.D=null;const t=Date.now();t-this.T>=0?(function(t,e){t.info(function(){return"TIMEOUT: "+e})}(this.i,this.B),2!=this.M&&(Nt(),Rt(17)),te(this),this.m=2,Zt(this)):Yt(this,this.T-t)};var ne=class{constructor(t,e){this.g=t,this.map=e}};function re(t){this.l=t||10,s.PerformanceNavigationTiming?t=(t=s.performance.getEntriesByType("navigation")).length>0&&("hq"==t[0].nextHopProtocol||"h2"==t[0].nextHopProtocol):t=!!(s.chrome&&s.chrome.loadTimes&&s.chrome.loadTimes()&&s.chrome.loadTimes().wasFetchedViaSpdy),this.j=t?this.l:1,this.g=null,this.j>1&&(this.g=new Set),this.h=null,this.i=[]}function ie(t){return!!t.h||!!t.g&&t.g.size>=t.j}function se(t){return t.h?1:t.g?t.g.size:0}function oe(t,e){return t.h?t.h==e:!!t.g&&t.g.has(e)}function ae(t,e){t.g?t.g.add(e):t.h=e}function ce(t,e){t.h&&t.h==e?t.h=null:t.g&&t.g.has(e)&&t.g.delete(e)}function ue(t){if(null!=t.h)return t.i.concat(t.h.G);if(null!=t.g&&0!==t.g.size){let e=t.i;for(const n of t.g.values())e=e.concat(n.G);return e}return _(t.i)}re.prototype.cancel=function(){if(this.i=ue(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const t of this.g.values())t.cancel();this.g.clear()}};var he=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function le(t){let e;this.g=this.o=this.j="",this.u=null,this.m=this.h="",this.l=!1,t instanceof le?(this.l=t.l,fe(this,t.j),this.o=t.o,this.g=t.g,pe(this,t.u),this.h=t.h,ge(this,xe(t.i)),this.m=t.m):t&&(e=String(t).match(he))?(this.l=!1,fe(this,e[1]||"",!0),this.o=we(e[2]||""),this.g=we(e[3]||"",!0),pe(this,e[4]),this.h=we(e[5]||"",!0),ge(this,e[6]||"",!0),this.m=we(e[7]||"")):(this.l=!1,this.i=new Ce(null,this.l))}function de(t){return new le(t)}function fe(t,e,n){t.j=n?we(e,!0):e,t.j&&(t.j=t.j.replace(/:$/,""))}function pe(t,e){if(e){if(e=Number(e),isNaN(e)||e<0)throw Error("Bad port number "+e);t.u=e}else t.u=null}function ge(t,e,n){e instanceof Ce?(t.i=e,function(t,e){e&&!t.j&&(Ae(t),t.i=null,t.g.forEach(function(t,e){const n=e.toLowerCase();e!=n&&(De(this,e),Re(this,n,t))},t)),t.j=e}(t.i,t.l)):(n||(e=ve(e,Ie)),t.i=new Ce(e,t.l))}function me(t,e,n){t.i.set(e,n)}function ye(t){return me(t,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),t}function we(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function ve(t,e,n){return"string"==typeof t?(t=encodeURI(t).replace(e,be),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function be(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}le.prototype.toString=function(){const t=[];var e=this.j;e&&t.push(ve(e,Ee,!0),":");var n=this.g;return(n||"file"==e)&&(t.push("//"),(e=this.o)&&t.push(ve(e,Ee,!0),"@"),t.push(jt(n).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.u)&&t.push(":",String(n))),(n=this.h)&&(this.g&&"/"!=n.charAt(0)&&t.push("/"),t.push(ve(n,"/"==n.charAt(0)?_e:Te,!0))),(n=this.i.toString())&&t.push("?",n),(n=this.m)&&t.push("#",ve(n,Se)),t.join("")},le.prototype.resolve=function(t){const e=de(this);let n=!!t.j;n?fe(e,t.j):n=!!t.o,n?e.o=t.o:n=!!t.g,n?e.g=t.g:n=null!=t.u;var r=t.h;if(n)pe(e,t.u);else if(n=!!t.h){if("/"!=r.charAt(0))if(this.g&&!this.h)r="/"+r;else{var i=e.h.lastIndexOf("/");-1!=i&&(r=e.h.slice(0,i+1)+r)}if(".."==(i=r)||"."==i)r="";else if(-1!=i.indexOf("./")||-1!=i.indexOf("/.")){r=0==i.lastIndexOf("/",0),i=i.split("/");const t=[];for(let e=0;e<i.length;){const n=i[e++];"."==n?r&&e==i.length&&t.push(""):".."==n?((t.length>1||1==t.length&&""!=t[0])&&t.pop(),r&&e==i.length&&t.push("")):(t.push(n),r=!0)}r=t.join("/")}else r=i}return n?e.h=r:n=""!==t.i.toString(),n?ge(e,xe(t.i)):n=!!t.m,n&&(e.m=t.m),e};var Ee=/[#\/\?@]/g,Te=/[#\?:]/g,_e=/[#\?]/g,Ie=/[#\?@]/g,Se=/#/g;function Ce(t,e){this.h=this.g=null,this.i=t||null,this.j=!!e}function Ae(t){t.g||(t.g=new Map,t.h=0,t.i&&function(t,e){if(t){t=t.split("&");for(let n=0;n<t.length;n++){const r=t[n].indexOf("=");let i,s=null;r>=0?(i=t[n].substring(0,r),s=t[n].substring(r+1)):i=t[n],e(i,s?decodeURIComponent(s.replace(/\+/g," ")):"")}}}(t.i,function(e,n){t.add(decodeURIComponent(e.replace(/\+/g," ")),n)}))}function De(t,e){Ae(t),e=Oe(t,e),t.g.has(e)&&(t.i=null,t.h-=t.g.get(e).length,t.g.delete(e))}function Ne(t,e){return Ae(t),e=Oe(t,e),t.g.has(e)}function ke(t,e){Ae(t);let n=[];if("string"==typeof e)Ne(t,e)&&(n=n.concat(t.g.get(Oe(t,e))));else for(t=Array.from(t.g.values()),e=0;e<t.length;e++)n=n.concat(t[e]);return n}function Re(t,e,n){De(t,e),n.length>0&&(t.i=null,t.g.set(Oe(t,e),_(n)),t.h+=n.length)}function xe(t){const e=new Ce;return e.i=t.i,t.g&&(e.g=new Map(t.g),e.h=t.h),e}function Oe(t,e){return e=String(e),t.j&&(e=e.toLowerCase()),e}function Me(t,e,n,r,i){try{i&&(i.onload=null,i.onerror=null,i.onabort=null,i.ontimeout=null),r(n)}catch(s){}}function Le(){this.g=new vt}function Pe(t){this.i=t.Sb||null,this.h=t.ab||!1}function Ve(t,e){ut.call(this),this.H=t,this.o=e,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.A=new Headers,this.h=null,this.F="GET",this.D="",this.g=!1,this.B=this.j=this.l=null,this.v=new AbortController}function Fe(t){t.j.read().then(t.Ma.bind(t)).catch(t.ga.bind(t))}function Ue(t){t.readyState=4,t.l=null,t.j=null,t.B=null,je(t)}function je(t){t.onreadystatechange&&t.onreadystatechange.call(t)}function Be(t){let e="";return $(t,function(t,n){e+=n,e+=":",e+=t,e+="\r\n"}),e}function qe(t,e,n){t:{for(r in n){var r=!1;break t}r=!0}r||(n=Be(n),"string"==typeof t?null!=n&&jt(n):me(t,e,n))}function $e(t){ut.call(this),this.headers=new Map,this.L=t||null,this.h=!1,this.g=null,this.D="",this.o=0,this.l="",this.j=this.B=this.v=this.A=!1,this.m=null,this.F="",this.H=!1}(t=Ce.prototype).add=function(t,e){Ae(this),this.i=null,t=Oe(this,t);let n=this.g.get(t);return n||this.g.set(t,n=[]),n.push(e),this.h+=1,this},t.forEach=function(t,e){Ae(this),this.g.forEach(function(n,r){n.forEach(function(n){t.call(e,n,r,this)},this)},this)},t.set=function(t,e){return Ae(this),this.i=null,Ne(this,t=Oe(this,t))&&(this.h-=this.g.get(t).length),this.g.set(t,[e]),this.h+=1,this},t.get=function(t,e){return t&&(t=ke(this,t)).length>0?String(t[0]):e},t.toString=function(){if(this.i)return this.i;if(!this.g)return"";const t=[],e=Array.from(this.g.keys());for(let r=0;r<e.length;r++){var n=e[r];const i=jt(n);n=ke(this,n);for(let e=0;e<n.length;e++){let r=i;""!==n[e]&&(r+="="+jt(n[e])),t.push(r)}}return this.i=t.join("&")},h(Pe,bt),Pe.prototype.g=function(){return new Ve(this.i,this.h)},h(Ve,ut),(t=Ve.prototype).open=function(t,e){if(0!=this.readyState)throw this.abort(),Error("Error reopening a connection");this.F=t,this.D=e,this.readyState=1,je(this)},t.send=function(t){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");if(this.v.signal.aborted)throw this.abort(),Error("Request was aborted.");this.g=!0;const e={headers:this.A,method:this.F,credentials:this.m,cache:void 0,signal:this.v.signal};t&&(e.body=t),(this.H||s).fetch(new Request(this.D,e)).then(this.Pa.bind(this),this.ga.bind(this))},t.abort=function(){this.response=this.responseText="",this.A=new Headers,this.status=0,this.v.abort(),this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),this.readyState>=1&&this.g&&4!=this.readyState&&(this.g=!1,Ue(this)),this.readyState=0},t.Pa=function(t){if(this.g&&(this.l=t,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=t.headers,this.readyState=2,je(this)),this.g&&(this.readyState=3,je(this),this.g)))if("arraybuffer"===this.responseType)t.arrayBuffer().then(this.Na.bind(this),this.ga.bind(this));else if(void 0!==s.ReadableStream&&"body"in t){if(this.j=t.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.B=new TextDecoder;Fe(this)}else t.text().then(this.Oa.bind(this),this.ga.bind(this))},t.Ma=function(t){if(this.g){if(this.o&&t.value)this.response.push(t.value);else if(!this.o){var e=t.value?t.value:new Uint8Array(0);(e=this.B.decode(e,{stream:!t.done}))&&(this.response=this.responseText+=e)}t.done?Ue(this):je(this),3==this.readyState&&Fe(this)}},t.Oa=function(t){this.g&&(this.response=this.responseText=t,Ue(this))},t.Na=function(t){this.g&&(this.response=t,Ue(this))},t.ga=function(){this.g&&Ue(this)},t.setRequestHeader=function(t,e){this.A.append(t,e)},t.getResponseHeader=function(t){return this.h&&this.h.get(t.toLowerCase())||""},t.getAllResponseHeaders=function(){if(!this.h)return"";const t=[],e=this.h.entries();for(var n=e.next();!n.done;)n=n.value,t.push(n[0]+": "+n[1]),n=e.next();return t.join("\r\n")},Object.defineProperty(Ve.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(t){this.m=t?"include":"same-origin"}}),h($e,ut);var ze=/^https?$/i,Ke=["POST","PUT"];function Ge(t,e){t.h=!1,t.g&&(t.j=!0,t.g.abort(),t.j=!1),t.l=e,t.o=5,He(t),We(t)}function He(t){t.A||(t.A=!0,ht(t,"complete"),ht(t,"error"))}function Qe(t){if(t.h&&void 0!==i)if(t.v&&4==Xe(t))setTimeout(t.Ca.bind(t),0);else if(ht(t,"readystatechange"),4==Xe(t)){t.h=!1;try{const i=t.ca();t:switch(i){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var e=!0;break t;default:e=!1}var n;if(!(n=e)){var r;if(r=0===i){let e=String(t.D).match(he)[1]||null;!e&&s.self&&s.self.location&&(e=s.self.location.protocol.slice(0,-1)),r=!ze.test(e?e.toLowerCase():"")}n=r}if(n)ht(t,"complete"),ht(t,"success");else{t.o=6;try{var o=Xe(t)>2?t.g.statusText:""}catch(a){o=""}t.l=o+" ["+t.ca()+"]",He(t)}}finally{We(t)}}}function We(t,e){if(t.g){t.m&&(clearTimeout(t.m),t.m=null);const r=t.g;t.g=null,e||ht(t,"ready");try{r.onreadystatechange=null}catch(n){}}}function Xe(t){return t.g?t.g.readyState:0}function Ye(t){try{if(!t.g)return null;if("response"in t.g)return t.g.response;switch(t.F){case"":case"text":return t.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in t.g)return t.g.mozResponseArrayBuffer}return null}catch(e){return null}}function Je(t,e,n){return n&&n.internalChannelParams&&n.internalChannelParams[t]||e}function Ze(t){this.za=0,this.i=[],this.j=new Mt,this.ba=this.na=this.J=this.W=this.g=this.wa=this.G=this.H=this.u=this.U=this.o=null,this.Ya=this.V=0,this.Sa=Je("failFast",!1,t),this.F=this.C=this.v=this.m=this.l=null,this.X=!0,this.xa=this.K=-1,this.Y=this.A=this.D=0,this.Qa=Je("baseRetryDelayMs",5e3,t),this.Za=Je("retryDelaySeedMs",1e4,t),this.Ta=Je("forwardChannelMaxRetries",2,t),this.va=Je("forwardChannelRequestTimeoutMs",2e4,t),this.ma=t&&t.xmlHttpFactory||void 0,this.Ua=t&&t.Rb||void 0,this.Aa=t&&t.useFetchStreams||!1,this.O=void 0,this.L=t&&t.supportsCrossDomainXhr||!1,this.M="",this.h=new re(t&&t.concurrentRequestLimit),this.Ba=new Le,this.S=t&&t.fastHandshake||!1,this.R=t&&t.encodeInitMessageHeaders||!1,this.S&&this.R&&(this.R=!1),this.Ra=t&&t.Pb||!1,t&&t.ua&&this.j.ua(),t&&t.forceLongPolling&&(this.X=!1),this.aa=!this.S&&this.X&&t&&t.detectBufferingProxy||!1,this.ia=void 0,t&&t.longPollingTimeout&&t.longPollingTimeout>0&&(this.ia=t.longPollingTimeout),this.ta=void 0,this.T=0,this.P=!1,this.ja=this.B=null}function tn(t){if(nn(t),3==t.I){var e=t.V++,n=de(t.J);if(me(n,"SID",t.M),me(n,"RID",e),me(n,"TYPE","terminate"),on(t,n),(e=new qt(t,t.j,e)).M=2,e.A=ye(de(n)),n=!1,s.navigator&&s.navigator.sendBeacon)try{n=s.navigator.sendBeacon(e.A.toString(),"")}catch(r){}!n&&s.Image&&((new Image).src=e.A,n=!0),n||(e.g=wn(e.j,null),e.g.ea(e.A)),e.F=Date.now(),Xt(e)}mn(t)}function en(t){t.g&&(hn(t),t.g.cancel(),t.g=null)}function nn(t){en(t),t.v&&(s.clearTimeout(t.v),t.v=null),dn(t),t.h.cancel(),t.m&&("number"==typeof t.m&&s.clearTimeout(t.m),t.m=null)}function rn(t){if(!ie(t.h)&&!t.m){t.m=!0;var e=t.Ea;N||x(),k||(N(),k=!0),R.add(e,t),t.D=0}}function sn(t,e){var n;n=e?e.l:t.V++;const r=de(t.J);me(r,"SID",t.M),me(r,"RID",n),me(r,"AID",t.K),on(t,r),t.u&&t.o&&qe(r,t.u,t.o),n=new qt(t,t.j,n,t.D+1),null===t.u&&(n.J=t.o),e&&(t.i=e.G.concat(t.i)),e=an(t,n,1e3),n.H=Math.round(.5*t.va)+Math.round(.5*t.va*Math.random()),ae(t.h,n),Gt(n,r,e)}function on(t,e){t.H&&$(t.H,function(t,n){me(e,n,t)}),t.l&&$({},function(t,n){me(e,n,t)})}function an(t,e,n){n=Math.min(t.i.length,n);const r=t.l?c(t.l.Ka,t.l,t):null;t:{var i=t.i;let e=-1;for(;;){const t=["count="+n];-1==e?n>0?(e=i[0].g,t.push("ofs="+e)):e=0:t.push("ofs="+e);let c=!0;for(let u=0;u<n;u++){var s=i[u].g;const n=i[u].map;if((s-=e)<0)e=Math.max(0,i[u].g-100),c=!1;else try{s="req"+s+"_"||0;try{var a=n instanceof Map?n:Object.entries(n);for(const[e,n]of a){let r=n;o(n)&&(r=yt(n)),t.push(s+e+"="+encodeURIComponent(r))}}catch(T){throw t.push(s+"type="+encodeURIComponent("_badmap")),T}}catch(T){r&&r(n)}}if(c){a=t.join("&");break t}}a=void 0}return t=t.i.splice(0,n),e.G=t,a}function cn(t){if(!t.g&&!t.v){t.Y=1;var e=t.Da;N||x(),k||(N(),k=!0),R.add(e,t),t.A=0}}function un(t){return!(t.g||t.v||t.A>=3)&&(t.Y++,t.v=Ot(c(t.Da,t),pn(t,t.A)),t.A++,!0)}function hn(t){null!=t.B&&(s.clearTimeout(t.B),t.B=null)}function ln(t){t.g=new qt(t,t.j,"rpc",t.Y),null===t.u&&(t.g.J=t.o),t.g.P=0;var e=de(t.na);me(e,"RID","rpc"),me(e,"SID",t.M),me(e,"AID",t.K),me(e,"CI",t.F?"0":"1"),!t.F&&t.ia&&me(e,"TO",t.ia),me(e,"TYPE","xmlhttp"),on(t,e),t.u&&t.o&&qe(e,t.u,t.o),t.O&&(t.g.H=t.O);var n=t.g;t=t.ba,n.M=1,n.A=ye(de(e)),n.u=null,n.R=!0,Ht(n,t)}function dn(t){null!=t.C&&(s.clearTimeout(t.C),t.C=null)}function fn(t,e){var n=null;if(t.g==e){dn(t),hn(t),t.g=null;var r=2}else{if(!oe(t.h,e))return;n=e.G,ce(t.h,e),r=1}if(0!=t.I)if(e.o)if(1==r){n=e.u?e.u.length:0,e=Date.now()-e.F;var i=t.D;ht(r=At(),new xt(r,n)),rn(t)}else cn(t);else if(3==(i=e.m)||0==i&&e.X>0||!(1==r&&function(t,e){return!(se(t.h)>=t.h.j-(t.m?1:0)||(t.m?(t.i=e.G.concat(t.i),0):1==t.I||2==t.I||t.D>=(t.Sa?0:t.Ta)||(t.m=Ot(c(t.Ea,t,e),pn(t,t.D)),t.D++,0)))}(t,e)||2==r&&un(t)))switch(n&&n.length>0&&(e=t.h,e.i=e.i.concat(n)),i){case 1:gn(t,5);break;case 4:gn(t,10);break;case 3:gn(t,6);break;default:gn(t,2)}}function pn(t,e){let n=t.Qa+Math.floor(Math.random()*t.Za);return t.isActive()||(n*=2),n*e}function gn(t,e){if(t.j.info("Error code "+e),2==e){var n=c(t.bb,t),r=t.Ua;const e=!r;r=new le(r||"//www.google.com/images/cleardot.gif"),s.location&&"http"==s.location.protocol||fe(r,"https"),ye(r),e?function(t,e){const n=new Mt;if(s.Image){const r=new Image;r.onload=u(Me,n,"TestLoadImage: loaded",!0,e,r),r.onerror=u(Me,n,"TestLoadImage: error",!1,e,r),r.onabort=u(Me,n,"TestLoadImage: abort",!1,e,r),r.ontimeout=u(Me,n,"TestLoadImage: timeout",!1,e,r),s.setTimeout(function(){r.ontimeout&&r.ontimeout()},1e4),r.src=t}else e(!1)}(r.toString(),n):function(t,e){new Mt;const n=new AbortController,r=setTimeout(()=>{n.abort(),Me(0,0,!1,e)},1e4);fetch(t,{signal:n.signal}).then(t=>{clearTimeout(r),t.ok?Me(0,0,!0,e):Me(0,0,!1,e)}).catch(()=>{clearTimeout(r),Me(0,0,!1,e)})}(r.toString(),n)}else Rt(2);t.I=0,t.l&&t.l.pa(e),mn(t),nn(t)}function mn(t){if(t.I=0,t.ja=[],t.l){const e=ue(t.h);0==e.length&&0==t.i.length||(I(t.ja,e),I(t.ja,t.i),t.h.i.length=0,_(t.i),t.i.length=0),t.l.oa()}}function yn(t,e,n){var r=n instanceof le?de(n):new le(n);if(""!=r.g)e&&(r.g=e+"."+r.g),pe(r,r.u);else{var i=s.location;r=i.protocol,e=e?e+"."+i.hostname:i.hostname,i=+i.port;const t=new le(null);r&&fe(t,r),e&&(t.g=e),i&&pe(t,i),n&&(t.h=n),r=t}return n=t.G,e=t.wa,n&&e&&me(r,n,e),me(r,"VER",t.ka),on(t,r),r}function wn(t,e,n){if(e&&!t.L)throw Error("Can't create secondary domain capable XhrIo object.");return(e=t.Aa&&!t.ma?new $e(new Pe({ab:n})):new $e(t.ma)).Fa(t.L),e}function vn(){}function bn(){}function En(t,e){ut.call(this),this.g=new Ze(e),this.l=t,this.h=e&&e.messageUrlParams||null,t=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(t?t["X-Client-Protocol"]="webchannel":t={"X-Client-Protocol":"webchannel"}),this.g.o=t,t=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(t?t["X-WebChannel-Content-Type"]=e.messageContentType:t={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.sa&&(t?t["X-WebChannel-Client-Profile"]=e.sa:t={"X-WebChannel-Client-Profile":e.sa}),this.g.U=t,(t=e&&e.Qb)&&!V(t)&&(this.g.u=t),this.A=e&&e.supportsCrossDomainXhr||!1,this.v=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!V(e)&&(this.g.G=e,null!==(t=this.h)&&e in t&&(e in(t=this.h)&&delete t[e])),this.j=new In(this)}function Tn(t){_t.call(this),t.__headers__&&(this.headers=t.__headers__,this.statusCode=t.__status__,delete t.__headers__,delete t.__status__);var e=t.__sm__;if(e){t:{for(const n in e){t=n;break t}t=void 0}(this.i=t)&&(t=this.i,e=null!==e&&t in e?e[t]:void 0),this.data=e}else this.data=t}function _n(){It.call(this),this.status=1}function In(t){this.g=t}(t=$e.prototype).Fa=function(t){this.H=t},t.ea=function(t,e,n,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+t);e=e?e.toUpperCase():"GET",this.D=t,this.l="",this.o=0,this.A=!1,this.h=!0,this.g=this.L?this.L.g():Pt.g(),this.g.onreadystatechange=E(c(this.Ca,this));try{this.B=!0,this.g.open(e,String(t),!0),this.B=!1}catch(o){return void Ge(this,o)}if(t=n||"",n=new Map(this.headers),r)if(Object.getPrototypeOf(r)===Object.prototype)for(var i in r)n.set(i,r[i]);else{if("function"!=typeof r.keys||"function"!=typeof r.get)throw Error("Unknown input type for opt_headers: "+String(r));for(const t of r.keys())n.set(t,r.get(t))}r=Array.from(n.keys()).find(t=>"content-type"==t.toLowerCase()),i=s.FormData&&t instanceof s.FormData,!(Array.prototype.indexOf.call(Ke,e,void 0)>=0)||r||i||n.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[s,a]of n)this.g.setRequestHeader(s,a);this.F&&(this.g.responseType=this.F),"withCredentials"in this.g&&this.g.withCredentials!==this.H&&(this.g.withCredentials=this.H);try{this.m&&(clearTimeout(this.m),this.m=null),this.v=!0,this.g.send(t),this.v=!1}catch(o){Ge(this,o)}},t.abort=function(t){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.o=t||7,ht(this,"complete"),ht(this,"abort"),We(this))},t.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),We(this,!0)),$e.Z.N.call(this)},t.Ca=function(){this.u||(this.B||this.v||this.j?Qe(this):this.Xa())},t.Xa=function(){Qe(this)},t.isActive=function(){return!!this.g},t.ca=function(){try{return Xe(this)>2?this.g.status:-1}catch(t){return-1}},t.la=function(){try{return this.g?this.g.responseText:""}catch(t){return""}},t.La=function(t){if(this.g){var e=this.g.responseText;return t&&0==e.indexOf(t)&&(e=e.substring(t.length)),wt(e)}},t.ya=function(){return this.o},t.Ha=function(){return"string"==typeof this.l?this.l:String(this.l)},(t=Ze.prototype).ka=8,t.I=1,t.connect=function(t,e,n,r){Rt(0),this.W=t,this.H=e||{},n&&void 0!==r&&(this.H.OSID=n,this.H.OAID=r),this.F=this.X,this.J=yn(this,null,this.W),rn(this)},t.Ea=function(t){if(this.m)if(this.m=null,1==this.I){if(!t){this.V=Math.floor(1e5*Math.random()),t=this.V++;const i=new qt(this,this.j,t);let s=this.o;if(this.U&&(s?(s=z(s),G(s,this.U)):s=this.U),null!==this.u||this.R||(i.J=s,s=null),this.S)t:{for(var e=0,n=0;n<this.i.length;n++){var r=this.i[n];if(void 0===(r="__data__"in r.map&&"string"==typeof(r=r.map.__data__)?r.length:void 0))break;if((e+=r)>4096){e=n;break t}if(4096===e||n===this.i.length-1){e=n+1;break t}}e=1e3}else e=1e3;e=an(this,i,e),me(n=de(this.J),"RID",t),me(n,"CVER",22),this.G&&me(n,"X-HTTP-Session-Id",this.G),on(this,n),s&&(this.R?e="headers="+jt(Be(s))+"&"+e:this.u&&qe(n,this.u,s)),ae(this.h,i),this.Ra&&me(n,"TYPE","init"),this.S?(me(n,"$req",e),me(n,"SID","null"),i.U=!0,Gt(i,n,null)):Gt(i,n,e),this.I=2}}else 3==this.I&&(t?sn(this,t):0==this.i.length||ie(this.h)||sn(this))},t.Da=function(){if(this.v=null,ln(this),this.aa&&!(this.P||null==this.g||this.T<=0)){var t=4*this.T;this.j.info("BP detection timer enabled: "+t),this.B=Ot(c(this.Wa,this),t)}},t.Wa=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.P=!0,Rt(10),en(this),ln(this))},t.Va=function(){null!=this.C&&(this.C=null,en(this),un(this),Rt(19))},t.bb=function(t){t?(this.j.info("Successfully pinged google.com"),Rt(2)):(this.j.info("Failed to ping google.com"),Rt(1))},t.isActive=function(){return!!this.l&&this.l.isActive(this)},(t=vn.prototype).ra=function(){},t.qa=function(){},t.pa=function(){},t.oa=function(){},t.isActive=function(){return!0},t.Ka=function(){},bn.prototype.g=function(t,e){return new En(t,e)},h(En,ut),En.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.L=!0),this.g.connect(this.l,this.h||void 0)},En.prototype.close=function(){tn(this.g)},En.prototype.o=function(t){var e=this.g;if("string"==typeof t){var n={};n.__data__=t,t=n}else this.v&&((n={}).__data__=yt(t),t=n);e.i.push(new ne(e.Ya++,t)),3==e.I&&rn(e)},En.prototype.N=function(){this.g.l=null,delete this.j,tn(this.g),delete this.g,En.Z.N.call(this)},h(Tn,_t),h(_n,It),h(In,vn),In.prototype.ra=function(){ht(this.g,"a")},In.prototype.qa=function(t){ht(this.g,new Tn(t))},In.prototype.pa=function(t){ht(this.g,new _n)},In.prototype.oa=function(){ht(this.g,"b")},bn.prototype.createWebChannel=bn.prototype.g,En.prototype.send=En.prototype.o,En.prototype.open=En.prototype.m,En.prototype.close=En.prototype.close,w=b.createWebChannelTransport=function(){return new bn},y=b.getStatEventTarget=function(){return At()},m=b.Event=St,g=b.Stat={jb:0,mb:1,nb:2,Hb:3,Mb:4,Jb:5,Kb:6,Ib:7,Gb:8,Lb:9,PROXY:10,NOPROXY:11,Eb:12,Ab:13,Bb:14,zb:15,Cb:16,Db:17,fb:18,eb:19,gb:20},Vt.NO_ERROR=0,Vt.TIMEOUT=8,Vt.HTTP_ERROR=6,p=b.ErrorCode=Vt,Ft.COMPLETE="complete",f=b.EventType=Ft,Et.EventType=Tt,Tt.OPEN="a",Tt.CLOSE="b",Tt.ERROR="c",Tt.MESSAGE="d",ut.prototype.listen=ut.prototype.J,d=b.WebChannel=Et,b.FetchXmlHttpFactory=Pe,$e.prototype.listenOnce=$e.prototype.K,$e.prototype.getLastError=$e.prototype.Ha,$e.prototype.getLastErrorCode=$e.prototype.ya,$e.prototype.getStatus=$e.prototype.ca,$e.prototype.getResponseJson=$e.prototype.La,$e.prototype.getResponseText=$e.prototype.la,$e.prototype.send=$e.prototype.ea,$e.prototype.setWithCredentials=$e.prototype.Fa,l=b.XhrIo=$e}).apply(void 0!==v?v:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{});const E="@firebase/firestore",T="4.9.2";class _{constructor(t){this.uid=t}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(t){return t.uid===this.uid}}_.UNAUTHENTICATED=new _(null),_.GOOGLE_CREDENTIALS=new _("google-credentials-uid"),_.FIRST_PARTY=new _("first-party-uid"),_.MOCK_USER=new _("mock-user");let I="12.3.0";const S=new a.Vy("@firebase/firestore");function C(){return S.logLevel}function A(t,...e){if(S.logLevel<=a.$b.DEBUG){const n=e.map(k);S.debug(`Firestore (${I}): ${t}`,...n)}}function D(t,...e){if(S.logLevel<=a.$b.ERROR){const n=e.map(k);S.error(`Firestore (${I}): ${t}`,...n)}}function N(t,...e){if(S.logLevel<=a.$b.WARN){const n=e.map(k);S.warn(`Firestore (${I}): ${t}`,...n)}}function k(t){if("string"==typeof t)return t;try{return function(t){return JSON.stringify(t)}(t)}catch(e){return t}}function R(t,e,n){let r="Unexpected state";"string"==typeof e?r=e:n=e,x(t,r,n)}function x(t,e,n){let r=`FIRESTORE (${I}) INTERNAL ASSERTION FAILED: ${e} (ID: ${t.toString(16)})`;if(void 0!==n)try{r+=" CONTEXT: "+JSON.stringify(n)}catch(t){r+=" CONTEXT: "+n}throw D(r),new Error(r)}function O(t,e,n,r){let i="Unexpected state";"string"==typeof n?i=n:r=n,t||x(e,i,r)}function M(t,e){return t}const L={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class P extends c.g{constructor(t,e){super(t,e),this.code=t,this.message=e,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class V{constructor(){this.promise=new Promise((t,e)=>{this.resolve=t,this.reject=e})}}class F{constructor(t,e){this.user=e,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${t}`)}}class U{getToken(){return Promise.resolve(null)}invalidateToken(){}start(t,e){t.enqueueRetryable(()=>e(_.UNAUTHENTICATED))}shutdown(){}}class j{constructor(t){this.t=t,this.currentUser=_.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(t,e){O(void 0===this.o,42304);let n=this.i;const r=t=>this.i!==n?(n=this.i,e(t)):Promise.resolve();let i=new V;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new V,t.enqueueRetryable(()=>r(this.currentUser))};const s=()=>{const e=i;t.enqueueRetryable(async()=>{await e.promise,await r(this.currentUser)})},o=t=>{A("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=t,this.o&&(this.auth.addAuthTokenListener(this.o),s())};this.t.onInit(t=>o(t)),setTimeout(()=>{if(!this.auth){const t=this.t.getImmediate({optional:!0});t?o(t):(A("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new V)}},0),s()}getToken(){const t=this.i,e=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(e).then(e=>this.i!==t?(A("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):e?(O("string"==typeof e.accessToken,31837,{l:e}),new F(e.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const t=this.auth&&this.auth.getUid();return O(null===t||"string"==typeof t,2055,{h:t}),new _(t)}}class B{constructor(t,e,n){this.P=t,this.T=e,this.I=n,this.type="FirstParty",this.user=_.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);const t=this.R();return t&&this.A.set("Authorization",t),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class q{constructor(t,e,n){this.P=t,this.T=e,this.I=n}getToken(){return Promise.resolve(new B(this.P,this.T,this.I))}start(t,e){t.enqueueRetryable(()=>e(_.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class ${constructor(t){this.value=t,this.type="AppCheck",this.headers=new Map,t&&t.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class z{constructor(t,e){this.V=e,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,(0,s.xZ)(t)&&t.settings.appCheckToken&&(this.p=t.settings.appCheckToken)}start(t,e){O(void 0===this.o,3512);const n=t=>{null!=t.error&&A("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${t.error.message}`);const n=t.token!==this.m;return this.m=t.token,A("FirebaseAppCheckTokenProvider",`Received ${n?"new":"existing"} token.`),n?e(t.token):Promise.resolve()};this.o=e=>{t.enqueueRetryable(()=>n(e))};const r=t=>{A("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=t,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit(t=>r(t)),setTimeout(()=>{if(!this.appCheck){const t=this.V.getImmediate({optional:!0});t?r(t):A("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.p)return Promise.resolve(new $(this.p));const t=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(t).then(t=>t?(O("string"==typeof t.token,44558,{tokenResult:t}),this.m=t.token,new $(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}function K(t){const e="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(n);else for(let r=0;r<t;r++)n[r]=Math.floor(256*Math.random());return n}class G{static newId(){const t=62*Math.floor(256/62);let e="";for(;e.length<20;){const n=K(40);for(let r=0;r<n.length;++r)e.length<20&&n[r]<t&&(e+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(n[r]%62))}return e}}function H(t,e){return t<e?-1:t>e?1:0}function Q(t,e){const n=Math.min(t.length,e.length);for(let r=0;r<n;r++){const n=t.charAt(r),i=e.charAt(r);if(n!==i)return Y(n)===Y(i)?H(n,i):Y(n)?1:-1}return H(t.length,e.length)}const W=55296,X=57343;function Y(t){const e=t.charCodeAt(0);return e>=W&&e<=X}function J(t,e,n){return t.length===e.length&&t.every((t,r)=>n(t,e[r]))}const Z="__name__";class tt{constructor(t,e,n){void 0===e?e=0:e>t.length&&R(637,{offset:e,range:t.length}),void 0===n?n=t.length-e:n>t.length-e&&R(1746,{length:n,range:t.length-e}),this.segments=t,this.offset=e,this.len=n}get length(){return this.len}isEqual(t){return 0===tt.comparator(this,t)}child(t){const e=this.segments.slice(this.offset,this.limit());return t instanceof tt?t.forEach(t=>{e.push(t)}):e.push(t),this.construct(e)}limit(){return this.offset+this.length}popFirst(t){return t=void 0===t?1:t,this.construct(this.segments,this.offset+t,this.length-t)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(t){return this.segments[this.offset+t]}isEmpty(){return 0===this.length}isPrefixOf(t){if(t.length<this.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}isImmediateParentOf(t){if(this.length+1!==t.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}forEach(t){for(let e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(t,e){const n=Math.min(t.length,e.length);for(let r=0;r<n;r++){const n=tt.compareSegments(t.get(r),e.get(r));if(0!==n)return n}return H(t.length,e.length)}static compareSegments(t,e){const n=tt.isNumericId(t),r=tt.isNumericId(e);return n&&!r?-1:!n&&r?1:n&&r?tt.extractNumericId(t).compare(tt.extractNumericId(e)):Q(t,e)}static isNumericId(t){return t.startsWith("__id")&&t.endsWith("__")}static extractNumericId(t){return r.fromString(t.substring(4,t.length-2))}}class et extends tt{construct(t,e,n){return new et(t,e,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...t){const e=[];for(const n of t){if(n.indexOf("//")>=0)throw new P(L.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);e.push(...n.split("/").filter(t=>t.length>0))}return new et(e)}static emptyPath(){return new et([])}}const nt=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class rt extends tt{construct(t,e,n){return new rt(t,e,n)}static isValidIdentifier(t){return nt.test(t)}canonicalString(){return this.toArray().map(t=>(t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),rt.isValidIdentifier(t)||(t="`"+t+"`"),t)).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&this.get(0)===Z}static keyField(){return new rt([Z])}static fromServerFormat(t){const e=[];let n="",r=0;const i=()=>{if(0===n.length)throw new P(L.INVALID_ARGUMENT,`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);e.push(n),n=""};let s=!1;for(;r<t.length;){const e=t[r];if("\\"===e){if(r+1===t.length)throw new P(L.INVALID_ARGUMENT,"Path has trailing escape character: "+t);const e=t[r+1];if("\\"!==e&&"."!==e&&"`"!==e)throw new P(L.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);n+=e,r+=2}else"`"===e?(s=!s,r++):"."!==e||s?(n+=e,r++):(i(),r++)}if(i(),s)throw new P(L.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new rt(e)}static emptyPath(){return new rt([])}}class it{constructor(t){this.path=t}static fromPath(t){return new it(et.fromString(t))}static fromName(t){return new it(et.fromString(t).popFirst(5))}static empty(){return new it(et.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(t){return null!==t&&0===et.comparator(this.path,t.path)}toString(){return this.path.toString()}static comparator(t,e){return et.comparator(t.path,e.path)}static isDocumentKey(t){return t.length%2==0}static fromSegments(t){return new it(new et(t.slice()))}}function st(t,e,n){if(!n)throw new P(L.INVALID_ARGUMENT,`Function ${t}() cannot be called with an empty ${e}.`)}function ot(t){if(!it.isDocumentKey(t))throw new P(L.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${t} has ${t.length}.`)}function at(t){if(it.isDocumentKey(t))throw new P(L.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${t} has ${t.length}.`)}function ct(t){return"object"==typeof t&&null!==t&&(Object.getPrototypeOf(t)===Object.prototype||null===Object.getPrototypeOf(t))}function ut(t){if(void 0===t)return"undefined";if(null===t)return"null";if("string"==typeof t)return t.length>20&&(t=`${t.substring(0,20)}...`),JSON.stringify(t);if("number"==typeof t||"boolean"==typeof t)return""+t;if("object"==typeof t){if(t instanceof Array)return"an array";{const e=function(t){return t.constructor?t.constructor.name:null}(t);return e?`a custom ${e} object`:"an object"}}return"function"==typeof t?"a function":R(12329,{type:typeof t})}function ht(t,e){if("_delegate"in t&&(t=t._delegate),!(t instanceof e)){if(e.name===t.constructor.name)throw new P(L.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=ut(t);throw new P(L.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${n}`)}}return t}function lt(t,e){const n={typeString:t};return e&&(n.value=e),n}function dt(t,e){if(!ct(t))throw new P(L.INVALID_ARGUMENT,"JSON must be an object");let n;for(const r in e)if(e[r]){const i=e[r].typeString,s="value"in e[r]?{value:e[r].value}:void 0;if(!(r in t)){n=`JSON missing required field: '${r}'`;break}const o=t[r];if(i&&typeof o!==i){n=`JSON field '${r}' must be a ${i}.`;break}if(void 0!==s&&o!==s.value){n=`Expected '${r}' field to equal '${s.value}'`;break}}if(n)throw new P(L.INVALID_ARGUMENT,n);return!0}const ft=-62135596800,pt=1e6;class gt{static now(){return gt.fromMillis(Date.now())}static fromDate(t){return gt.fromMillis(t.getTime())}static fromMillis(t){const e=Math.floor(t/1e3),n=Math.floor((t-1e3*e)*pt);return new gt(e,n)}constructor(t,e){if(this.seconds=t,this.nanoseconds=e,e<0)throw new P(L.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(e>=1e9)throw new P(L.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<ft)throw new P(L.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new P(L.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/pt}_compareTo(t){return this.seconds===t.seconds?H(this.nanoseconds,t.nanoseconds):H(this.seconds,t.seconds)}isEqual(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:gt._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(t){if(dt(t,gt._jsonSchema))return new gt(t.seconds,t.nanoseconds)}valueOf(){const t=this.seconds-ft;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}gt._jsonSchemaVersion="firestore/timestamp/1.0",gt._jsonSchema={type:lt("string",gt._jsonSchemaVersion),seconds:lt("number"),nanoseconds:lt("number")};class mt{static fromTimestamp(t){return new mt(t)}static min(){return new mt(new gt(0,0))}static max(){return new mt(new gt(253402300799,999999999))}constructor(t){this.timestamp=t}compareTo(t){return this.timestamp._compareTo(t.timestamp)}isEqual(t){return this.timestamp.isEqual(t.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}const yt=-1;class wt{constructor(t,e,n,r){this.indexId=t,this.collectionGroup=e,this.fields=n,this.indexState=r}}wt.UNKNOWN_ID=-1;function vt(t,e){const n=t.toTimestamp().seconds,r=t.toTimestamp().nanoseconds+1,i=mt.fromTimestamp(1e9===r?new gt(n+1,0):new gt(n,r));return new Et(i,it.empty(),e)}function bt(t){return new Et(t.readTime,t.key,yt)}class Et{constructor(t,e,n){this.readTime=t,this.documentKey=e,this.largestBatchId=n}static min(){return new Et(mt.min(),it.empty(),yt)}static max(){return new Et(mt.max(),it.empty(),yt)}}function Tt(t,e){let n=t.readTime.compareTo(e.readTime);return 0!==n?n:(n=it.comparator(t.documentKey,e.documentKey),0!==n?n:H(t.largestBatchId,e.largestBatchId))}const _t="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class It{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(t){this.onCommittedListeners.push(t)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(t=>t())}}async function St(t){if(t.code!==L.FAILED_PRECONDITION||t.message!==_t)throw t;A("LocalStore","Unexpectedly lost primary lease")}class Ct{constructor(t){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(t){return this.next(void 0,t)}next(t,e){return this.callbackAttached&&R(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(e,this.error):this.wrapSuccess(t,this.result):new Ct((n,r)=>{this.nextCallback=e=>{this.wrapSuccess(t,e).next(n,r)},this.catchCallback=t=>{this.wrapFailure(e,t).next(n,r)}})}toPromise(){return new Promise((t,e)=>{this.next(t,e)})}wrapUserFunction(t){try{const e=t();return e instanceof Ct?e:Ct.resolve(e)}catch(t){return Ct.reject(t)}}wrapSuccess(t,e){return t?this.wrapUserFunction(()=>t(e)):Ct.resolve(e)}wrapFailure(t,e){return t?this.wrapUserFunction(()=>t(e)):Ct.reject(e)}static resolve(t){return new Ct((e,n)=>{e(t)})}static reject(t){return new Ct((e,n)=>{n(t)})}static waitFor(t){return new Ct((e,n)=>{let r=0,i=0,s=!1;t.forEach(t=>{++r,t.next(()=>{++i,s&&i===r&&e()},t=>n(t))}),s=!0,i===r&&e()})}static or(t){let e=Ct.resolve(!1);for(const n of t)e=e.next(t=>t?Ct.resolve(t):n());return e}static forEach(t,e){const n=[];return t.forEach((t,r)=>{n.push(e.call(this,t,r))}),this.waitFor(n)}static mapArray(t,e){return new Ct((n,r)=>{const i=t.length,s=new Array(i);let o=0;for(let a=0;a<i;a++){const c=a;e(t[c]).next(t=>{s[c]=t,++o,o===i&&n(s)},t=>r(t))}})}static doWhile(t,e){return new Ct((n,r)=>{const i=()=>{!0===t()?e().next(()=>{i()},r):n()};i()})}}function At(t){const e=t.match(/Android ([\d.]+)/i),n=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(n)}function Dt(t){return"IndexedDbTransactionError"===t.name}class Nt{constructor(t,e){this.previousValue=t,e&&(e.sequenceNumberHandler=t=>this.ae(t),this.ue=t=>e.writeSequenceNumber(t))}ae(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){const t=++this.previousValue;return this.ue&&this.ue(t),t}}Nt.ce=-1;const kt=-1;function Rt(t){return null==t}function xt(t){return 0===t&&1/t==-1/0}function Ot(t){return"number"==typeof t&&Number.isInteger(t)&&!xt(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}const Mt="\x01";function Lt(t){let e="";for(let n=0;n<t.length;n++)e.length>0&&(e=Vt(e)),e=Pt(t.get(n),e);return Vt(e)}function Pt(t,e){let n=e;const r=t.length;for(let i=0;i<r;i++){const e=t.charAt(i);switch(e){case"\0":n+="\x01\x10";break;case Mt:n+="\x01\x11";break;default:n+=e}}return n}function Vt(t){return t+Mt+"\x01"}const Ft="remoteDocuments",Ut="owner",jt="mutationQueues",Bt="mutations";const qt="documentMutations",$t="remoteDocumentsV14",zt="remoteDocumentGlobal",Kt="targets",Gt="targetDocuments",Ht="targetGlobal",Qt="collectionParents",Wt="clientMetadata",Xt="bundles",Yt="namedQueries",Jt="indexConfiguration",Zt="indexState",te="indexEntries",ee="documentOverlays",ne="globals",re=[jt,Bt,qt,Ft,Kt,Ut,Ht,Gt,Wt,zt,Qt,Xt,Yt],ie=[jt,Bt,qt,$t,Kt,Ut,Ht,Gt,Wt,zt,Qt,Xt,Yt,ee],se=ie,oe=[...se,Jt,Zt,te];function ae(t){let e=0;for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function ce(t,e){for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function ue(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}class he{constructor(t,e){this.comparator=t,this.root=e||de.EMPTY}insert(t,e){return new he(this.comparator,this.root.insert(t,e,this.comparator).copy(null,null,de.BLACK,null,null))}remove(t){return new he(this.comparator,this.root.remove(t,this.comparator).copy(null,null,de.BLACK,null,null))}get(t){let e=this.root;for(;!e.isEmpty();){const n=this.comparator(t,e.key);if(0===n)return e.value;n<0?e=e.left:n>0&&(e=e.right)}return null}indexOf(t){let e=0,n=this.root;for(;!n.isEmpty();){const r=this.comparator(t,n.key);if(0===r)return e+n.left.size;r<0?n=n.left:(e+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(t){return this.root.inorderTraversal(t)}forEach(t){this.inorderTraversal((e,n)=>(t(e,n),!1))}toString(){const t=[];return this.inorderTraversal((e,n)=>(t.push(`${e}:${n}`),!1)),`{${t.join(", ")}}`}reverseTraversal(t){return this.root.reverseTraversal(t)}getIterator(){return new le(this.root,null,this.comparator,!1)}getIteratorFrom(t){return new le(this.root,t,this.comparator,!1)}getReverseIterator(){return new le(this.root,null,this.comparator,!0)}getReverseIteratorFrom(t){return new le(this.root,t,this.comparator,!0)}}class le{constructor(t,e,n,r){this.isReverse=r,this.nodeStack=[];let i=1;for(;!t.isEmpty();)if(i=e?n(t.key,e):1,e&&r&&(i*=-1),i<0)t=this.isReverse?t.left:t.right;else{if(0===i){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}getNext(){let t=this.nodeStack.pop();const e={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return e}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}}}class de{constructor(t,e,n,r,i){this.key=t,this.value=e,this.color=null!=n?n:de.RED,this.left=null!=r?r:de.EMPTY,this.right=null!=i?i:de.EMPTY,this.size=this.left.size+1+this.right.size}copy(t,e,n,r,i){return new de(null!=t?t:this.key,null!=e?e:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,e,n){let r=this;const i=n(t,r.key);return r=i<0?r.copy(null,null,null,r.left.insert(t,e,n),null):0===i?r.copy(null,e,null,null,null):r.copy(null,null,null,null,r.right.insert(t,e,n)),r.fixUp()}removeMin(){if(this.left.isEmpty())return de.EMPTY;let t=this;return t.left.isRed()||t.left.left.isRed()||(t=t.moveRedLeft()),t=t.copy(null,null,null,t.left.removeMin(),null),t.fixUp()}remove(t,e){let n,r=this;if(e(t,r.key)<0)r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(t,e),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),0===e(t,r.key)){if(r.right.isEmpty())return de.EMPTY;n=r.right.min(),r=r.copy(n.key,n.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(t,e))}return r.fixUp()}isRed(){return this.color}fixUp(){let t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t}moveRedLeft(){let t=this.colorFlip();return t.right.left.isRed()&&(t=t.copy(null,null,null,null,t.right.rotateRight()),t=t.rotateLeft(),t=t.colorFlip()),t}moveRedRight(){let t=this.colorFlip();return t.left.left.isRed()&&(t=t.rotateRight(),t=t.colorFlip()),t}rotateLeft(){const t=this.copy(null,null,de.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight(){const t=this.copy(null,null,de.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip(){const t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)}checkMaxDepth(){const t=this.check();return Math.pow(2,t)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw R(43730,{key:this.key,value:this.value});if(this.right.isRed())throw R(14113,{key:this.key,value:this.value});const t=this.left.check();if(t!==this.right.check())throw R(27949);return t+(this.isRed()?0:1)}}de.EMPTY=null,de.RED=!0,de.BLACK=!1,de.EMPTY=new class{constructor(){this.size=0}get key(){throw R(57766)}get value(){throw R(16141)}get color(){throw R(16727)}get left(){throw R(29726)}get right(){throw R(36894)}copy(t,e,n,r,i){return this}insert(t,e,n){return new de(t,e)}remove(t,e){return this}isEmpty(){return!0}inorderTraversal(t){return!1}reverseTraversal(t){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class fe{constructor(t){this.comparator=t,this.data=new he(this.comparator)}has(t){return null!==this.data.get(t)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(t){return this.data.indexOf(t)}forEach(t){this.data.inorderTraversal((e,n)=>(t(e),!1))}forEachInRange(t,e){const n=this.data.getIteratorFrom(t[0]);for(;n.hasNext();){const r=n.getNext();if(this.comparator(r.key,t[1])>=0)return;e(r.key)}}forEachWhile(t,e){let n;for(n=void 0!==e?this.data.getIteratorFrom(e):this.data.getIterator();n.hasNext();)if(!t(n.getNext().key))return}firstAfterOrEqual(t){const e=this.data.getIteratorFrom(t);return e.hasNext()?e.getNext().key:null}getIterator(){return new pe(this.data.getIterator())}getIteratorFrom(t){return new pe(this.data.getIteratorFrom(t))}add(t){return this.copy(this.data.remove(t).insert(t,!0))}delete(t){return this.has(t)?this.copy(this.data.remove(t)):this}isEmpty(){return this.data.isEmpty()}unionWith(t){let e=this;return e.size<t.size&&(e=t,t=this),t.forEach(t=>{e=e.add(t)}),e}isEqual(t){if(!(t instanceof fe))return!1;if(this.size!==t.size)return!1;const e=this.data.getIterator(),n=t.data.getIterator();for(;e.hasNext();){const t=e.getNext().key,r=n.getNext().key;if(0!==this.comparator(t,r))return!1}return!0}toArray(){const t=[];return this.forEach(e=>{t.push(e)}),t}toString(){const t=[];return this.forEach(e=>t.push(e)),"SortedSet("+t.toString()+")"}copy(t){const e=new fe(this.comparator);return e.data=t,e}}class pe{constructor(t){this.iter=t}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}class ge{constructor(t){this.fields=t,t.sort(rt.comparator)}static empty(){return new ge([])}unionWith(t){let e=new fe(rt.comparator);for(const n of this.fields)e=e.add(n);for(const n of t)e=e.add(n);return new ge(e.toArray())}covers(t){for(const e of this.fields)if(e.isPrefixOf(t))return!0;return!1}isEqual(t){return J(this.fields,t.fields,(t,e)=>t.isEqual(e))}}class me extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class ye{constructor(t){this.binaryString=t}static fromBase64String(t){const e=function(t){try{return atob(t)}catch(t){throw"undefined"!=typeof DOMException&&t instanceof DOMException?new me("Invalid base64 string: "+t):t}}(t);return new ye(e)}static fromUint8Array(t){const e=function(t){let e="";for(let n=0;n<t.length;++n)e+=String.fromCharCode(t[n]);return e}(t);return new ye(e)}[Symbol.iterator](){let t=0;return{next:()=>t<this.binaryString.length?{value:this.binaryString.charCodeAt(t++),done:!1}:{value:void 0,done:!0}}}toBase64(){return t=this.binaryString,btoa(t);var t}toUint8Array(){return function(t){const e=new Uint8Array(t.length);for(let n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(t){return H(this.binaryString,t.binaryString)}isEqual(t){return this.binaryString===t.binaryString}}ye.EMPTY_BYTE_STRING=new ye("");const we=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function ve(t){if(O(!!t,39018),"string"==typeof t){let e=0;const n=we.exec(t);if(O(!!n,46558,{timestamp:t}),n[1]){let t=n[1];t=(t+"000000000").substr(0,9),e=Number(t)}const r=new Date(t);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:be(t.seconds),nanos:be(t.nanos)}}function be(t){return"number"==typeof t?t:"string"==typeof t?Number(t):0}function Ee(t){return"string"==typeof t?ye.fromBase64String(t):ye.fromUint8Array(t)}const Te="server_timestamp",_e="__type__",Ie="__previous_value__",Se="__local_write_time__";function Ce(t){const e=(t?.mapValue?.fields||{})[_e]?.stringValue;return e===Te}function Ae(t){const e=t.mapValue.fields[Ie];return Ce(e)?Ae(e):e}function De(t){const e=ve(t.mapValue.fields[Se].timestampValue);return new gt(e.seconds,e.nanos)}class Ne{constructor(t,e,n,r,i,s,o,a,c,u){this.databaseId=t,this.appId=e,this.persistenceKey=n,this.host=r,this.ssl=i,this.forceLongPolling=s,this.autoDetectLongPolling=o,this.longPollingOptions=a,this.useFetchStreams=c,this.isUsingEmulator=u}}const ke="(default)";class Re{constructor(t,e){this.projectId=t,this.database=e||ke}static empty(){return new Re("","")}get isDefaultDatabase(){return this.database===ke}isEqual(t){return t instanceof Re&&t.projectId===this.projectId&&t.database===this.database}}const xe="__type__",Oe="__max__",Me={mapValue:{fields:{__type__:{stringValue:Oe}}}},Le="__vector__",Pe="value";function Ve(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?Ce(t)?4:tn(t)?9007199254740991:Je(t)?10:11:R(28295,{value:t})}function Fe(t,e){if(t===e)return!0;const n=Ve(t);if(n!==Ve(e))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return De(t).isEqual(De(e));case 3:return function(t,e){if("string"==typeof t.timestampValue&&"string"==typeof e.timestampValue&&t.timestampValue.length===e.timestampValue.length)return t.timestampValue===e.timestampValue;const n=ve(t.timestampValue),r=ve(e.timestampValue);return n.seconds===r.seconds&&n.nanos===r.nanos}(t,e);case 5:return t.stringValue===e.stringValue;case 6:return function(t,e){return Ee(t.bytesValue).isEqual(Ee(e.bytesValue))}(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return function(t,e){return be(t.geoPointValue.latitude)===be(e.geoPointValue.latitude)&&be(t.geoPointValue.longitude)===be(e.geoPointValue.longitude)}(t,e);case 2:return function(t,e){if("integerValue"in t&&"integerValue"in e)return be(t.integerValue)===be(e.integerValue);if("doubleValue"in t&&"doubleValue"in e){const n=be(t.doubleValue),r=be(e.doubleValue);return n===r?xt(n)===xt(r):isNaN(n)&&isNaN(r)}return!1}(t,e);case 9:return J(t.arrayValue.values||[],e.arrayValue.values||[],Fe);case 10:case 11:return function(t,e){const n=t.mapValue.fields||{},r=e.mapValue.fields||{};if(ae(n)!==ae(r))return!1;for(const i in n)if(n.hasOwnProperty(i)&&(void 0===r[i]||!Fe(n[i],r[i])))return!1;return!0}(t,e);default:return R(52216,{left:t})}}function Ue(t,e){return void 0!==(t.values||[]).find(t=>Fe(t,e))}function je(t,e){if(t===e)return 0;const n=Ve(t),r=Ve(e);if(n!==r)return H(n,r);switch(n){case 0:case 9007199254740991:return 0;case 1:return H(t.booleanValue,e.booleanValue);case 2:return function(t,e){const n=be(t.integerValue||t.doubleValue),r=be(e.integerValue||e.doubleValue);return n<r?-1:n>r?1:n===r?0:isNaN(n)?isNaN(r)?0:-1:1}(t,e);case 3:return Be(t.timestampValue,e.timestampValue);case 4:return Be(De(t),De(e));case 5:return Q(t.stringValue,e.stringValue);case 6:return function(t,e){const n=Ee(t),r=Ee(e);return n.compareTo(r)}(t.bytesValue,e.bytesValue);case 7:return function(t,e){const n=t.split("/"),r=e.split("/");for(let i=0;i<n.length&&i<r.length;i++){const t=H(n[i],r[i]);if(0!==t)return t}return H(n.length,r.length)}(t.referenceValue,e.referenceValue);case 8:return function(t,e){const n=H(be(t.latitude),be(e.latitude));return 0!==n?n:H(be(t.longitude),be(e.longitude))}(t.geoPointValue,e.geoPointValue);case 9:return qe(t.arrayValue,e.arrayValue);case 10:return function(t,e){const n=t.fields||{},r=e.fields||{},i=n[Pe]?.arrayValue,s=r[Pe]?.arrayValue,o=H(i?.values?.length||0,s?.values?.length||0);return 0!==o?o:qe(i,s)}(t.mapValue,e.mapValue);case 11:return function(t,e){if(t===Me.mapValue&&e===Me.mapValue)return 0;if(t===Me.mapValue)return 1;if(e===Me.mapValue)return-1;const n=t.fields||{},r=Object.keys(n),i=e.fields||{},s=Object.keys(i);r.sort(),s.sort();for(let o=0;o<r.length&&o<s.length;++o){const t=Q(r[o],s[o]);if(0!==t)return t;const e=je(n[r[o]],i[s[o]]);if(0!==e)return e}return H(r.length,s.length)}(t.mapValue,e.mapValue);default:throw R(23264,{he:n})}}function Be(t,e){if("string"==typeof t&&"string"==typeof e&&t.length===e.length)return H(t,e);const n=ve(t),r=ve(e),i=H(n.seconds,r.seconds);return 0!==i?i:H(n.nanos,r.nanos)}function qe(t,e){const n=t.values||[],r=e.values||[];for(let i=0;i<n.length&&i<r.length;++i){const t=je(n[i],r[i]);if(t)return t}return H(n.length,r.length)}function $e(t){return ze(t)}function ze(t){return"nullValue"in t?"null":"booleanValue"in t?""+t.booleanValue:"integerValue"in t?""+t.integerValue:"doubleValue"in t?""+t.doubleValue:"timestampValue"in t?function(t){const e=ve(t);return`time(${e.seconds},${e.nanos})`}(t.timestampValue):"stringValue"in t?t.stringValue:"bytesValue"in t?function(t){return Ee(t).toBase64()}(t.bytesValue):"referenceValue"in t?function(t){return it.fromName(t).toString()}(t.referenceValue):"geoPointValue"in t?function(t){return`geo(${t.latitude},${t.longitude})`}(t.geoPointValue):"arrayValue"in t?function(t){let e="[",n=!0;for(const r of t.values||[])n?n=!1:e+=",",e+=ze(r);return e+"]"}(t.arrayValue):"mapValue"in t?function(t){const e=Object.keys(t.fields||{}).sort();let n="{",r=!0;for(const i of e)r?r=!1:n+=",",n+=`${i}:${ze(t.fields[i])}`;return n+"}"}(t.mapValue):R(61005,{value:t})}function Ke(t){switch(Ve(t)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=Ae(t);return e?16+Ke(e):16;case 5:return 2*t.stringValue.length;case 6:return Ee(t.bytesValue).approximateByteSize();case 7:return t.referenceValue.length;case 9:return function(t){return(t.values||[]).reduce((t,e)=>t+Ke(e),0)}(t.arrayValue);case 10:case 11:return function(t){let e=0;return ce(t.fields,(t,n)=>{e+=t.length+Ke(n)}),e}(t.mapValue);default:throw R(13486,{value:t})}}function Ge(t,e){return{referenceValue:`projects/${t.projectId}/databases/${t.database}/documents/${e.path.canonicalString()}`}}function He(t){return!!t&&"integerValue"in t}function Qe(t){return!!t&&"arrayValue"in t}function We(t){return!!t&&"nullValue"in t}function Xe(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function Ye(t){return!!t&&"mapValue"in t}function Je(t){const e=(t?.mapValue?.fields||{})[xe]?.stringValue;return e===Le}function Ze(t){if(t.geoPointValue)return{geoPointValue:{...t.geoPointValue}};if(t.timestampValue&&"object"==typeof t.timestampValue)return{timestampValue:{...t.timestampValue}};if(t.mapValue){const e={mapValue:{fields:{}}};return ce(t.mapValue.fields,(t,n)=>e.mapValue.fields[t]=Ze(n)),e}if(t.arrayValue){const e={arrayValue:{values:[]}};for(let n=0;n<(t.arrayValue.values||[]).length;++n)e.arrayValue.values[n]=Ze(t.arrayValue.values[n]);return e}return{...t}}function tn(t){return(((t.mapValue||{}).fields||{}).__type__||{}).stringValue===Oe}class en{constructor(t){this.value=t}static empty(){return new en({mapValue:{}})}field(t){if(t.isEmpty())return this.value;{let e=this.value;for(let n=0;n<t.length-1;++n)if(e=(e.mapValue.fields||{})[t.get(n)],!Ye(e))return null;return e=(e.mapValue.fields||{})[t.lastSegment()],e||null}}set(t,e){this.getFieldsMap(t.popLast())[t.lastSegment()]=Ze(e)}setAll(t){let e=rt.emptyPath(),n={},r=[];t.forEach((t,i)=>{if(!e.isImmediateParentOf(i)){const t=this.getFieldsMap(e);this.applyChanges(t,n,r),n={},r=[],e=i.popLast()}t?n[i.lastSegment()]=Ze(t):r.push(i.lastSegment())});const i=this.getFieldsMap(e);this.applyChanges(i,n,r)}delete(t){const e=this.field(t.popLast());Ye(e)&&e.mapValue.fields&&delete e.mapValue.fields[t.lastSegment()]}isEqual(t){return Fe(this.value,t.value)}getFieldsMap(t){let e=this.value;e.mapValue.fields||(e.mapValue={fields:{}});for(let n=0;n<t.length;++n){let r=e.mapValue.fields[t.get(n)];Ye(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},e.mapValue.fields[t.get(n)]=r),e=r}return e.mapValue.fields}applyChanges(t,e,n){ce(e,(e,n)=>t[e]=n);for(const r of n)delete t[r]}clone(){return new en(Ze(this.value))}}function nn(t){const e=[];return ce(t.fields,(t,n)=>{const r=new rt([t]);if(Ye(n)){const t=nn(n.mapValue).fields;if(0===t.length)e.push(r);else for(const n of t)e.push(r.child(n))}else e.push(r)}),new ge(e)}class rn{constructor(t,e,n,r,i,s,o){this.key=t,this.documentType=e,this.version=n,this.readTime=r,this.createTime=i,this.data=s,this.documentState=o}static newInvalidDocument(t){return new rn(t,0,mt.min(),mt.min(),mt.min(),en.empty(),0)}static newFoundDocument(t,e,n,r){return new rn(t,1,e,mt.min(),n,r,0)}static newNoDocument(t,e){return new rn(t,2,e,mt.min(),mt.min(),en.empty(),0)}static newUnknownDocument(t,e){return new rn(t,3,e,mt.min(),mt.min(),en.empty(),2)}convertToFoundDocument(t,e){return!this.createTime.isEqual(mt.min())||2!==this.documentType&&0!==this.documentType||(this.createTime=t),this.version=t,this.documentType=1,this.data=e,this.documentState=0,this}convertToNoDocument(t){return this.version=t,this.documentType=2,this.data=en.empty(),this.documentState=0,this}convertToUnknownDocument(t){return this.version=t,this.documentType=3,this.data=en.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=mt.min(),this}setReadTime(t){return this.readTime=t,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(t){return t instanceof rn&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.documentType===t.documentType&&this.documentState===t.documentState&&this.data.isEqual(t.data)}mutableCopy(){return new rn(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class sn{constructor(t,e){this.position=t,this.inclusive=e}}function on(t,e,n){let r=0;for(let i=0;i<t.position.length;i++){const s=e[i],o=t.position[i];if(r=s.field.isKeyField()?it.comparator(it.fromName(o.referenceValue),n.key):je(o,n.data.field(s.field)),"desc"===s.dir&&(r*=-1),0!==r)break}return r}function an(t,e){if(null===t)return null===e;if(null===e)return!1;if(t.inclusive!==e.inclusive||t.position.length!==e.position.length)return!1;for(let n=0;n<t.position.length;n++)if(!Fe(t.position[n],e.position[n]))return!1;return!0}class cn{constructor(t,e="asc"){this.field=t,this.dir=e}}function un(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}class hn{}class ln extends hn{constructor(t,e,n){super(),this.field=t,this.op=e,this.value=n}static create(t,e,n){return t.isKeyField()?"in"===e||"not-in"===e?this.createKeyFieldInFilter(t,e,n):new vn(t,e,n):"array-contains"===e?new _n(t,n):"in"===e?new In(t,n):"not-in"===e?new Sn(t,n):"array-contains-any"===e?new Cn(t,n):new ln(t,e,n)}static createKeyFieldInFilter(t,e,n){return"in"===e?new bn(t,n):new En(t,n)}matches(t){const e=t.data.field(this.field);return"!="===this.op?null!==e&&void 0===e.nullValue&&this.matchesComparison(je(e,this.value)):null!==e&&Ve(this.value)===Ve(e)&&this.matchesComparison(je(e,this.value))}matchesComparison(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return 0===t;case"!=":return 0!==t;case">":return t>0;case">=":return t>=0;default:return R(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class dn extends hn{constructor(t,e){super(),this.filters=t,this.op=e,this.Pe=null}static create(t,e){return new dn(t,e)}matches(t){return fn(this)?void 0===this.filters.find(e=>!e.matches(t)):void 0!==this.filters.find(e=>e.matches(t))}getFlattenedFilters(){return null!==this.Pe||(this.Pe=this.filters.reduce((t,e)=>t.concat(e.getFlattenedFilters()),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}}function fn(t){return"and"===t.op}function pn(t){return gn(t)&&fn(t)}function gn(t){for(const e of t.filters)if(e instanceof dn)return!1;return!0}function mn(t){if(t instanceof ln)return t.field.canonicalString()+t.op.toString()+$e(t.value);if(pn(t))return t.filters.map(t=>mn(t)).join(",");{const e=t.filters.map(t=>mn(t)).join(",");return`${t.op}(${e})`}}function yn(t,e){return t instanceof ln?function(t,e){return e instanceof ln&&t.op===e.op&&t.field.isEqual(e.field)&&Fe(t.value,e.value)}(t,e):t instanceof dn?function(t,e){return e instanceof dn&&t.op===e.op&&t.filters.length===e.filters.length&&t.filters.reduce((t,n,r)=>t&&yn(n,e.filters[r]),!0)}(t,e):void R(19439)}function wn(t){return t instanceof ln?function(t){return`${t.field.canonicalString()} ${t.op} ${$e(t.value)}`}(t):t instanceof dn?function(t){return t.op.toString()+" {"+t.getFilters().map(wn).join(" ,")+"}"}(t):"Filter"}class vn extends ln{constructor(t,e,n){super(t,e,n),this.key=it.fromName(n.referenceValue)}matches(t){const e=it.comparator(t.key,this.key);return this.matchesComparison(e)}}class bn extends ln{constructor(t,e){super(t,"in",e),this.keys=Tn("in",e)}matches(t){return this.keys.some(e=>e.isEqual(t.key))}}class En extends ln{constructor(t,e){super(t,"not-in",e),this.keys=Tn("not-in",e)}matches(t){return!this.keys.some(e=>e.isEqual(t.key))}}function Tn(t,e){return(e.arrayValue?.values||[]).map(t=>it.fromName(t.referenceValue))}class _n extends ln{constructor(t,e){super(t,"array-contains",e)}matches(t){const e=t.data.field(this.field);return Qe(e)&&Ue(e.arrayValue,this.value)}}class In extends ln{constructor(t,e){super(t,"in",e)}matches(t){const e=t.data.field(this.field);return null!==e&&Ue(this.value.arrayValue,e)}}class Sn extends ln{constructor(t,e){super(t,"not-in",e)}matches(t){if(Ue(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const e=t.data.field(this.field);return null!==e&&void 0===e.nullValue&&!Ue(this.value.arrayValue,e)}}class Cn extends ln{constructor(t,e){super(t,"array-contains-any",e)}matches(t){const e=t.data.field(this.field);return!(!Qe(e)||!e.arrayValue.values)&&e.arrayValue.values.some(t=>Ue(this.value.arrayValue,t))}}class An{constructor(t,e=null,n=[],r=[],i=null,s=null,o=null){this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=s,this.endAt=o,this.Te=null}}function Dn(t,e=null,n=[],r=[],i=null,s=null,o=null){return new An(t,e,n,r,i,s,o)}function Nn(t){const e=M(t);if(null===e.Te){let t=e.path.canonicalString();null!==e.collectionGroup&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(t=>mn(t)).join(","),t+="|ob:",t+=e.orderBy.map(t=>function(t){return t.field.canonicalString()+t.dir}(t)).join(","),Rt(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(t=>$e(t)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(t=>$e(t)).join(",")),e.Te=t}return e.Te}function kn(t,e){if(t.limit!==e.limit)return!1;if(t.orderBy.length!==e.orderBy.length)return!1;for(let n=0;n<t.orderBy.length;n++)if(!un(t.orderBy[n],e.orderBy[n]))return!1;if(t.filters.length!==e.filters.length)return!1;for(let n=0;n<t.filters.length;n++)if(!yn(t.filters[n],e.filters[n]))return!1;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!an(t.startAt,e.startAt)&&an(t.endAt,e.endAt)}function Rn(t){return it.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}class xn{constructor(t,e=null,n=[],r=[],i=null,s="F",o=null,a=null){this.path=t,this.collectionGroup=e,this.explicitOrderBy=n,this.filters=r,this.limit=i,this.limitType=s,this.startAt=o,this.endAt=a,this.Ie=null,this.Ee=null,this.de=null,this.startAt,this.endAt}}function On(t,e,n,r,i,s,o,a){return new xn(t,e,n,r,i,s,o,a)}function Mn(t){return new xn(t)}function Ln(t){return 0===t.filters.length&&null===t.limit&&null==t.startAt&&null==t.endAt&&(0===t.explicitOrderBy.length||1===t.explicitOrderBy.length&&t.explicitOrderBy[0].field.isKeyField())}function Pn(t){return null!==t.collectionGroup}function Vn(t){const e=M(t);if(null===e.Ie){e.Ie=[];const t=new Set;for(const i of e.explicitOrderBy)e.Ie.push(i),t.add(i.field.canonicalString());const n=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc",r=function(t){let e=new fe(rt.comparator);return t.filters.forEach(t=>{t.getFlattenedFilters().forEach(t=>{t.isInequality()&&(e=e.add(t.field))})}),e}(e);r.forEach(r=>{t.has(r.canonicalString())||r.isKeyField()||e.Ie.push(new cn(r,n))}),t.has(rt.keyField().canonicalString())||e.Ie.push(new cn(rt.keyField(),n))}return e.Ie}function Fn(t){const e=M(t);return e.Ee||(e.Ee=Un(e,Vn(t))),e.Ee}function Un(t,e){if("F"===t.limitType)return Dn(t.path,t.collectionGroup,e,t.filters,t.limit,t.startAt,t.endAt);{e=e.map(t=>{const e="desc"===t.dir?"asc":"desc";return new cn(t.field,e)});const n=t.endAt?new sn(t.endAt.position,t.endAt.inclusive):null,r=t.startAt?new sn(t.startAt.position,t.startAt.inclusive):null;return Dn(t.path,t.collectionGroup,e,t.filters,t.limit,n,r)}}function jn(t,e){const n=t.filters.concat([e]);return new xn(t.path,t.collectionGroup,t.explicitOrderBy.slice(),n,t.limit,t.limitType,t.startAt,t.endAt)}function Bn(t,e,n){return new xn(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function qn(t,e){return kn(Fn(t),Fn(e))&&t.limitType===e.limitType}function $n(t){return`${Nn(Fn(t))}|lt:${t.limitType}`}function zn(t){return`Query(target=${function(t){let e=t.path.canonicalString();return null!==t.collectionGroup&&(e+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(e+=`, filters: [${t.filters.map(t=>wn(t)).join(", ")}]`),Rt(t.limit)||(e+=", limit: "+t.limit),t.orderBy.length>0&&(e+=`, orderBy: [${t.orderBy.map(t=>function(t){return`${t.field.canonicalString()} (${t.dir})`}(t)).join(", ")}]`),t.startAt&&(e+=", startAt: ",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map(t=>$e(t)).join(",")),t.endAt&&(e+=", endAt: ",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map(t=>$e(t)).join(",")),`Target(${e})`}(Fn(t))}; limitType=${t.limitType})`}function Kn(t,e){return e.isFoundDocument()&&function(t,e){const n=e.key.path;return null!==t.collectionGroup?e.key.hasCollectionId(t.collectionGroup)&&t.path.isPrefixOf(n):it.isDocumentKey(t.path)?t.path.isEqual(n):t.path.isImmediateParentOf(n)}(t,e)&&function(t,e){for(const n of Vn(t))if(!n.field.isKeyField()&&null===e.data.field(n.field))return!1;return!0}(t,e)&&function(t,e){for(const n of t.filters)if(!n.matches(e))return!1;return!0}(t,e)&&function(t,e){return!(t.startAt&&!function(t,e,n){const r=on(t,e,n);return t.inclusive?r<=0:r<0}(t.startAt,Vn(t),e))&&!(t.endAt&&!function(t,e,n){const r=on(t,e,n);return t.inclusive?r>=0:r>0}(t.endAt,Vn(t),e))}(t,e)}function Gn(t){return t.collectionGroup||(t.path.length%2==1?t.path.lastSegment():t.path.get(t.path.length-2))}function Hn(t){return(e,n)=>{let r=!1;for(const i of Vn(t)){const t=Qn(i,e,n);if(0!==t)return t;r=r||i.field.isKeyField()}return 0}}function Qn(t,e,n){const r=t.field.isKeyField()?it.comparator(e.key,n.key):function(t,e,n){const r=e.data.field(t),i=n.data.field(t);return null!==r&&null!==i?je(r,i):R(42886)}(t.field,e,n);switch(t.dir){case"asc":return r;case"desc":return-1*r;default:return R(19790,{direction:t.dir})}}class Wn{constructor(t,e){this.mapKeyFn=t,this.equalsFn=e,this.inner={},this.innerSize=0}get(t){const e=this.mapKeyFn(t),n=this.inner[e];if(void 0!==n)for(const[r,i]of n)if(this.equalsFn(r,t))return i}has(t){return void 0!==this.get(t)}set(t,e){const n=this.mapKeyFn(t),r=this.inner[n];if(void 0===r)return this.inner[n]=[[t,e]],void this.innerSize++;for(let i=0;i<r.length;i++)if(this.equalsFn(r[i][0],t))return void(r[i]=[t,e]);r.push([t,e]),this.innerSize++}delete(t){const e=this.mapKeyFn(t),n=this.inner[e];if(void 0===n)return!1;for(let r=0;r<n.length;r++)if(this.equalsFn(n[r][0],t))return 1===n.length?delete this.inner[e]:n.splice(r,1),this.innerSize--,!0;return!1}forEach(t){ce(this.inner,(e,n)=>{for(const[r,i]of n)t(r,i)})}isEmpty(){return ue(this.inner)}size(){return this.innerSize}}const Xn=new he(it.comparator);function Yn(){return Xn}const Jn=new he(it.comparator);function Zn(...t){let e=Jn;for(const n of t)e=e.insert(n.key,n);return e}function tr(t){let e=Jn;return t.forEach((t,n)=>e=e.insert(t,n.overlayedDocument)),e}function er(){return rr()}function nr(){return rr()}function rr(){return new Wn(t=>t.toString(),(t,e)=>t.isEqual(e))}const ir=new he(it.comparator),sr=new fe(it.comparator);function or(...t){let e=sr;for(const n of t)e=e.add(n);return e}const ar=new fe(H);function cr(){return ar}function ur(t,e){if(t.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:xt(e)?"-0":e}}function hr(t){return{integerValue:""+t}}function lr(t,e){return Ot(e)?hr(e):ur(t,e)}class dr{constructor(){this._=void 0}}function fr(t,e,n){return t instanceof mr?function(t,e){const n={fields:{[_e]:{stringValue:Te},[Se]:{timestampValue:{seconds:t.seconds,nanos:t.nanoseconds}}}};return e&&Ce(e)&&(e=Ae(e)),e&&(n.fields[Ie]=e),{mapValue:n}}(n,e):t instanceof yr?wr(t,e):t instanceof vr?br(t,e):function(t,e){const n=gr(t,e),r=Tr(n)+Tr(t.Ae);return He(n)&&He(t.Ae)?hr(r):ur(t.serializer,r)}(t,e)}function pr(t,e,n){return t instanceof yr?wr(t,e):t instanceof vr?br(t,e):n}function gr(t,e){return t instanceof Er?function(t){return He(t)||function(t){return!!t&&"doubleValue"in t}(t)}(e)?e:{integerValue:0}:null}class mr extends dr{}class yr extends dr{constructor(t){super(),this.elements=t}}function wr(t,e){const n=_r(e);for(const r of t.elements)n.some(t=>Fe(t,r))||n.push(r);return{arrayValue:{values:n}}}class vr extends dr{constructor(t){super(),this.elements=t}}function br(t,e){let n=_r(e);for(const r of t.elements)n=n.filter(t=>!Fe(t,r));return{arrayValue:{values:n}}}class Er extends dr{constructor(t,e){super(),this.serializer=t,this.Ae=e}}function Tr(t){return be(t.integerValue||t.doubleValue)}function _r(t){return Qe(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}class Ir{constructor(t,e){this.version=t,this.transformResults=e}}class Sr{constructor(t,e){this.updateTime=t,this.exists=e}static none(){return new Sr}static exists(t){return new Sr(void 0,t)}static updateTime(t){return new Sr(t)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)}}function Cr(t,e){return void 0!==t.updateTime?e.isFoundDocument()&&e.version.isEqual(t.updateTime):void 0===t.exists||t.exists===e.isFoundDocument()}class Ar{}function Dr(t,e){if(!t.hasLocalMutations||e&&0===e.fields.length)return null;if(null===e)return t.isNoDocument()?new Fr(t.key,Sr.none()):new Or(t.key,t.data,Sr.none());{const n=t.data,r=en.empty();let i=new fe(rt.comparator);for(let t of e.fields)if(!i.has(t)){let e=n.field(t);null===e&&t.length>1&&(t=t.popLast(),e=n.field(t)),null===e?r.delete(t):r.set(t,e),i=i.add(t)}return new Mr(t.key,r,new ge(i.toArray()),Sr.none())}}function Nr(t,e,n){t instanceof Or?function(t,e,n){const r=t.value.clone(),i=Pr(t.fieldTransforms,e,n.transformResults);r.setAll(i),e.convertToFoundDocument(n.version,r).setHasCommittedMutations()}(t,e,n):t instanceof Mr?function(t,e,n){if(!Cr(t.precondition,e))return void e.convertToUnknownDocument(n.version);const r=Pr(t.fieldTransforms,e,n.transformResults),i=e.data;i.setAll(Lr(t)),i.setAll(r),e.convertToFoundDocument(n.version,i).setHasCommittedMutations()}(t,e,n):function(t,e,n){e.convertToNoDocument(n.version).setHasCommittedMutations()}(0,e,n)}function kr(t,e,n,r){return t instanceof Or?function(t,e,n,r){if(!Cr(t.precondition,e))return n;const i=t.value.clone(),s=Vr(t.fieldTransforms,r,e);return i.setAll(s),e.convertToFoundDocument(e.version,i).setHasLocalMutations(),null}(t,e,n,r):t instanceof Mr?function(t,e,n,r){if(!Cr(t.precondition,e))return n;const i=Vr(t.fieldTransforms,r,e),s=e.data;return s.setAll(Lr(t)),s.setAll(i),e.convertToFoundDocument(e.version,s).setHasLocalMutations(),null===n?null:n.unionWith(t.fieldMask.fields).unionWith(t.fieldTransforms.map(t=>t.field))}(t,e,n,r):function(t,e,n){return Cr(t.precondition,e)?(e.convertToNoDocument(e.version).setHasLocalMutations(),null):n}(t,e,n)}function Rr(t,e){let n=null;for(const r of t.fieldTransforms){const t=e.data.field(r.field),i=gr(r.transform,t||null);null!=i&&(null===n&&(n=en.empty()),n.set(r.field,i))}return n||null}function xr(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.precondition.isEqual(e.precondition)&&!!function(t,e){return void 0===t&&void 0===e||!(!t||!e)&&J(t,e,(t,e)=>function(t,e){return t.field.isEqual(e.field)&&function(t,e){return t instanceof yr&&e instanceof yr||t instanceof vr&&e instanceof vr?J(t.elements,e.elements,Fe):t instanceof Er&&e instanceof Er?Fe(t.Ae,e.Ae):t instanceof mr&&e instanceof mr}(t.transform,e.transform)}(t,e))}(t.fieldTransforms,e.fieldTransforms)&&(0===t.type?t.value.isEqual(e.value):1!==t.type||t.data.isEqual(e.data)&&t.fieldMask.isEqual(e.fieldMask))}class Or extends Ar{constructor(t,e,n,r=[]){super(),this.key=t,this.value=e,this.precondition=n,this.fieldTransforms=r,this.type=0}getFieldMask(){return null}}class Mr extends Ar{constructor(t,e,n,r,i=[]){super(),this.key=t,this.data=e,this.fieldMask=n,this.precondition=r,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function Lr(t){const e=new Map;return t.fieldMask.fields.forEach(n=>{if(!n.isEmpty()){const r=t.data.field(n);e.set(n,r)}}),e}function Pr(t,e,n){const r=new Map;O(t.length===n.length,32656,{Re:n.length,Ve:t.length});for(let i=0;i<n.length;i++){const s=t[i],o=s.transform,a=e.data.field(s.field);r.set(s.field,pr(o,a,n[i]))}return r}function Vr(t,e,n){const r=new Map;for(const i of t){const t=i.transform,s=n.data.field(i.field);r.set(i.field,fr(t,s,e))}return r}class Fr extends Ar{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class Ur extends Ar{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class jr{constructor(t,e,n,r){this.batchId=t,this.localWriteTime=e,this.baseMutations=n,this.mutations=r}applyToRemoteDocument(t,e){const n=e.mutationResults;for(let r=0;r<this.mutations.length;r++){const e=this.mutations[r];e.key.isEqual(t.key)&&Nr(e,t,n[r])}}applyToLocalView(t,e){for(const n of this.baseMutations)n.key.isEqual(t.key)&&(e=kr(n,t,e,this.localWriteTime));for(const n of this.mutations)n.key.isEqual(t.key)&&(e=kr(n,t,e,this.localWriteTime));return e}applyToLocalDocumentSet(t,e){const n=nr();return this.mutations.forEach(r=>{const i=t.get(r.key),s=i.overlayedDocument;let o=this.applyToLocalView(s,i.mutatedFields);o=e.has(r.key)?null:o;const a=Dr(s,o);null!==a&&n.set(r.key,a),s.isValidDocument()||s.convertToNoDocument(mt.min())}),n}keys(){return this.mutations.reduce((t,e)=>t.add(e.key),or())}isEqual(t){return this.batchId===t.batchId&&J(this.mutations,t.mutations,(t,e)=>xr(t,e))&&J(this.baseMutations,t.baseMutations,(t,e)=>xr(t,e))}}class Br{constructor(t,e,n,r){this.batch=t,this.commitVersion=e,this.mutationResults=n,this.docVersions=r}static from(t,e,n){O(t.mutations.length===n.length,58842,{me:t.mutations.length,fe:n.length});let r=ir;const i=t.mutations;for(let s=0;s<i.length;s++)r=r.insert(i[s].key,n[s].version);return new Br(t,e,n,r)}}class qr{constructor(t,e){this.largestBatchId=t,this.mutation=e}getKey(){return this.mutation.key}isEqual(t){return null!==t&&this.mutation===t.mutation}toString(){return`Overlay{\n      largestBatchId: ${this.largestBatchId},\n      mutation: ${this.mutation.toString()}\n    }`}}class $r{constructor(t,e){this.count=t,this.unchangedNames=e}}var zr,Kr;function Gr(t){switch(t){case L.OK:return R(64938);case L.CANCELLED:case L.UNKNOWN:case L.DEADLINE_EXCEEDED:case L.RESOURCE_EXHAUSTED:case L.INTERNAL:case L.UNAVAILABLE:case L.UNAUTHENTICATED:return!1;case L.INVALID_ARGUMENT:case L.NOT_FOUND:case L.ALREADY_EXISTS:case L.PERMISSION_DENIED:case L.FAILED_PRECONDITION:case L.ABORTED:case L.OUT_OF_RANGE:case L.UNIMPLEMENTED:case L.DATA_LOSS:return!0;default:return R(15467,{code:t})}}function Hr(t){if(void 0===t)return D("GRPC error has no .code"),L.UNKNOWN;switch(t){case zr.OK:return L.OK;case zr.CANCELLED:return L.CANCELLED;case zr.UNKNOWN:return L.UNKNOWN;case zr.DEADLINE_EXCEEDED:return L.DEADLINE_EXCEEDED;case zr.RESOURCE_EXHAUSTED:return L.RESOURCE_EXHAUSTED;case zr.INTERNAL:return L.INTERNAL;case zr.UNAVAILABLE:return L.UNAVAILABLE;case zr.UNAUTHENTICATED:return L.UNAUTHENTICATED;case zr.INVALID_ARGUMENT:return L.INVALID_ARGUMENT;case zr.NOT_FOUND:return L.NOT_FOUND;case zr.ALREADY_EXISTS:return L.ALREADY_EXISTS;case zr.PERMISSION_DENIED:return L.PERMISSION_DENIED;case zr.FAILED_PRECONDITION:return L.FAILED_PRECONDITION;case zr.ABORTED:return L.ABORTED;case zr.OUT_OF_RANGE:return L.OUT_OF_RANGE;case zr.UNIMPLEMENTED:return L.UNIMPLEMENTED;case zr.DATA_LOSS:return L.DATA_LOSS;default:return R(39323,{code:t})}}(Kr=zr||(zr={}))[Kr.OK=0]="OK",Kr[Kr.CANCELLED=1]="CANCELLED",Kr[Kr.UNKNOWN=2]="UNKNOWN",Kr[Kr.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Kr[Kr.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Kr[Kr.NOT_FOUND=5]="NOT_FOUND",Kr[Kr.ALREADY_EXISTS=6]="ALREADY_EXISTS",Kr[Kr.PERMISSION_DENIED=7]="PERMISSION_DENIED",Kr[Kr.UNAUTHENTICATED=16]="UNAUTHENTICATED",Kr[Kr.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Kr[Kr.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Kr[Kr.ABORTED=10]="ABORTED",Kr[Kr.OUT_OF_RANGE=11]="OUT_OF_RANGE",Kr[Kr.UNIMPLEMENTED=12]="UNIMPLEMENTED",Kr[Kr.INTERNAL=13]="INTERNAL",Kr[Kr.UNAVAILABLE=14]="UNAVAILABLE",Kr[Kr.DATA_LOSS=15]="DATA_LOSS";let Qr=null;function Wr(){return new TextEncoder}const Xr=new r([4294967295,4294967295],0);function Yr(t){const e=Wr().encode(t),n=new i;return n.update(e),new Uint8Array(n.digest())}function Jr(t){const e=new DataView(t.buffer),n=e.getUint32(0,!0),i=e.getUint32(4,!0),s=e.getUint32(8,!0),o=e.getUint32(12,!0);return[new r([n,i],0),new r([s,o],0)]}class Zr{constructor(t,e,n){if(this.bitmap=t,this.padding=e,this.hashCount=n,e<0||e>=8)throw new ti(`Invalid padding: ${e}`);if(n<0)throw new ti(`Invalid hash count: ${n}`);if(t.length>0&&0===this.hashCount)throw new ti(`Invalid hash count: ${n}`);if(0===t.length&&0!==e)throw new ti(`Invalid padding when bitmap length is 0: ${e}`);this.ge=8*t.length-e,this.pe=r.fromNumber(this.ge)}ye(t,e,n){let i=t.add(e.multiply(r.fromNumber(n)));return 1===i.compare(Xr)&&(i=new r([i.getBits(0),i.getBits(1)],0)),i.modulo(this.pe).toNumber()}we(t){return!!(this.bitmap[Math.floor(t/8)]&1<<t%8)}mightContain(t){if(0===this.ge)return!1;const e=Yr(t),[n,r]=Jr(e);for(let i=0;i<this.hashCount;i++){const t=this.ye(n,r,i);if(!this.we(t))return!1}return!0}static create(t,e,n){const r=t%8==0?0:8-t%8,i=new Uint8Array(Math.ceil(t/8)),s=new Zr(i,r,e);return n.forEach(t=>s.insert(t)),s}insert(t){if(0===this.ge)return;const e=Yr(t),[n,r]=Jr(e);for(let i=0;i<this.hashCount;i++){const t=this.ye(n,r,i);this.Se(t)}}Se(t){const e=Math.floor(t/8),n=t%8;this.bitmap[e]|=1<<n}}class ti extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class ei{constructor(t,e,n,r,i){this.snapshotVersion=t,this.targetChanges=e,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(t,e,n){const r=new Map;return r.set(t,ni.createSynthesizedTargetChangeForCurrentChange(t,e,n)),new ei(mt.min(),r,new he(H),Yn(),or())}}class ni{constructor(t,e,n,r,i){this.resumeToken=t,this.current=e,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(t,e,n){return new ni(n,e,or(),or(),or())}}class ri{constructor(t,e,n,r){this.be=t,this.removedTargetIds=e,this.key=n,this.De=r}}class ii{constructor(t,e){this.targetId=t,this.Ce=e}}class si{constructor(t,e,n=ye.EMPTY_BYTE_STRING,r=null){this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=r}}class oi{constructor(){this.ve=0,this.Fe=ui(),this.Me=ye.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return 0!==this.ve}get Be(){return this.Oe}Le(t){t.approximateByteSize()>0&&(this.Oe=!0,this.Me=t)}ke(){let t=or(),e=or(),n=or();return this.Fe.forEach((r,i)=>{switch(i){case 0:t=t.add(r);break;case 2:e=e.add(r);break;case 1:n=n.add(r);break;default:R(38017,{changeType:i})}}),new ni(this.Me,this.xe,t,e,n)}qe(){this.Oe=!1,this.Fe=ui()}Qe(t,e){this.Oe=!0,this.Fe=this.Fe.insert(t,e)}$e(t){this.Oe=!0,this.Fe=this.Fe.remove(t)}Ue(){this.ve+=1}Ke(){this.ve-=1,O(this.ve>=0,3241,{ve:this.ve})}We(){this.Oe=!0,this.xe=!0}}class ai{constructor(t){this.Ge=t,this.ze=new Map,this.je=Yn(),this.Je=ci(),this.He=ci(),this.Ye=new he(H)}Ze(t){for(const e of t.be)t.De&&t.De.isFoundDocument()?this.Xe(e,t.De):this.et(e,t.key,t.De);for(const e of t.removedTargetIds)this.et(e,t.key,t.De)}tt(t){this.forEachTarget(t,e=>{const n=this.nt(e);switch(t.state){case 0:this.rt(e)&&n.Le(t.resumeToken);break;case 1:n.Ke(),n.Ne||n.qe(),n.Le(t.resumeToken);break;case 2:n.Ke(),n.Ne||this.removeTarget(e);break;case 3:this.rt(e)&&(n.We(),n.Le(t.resumeToken));break;case 4:this.rt(e)&&(this.it(e),n.Le(t.resumeToken));break;default:R(56790,{state:t.state})}})}forEachTarget(t,e){t.targetIds.length>0?t.targetIds.forEach(e):this.ze.forEach((t,n)=>{this.rt(n)&&e(n)})}st(t){const e=t.targetId,n=t.Ce.count,r=this.ot(e);if(r){const i=r.target;if(Rn(i))if(0===n){const t=new it(i.path);this.et(e,t,rn.newNoDocument(t,mt.min()))}else O(1===n,20013,{expectedCount:n});else{const r=this._t(e);if(r!==n){const n=this.ut(t),i=n?this.ct(n,t,r):1;if(0!==i){this.it(e);const t=2===i?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ye=this.Ye.insert(e,t)}Qr?.lt(function(t,e,n,r,i){const s={localCacheCount:t,existenceFilterCount:e.count,databaseId:n.database,projectId:n.projectId},o=e.unchangedNames;return o&&(s.bloomFilter={applied:0===i,hashCount:o?.hashCount??0,bitmapLength:o?.bits?.bitmap?.length??0,padding:o?.bits?.padding??0,mightContain:t=>r?.mightContain(t)??!1}),s}(r,t.Ce,this.Ge.ht(),n,i))}}}}ut(t){const e=t.Ce.unchangedNames;if(!e||!e.bits)return null;const{bits:{bitmap:n="",padding:r=0},hashCount:i=0}=e;let s,o;try{s=Ee(n).toUint8Array()}catch(t){if(t instanceof me)return N("Decoding the base64 bloom filter in existence filter failed ("+t.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw t}try{o=new Zr(s,r,i)}catch(t){return N(t instanceof ti?"BloomFilter error: ":"Applying bloom filter failed: ",t),null}return 0===o.ge?null:o}ct(t,e,n){return e.Ce.count===n-this.Pt(t,e.targetId)?0:2}Pt(t,e){const n=this.Ge.getRemoteKeysForTarget(e);let r=0;return n.forEach(n=>{const i=this.Ge.ht(),s=`projects/${i.projectId}/databases/${i.database}/documents/${n.path.canonicalString()}`;t.mightContain(s)||(this.et(e,n,null),r++)}),r}Tt(t){const e=new Map;this.ze.forEach((n,r)=>{const i=this.ot(r);if(i){if(n.current&&Rn(i.target)){const e=new it(i.target.path);this.It(e).has(r)||this.Et(r,e)||this.et(r,e,rn.newNoDocument(e,t))}n.Be&&(e.set(r,n.ke()),n.qe())}});let n=or();this.He.forEach((t,e)=>{let r=!0;e.forEachWhile(t=>{const e=this.ot(t);return!e||"TargetPurposeLimboResolution"===e.purpose||(r=!1,!1)}),r&&(n=n.add(t))}),this.je.forEach((e,n)=>n.setReadTime(t));const r=new ei(t,e,this.Ye,this.je,n);return this.je=Yn(),this.Je=ci(),this.He=ci(),this.Ye=new he(H),r}Xe(t,e){if(!this.rt(t))return;const n=this.Et(t,e.key)?2:0;this.nt(t).Qe(e.key,n),this.je=this.je.insert(e.key,e),this.Je=this.Je.insert(e.key,this.It(e.key).add(t)),this.He=this.He.insert(e.key,this.dt(e.key).add(t))}et(t,e,n){if(!this.rt(t))return;const r=this.nt(t);this.Et(t,e)?r.Qe(e,1):r.$e(e),this.He=this.He.insert(e,this.dt(e).delete(t)),this.He=this.He.insert(e,this.dt(e).add(t)),n&&(this.je=this.je.insert(e,n))}removeTarget(t){this.ze.delete(t)}_t(t){const e=this.nt(t).ke();return this.Ge.getRemoteKeysForTarget(t).size+e.addedDocuments.size-e.removedDocuments.size}Ue(t){this.nt(t).Ue()}nt(t){let e=this.ze.get(t);return e||(e=new oi,this.ze.set(t,e)),e}dt(t){let e=this.He.get(t);return e||(e=new fe(H),this.He=this.He.insert(t,e)),e}It(t){let e=this.Je.get(t);return e||(e=new fe(H),this.Je=this.Je.insert(t,e)),e}rt(t){const e=null!==this.ot(t);return e||A("WatchChangeAggregator","Detected inactive target",t),e}ot(t){const e=this.ze.get(t);return e&&e.Ne?null:this.Ge.At(t)}it(t){this.ze.set(t,new oi),this.Ge.getRemoteKeysForTarget(t).forEach(e=>{this.et(t,e,null)})}Et(t,e){return this.Ge.getRemoteKeysForTarget(t).has(e)}}function ci(){return new he(it.comparator)}function ui(){return new he(it.comparator)}const hi={asc:"ASCENDING",desc:"DESCENDING"},li={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},di={and:"AND",or:"OR"};class fi{constructor(t,e){this.databaseId=t,this.useProto3Json=e}}function pi(t,e){return t.useProto3Json||Rt(e)?e:{value:e}}function gi(t,e){return t.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function mi(t,e){return t.useProto3Json?e.toBase64():e.toUint8Array()}function yi(t,e){return gi(t,e.toTimestamp())}function wi(t){return O(!!t,49232),mt.fromTimestamp(function(t){const e=ve(t);return new gt(e.seconds,e.nanos)}(t))}function vi(t,e){return bi(t,e).canonicalString()}function bi(t,e){const n=function(t){return new et(["projects",t.projectId,"databases",t.database])}(t).child("documents");return void 0===e?n:n.child(e)}function Ei(t){const e=et.fromString(t);return O(Bi(e),10190,{key:e.toString()}),e}function Ti(t,e){return vi(t.databaseId,e.path)}function _i(t,e){const n=Ei(e);if(n.get(1)!==t.databaseId.projectId)throw new P(L.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+t.databaseId.projectId);if(n.get(3)!==t.databaseId.database)throw new P(L.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+t.databaseId.database);return new it(Ai(n))}function Ii(t,e){return vi(t.databaseId,e)}function Si(t){const e=Ei(t);return 4===e.length?et.emptyPath():Ai(e)}function Ci(t){return new et(["projects",t.databaseId.projectId,"databases",t.databaseId.database]).canonicalString()}function Ai(t){return O(t.length>4&&"documents"===t.get(4),29091,{key:t.toString()}),t.popFirst(5)}function Di(t,e,n){return{name:Ti(t,e),fields:n.value.mapValue.fields}}function Ni(t,e){let n;if(e instanceof Or)n={update:Di(t,e.key,e.value)};else if(e instanceof Fr)n={delete:Ti(t,e.key)};else if(e instanceof Mr)n={update:Di(t,e.key,e.data),updateMask:ji(e.fieldMask)};else{if(!(e instanceof Ur))return R(16599,{Vt:e.type});n={verify:Ti(t,e.key)}}return e.fieldTransforms.length>0&&(n.updateTransforms=e.fieldTransforms.map(t=>function(t,e){const n=e.transform;if(n instanceof mr)return{fieldPath:e.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof yr)return{fieldPath:e.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof vr)return{fieldPath:e.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof Er)return{fieldPath:e.field.canonicalString(),increment:n.Ae};throw R(20930,{transform:e.transform})}(0,t))),e.precondition.isNone||(n.currentDocument=function(t,e){return void 0!==e.updateTime?{updateTime:yi(t,e.updateTime)}:void 0!==e.exists?{exists:e.exists}:R(27497)}(t,e.precondition)),n}function ki(t,e){return{documents:[Ii(t,e.path)]}}function Ri(t,e){const n={structuredQuery:{}},r=e.path;let i;null!==e.collectionGroup?(i=r,n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(i=r.popLast(),n.structuredQuery.from=[{collectionId:r.lastSegment()}]),n.parent=Ii(t,i);const s=function(t){if(0!==t.length)return Ui(dn.create(t,"and"))}(e.filters);s&&(n.structuredQuery.where=s);const o=function(t){if(0!==t.length)return t.map(t=>function(t){return{field:Vi(t.field),direction:Mi(t.dir)}}(t))}(e.orderBy);o&&(n.structuredQuery.orderBy=o);const a=pi(t,e.limit);return null!==a&&(n.structuredQuery.limit=a),e.startAt&&(n.structuredQuery.startAt=function(t){return{before:t.inclusive,values:t.position}}(e.startAt)),e.endAt&&(n.structuredQuery.endAt=function(t){return{before:!t.inclusive,values:t.position}}(e.endAt)),{ft:n,parent:i}}function xi(t){let e=Si(t.parent);const n=t.structuredQuery,r=n.from?n.from.length:0;let i=null;if(r>0){O(1===r,65062);const t=n.from[0];t.allDescendants?i=t.collectionId:e=e.child(t.collectionId)}let s=[];n.where&&(s=function(t){const e=Oi(t);return e instanceof dn&&pn(e)?e.getFilters():[e]}(n.where));let o=[];n.orderBy&&(o=function(t){return t.map(t=>function(t){return new cn(Fi(t.field),function(t){switch(t){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(t.direction))}(t))}(n.orderBy));let a=null;n.limit&&(a=function(t){let e;return e="object"==typeof t?t.value:t,Rt(e)?null:e}(n.limit));let c=null;n.startAt&&(c=function(t){const e=!!t.before,n=t.values||[];return new sn(n,e)}(n.startAt));let u=null;return n.endAt&&(u=function(t){const e=!t.before,n=t.values||[];return new sn(n,e)}(n.endAt)),On(e,i,o,s,a,"F",c,u)}function Oi(t){return void 0!==t.unaryFilter?function(t){switch(t.unaryFilter.op){case"IS_NAN":const e=Fi(t.unaryFilter.field);return ln.create(e,"==",{doubleValue:NaN});case"IS_NULL":const n=Fi(t.unaryFilter.field);return ln.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const r=Fi(t.unaryFilter.field);return ln.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const i=Fi(t.unaryFilter.field);return ln.create(i,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return R(61313);default:return R(60726)}}(t):void 0!==t.fieldFilter?function(t){return ln.create(Fi(t.fieldFilter.field),function(t){switch(t){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return R(58110);default:return R(50506)}}(t.fieldFilter.op),t.fieldFilter.value)}(t):void 0!==t.compositeFilter?function(t){return dn.create(t.compositeFilter.filters.map(t=>Oi(t)),function(t){switch(t){case"AND":return"and";case"OR":return"or";default:return R(1026)}}(t.compositeFilter.op))}(t):R(30097,{filter:t})}function Mi(t){return hi[t]}function Li(t){return li[t]}function Pi(t){return di[t]}function Vi(t){return{fieldPath:t.canonicalString()}}function Fi(t){return rt.fromServerFormat(t.fieldPath)}function Ui(t){return t instanceof ln?function(t){if("=="===t.op){if(Xe(t.value))return{unaryFilter:{field:Vi(t.field),op:"IS_NAN"}};if(We(t.value))return{unaryFilter:{field:Vi(t.field),op:"IS_NULL"}}}else if("!="===t.op){if(Xe(t.value))return{unaryFilter:{field:Vi(t.field),op:"IS_NOT_NAN"}};if(We(t.value))return{unaryFilter:{field:Vi(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Vi(t.field),op:Li(t.op),value:t.value}}}(t):t instanceof dn?function(t){const e=t.getFilters().map(t=>Ui(t));return 1===e.length?e[0]:{compositeFilter:{op:Pi(t.op),filters:e}}}(t):R(54877,{filter:t})}function ji(t){const e=[];return t.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function Bi(t){return t.length>=4&&"projects"===t.get(0)&&"databases"===t.get(2)}class qi{constructor(t,e,n,r,i=mt.min(),s=mt.min(),o=ye.EMPTY_BYTE_STRING,a=null){this.target=t,this.targetId=e,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=s,this.resumeToken=o,this.expectedCount=a}withSequenceNumber(t){return new qi(this.target,this.targetId,this.purpose,t,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(t,e){return new qi(this.target,this.targetId,this.purpose,this.sequenceNumber,e,this.lastLimboFreeSnapshotVersion,t,null)}withExpectedCount(t){return new qi(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,t)}withLastLimboFreeSnapshotVersion(t){return new qi(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,t,this.resumeToken,this.expectedCount)}}class $i{constructor(t){this.yt=t}}function zi(t){const e=xi({parent:t.parent,structuredQuery:t.structuredQuery});return"LAST"===t.limitType?Bn(e,e.limit,"L"):e}class Ki{constructor(){}Dt(t,e){this.Ct(t,e),e.vt()}Ct(t,e){if("nullValue"in t)this.Ft(e,5);else if("booleanValue"in t)this.Ft(e,10),e.Mt(t.booleanValue?1:0);else if("integerValue"in t)this.Ft(e,15),e.Mt(be(t.integerValue));else if("doubleValue"in t){const n=be(t.doubleValue);isNaN(n)?this.Ft(e,13):(this.Ft(e,15),xt(n)?e.Mt(0):e.Mt(n))}else if("timestampValue"in t){let n=t.timestampValue;this.Ft(e,20),"string"==typeof n&&(n=ve(n)),e.xt(`${n.seconds||""}`),e.Mt(n.nanos||0)}else if("stringValue"in t)this.Ot(t.stringValue,e),this.Nt(e);else if("bytesValue"in t)this.Ft(e,30),e.Bt(Ee(t.bytesValue)),this.Nt(e);else if("referenceValue"in t)this.Lt(t.referenceValue,e);else if("geoPointValue"in t){const n=t.geoPointValue;this.Ft(e,45),e.Mt(n.latitude||0),e.Mt(n.longitude||0)}else"mapValue"in t?tn(t)?this.Ft(e,Number.MAX_SAFE_INTEGER):Je(t)?this.kt(t.mapValue,e):(this.qt(t.mapValue,e),this.Nt(e)):"arrayValue"in t?(this.Qt(t.arrayValue,e),this.Nt(e)):R(19022,{$t:t})}Ot(t,e){this.Ft(e,25),this.Ut(t,e)}Ut(t,e){e.xt(t)}qt(t,e){const n=t.fields||{};this.Ft(e,55);for(const r of Object.keys(n))this.Ot(r,e),this.Ct(n[r],e)}kt(t,e){const n=t.fields||{};this.Ft(e,53);const r=Pe,i=n[r].arrayValue?.values?.length||0;this.Ft(e,15),e.Mt(be(i)),this.Ot(r,e),this.Ct(n[r],e)}Qt(t,e){const n=t.values||[];this.Ft(e,50);for(const r of n)this.Ct(r,e)}Lt(t,e){this.Ft(e,37),it.fromName(t).path.forEach(t=>{this.Ft(e,60),this.Ut(t,e)})}Ft(t,e){t.Mt(e)}Nt(t){t.Mt(2)}}Ki.Kt=new Ki;class Gi{constructor(){this.Cn=new Hi}addToCollectionParentIndex(t,e){return this.Cn.add(e),Ct.resolve()}getCollectionParents(t,e){return Ct.resolve(this.Cn.getEntries(e))}addFieldIndex(t,e){return Ct.resolve()}deleteFieldIndex(t,e){return Ct.resolve()}deleteAllFieldIndexes(t){return Ct.resolve()}createTargetIndexes(t,e){return Ct.resolve()}getDocumentsMatchingTarget(t,e){return Ct.resolve(null)}getIndexType(t,e){return Ct.resolve(0)}getFieldIndexes(t,e){return Ct.resolve([])}getNextCollectionGroupToUpdate(t){return Ct.resolve(null)}getMinOffset(t,e){return Ct.resolve(Et.min())}getMinOffsetFromCollectionGroup(t,e){return Ct.resolve(Et.min())}updateCollectionGroup(t,e,n){return Ct.resolve()}updateIndexEntries(t,e){return Ct.resolve()}}class Hi{constructor(){this.index={}}add(t){const e=t.lastSegment(),n=t.popLast(),r=this.index[e]||new fe(et.comparator),i=!r.has(n);return this.index[e]=r.add(n),i}has(t){const e=t.lastSegment(),n=t.popLast(),r=this.index[e];return r&&r.has(n)}getEntries(t){return(this.index[t]||new fe(et.comparator)).toArray()}}new Uint8Array(0);const Qi={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},Wi=41943040;class Xi{static withCacheSize(t){return new Xi(t,Xi.DEFAULT_COLLECTION_PERCENTILE,Xi.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(t,e,n){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=e,this.maximumSequenceNumbersToCollect=n}}Xi.DEFAULT_COLLECTION_PERCENTILE=10,Xi.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Xi.DEFAULT=new Xi(Wi,Xi.DEFAULT_COLLECTION_PERCENTILE,Xi.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Xi.DISABLED=new Xi(-1,0,0);class Yi{constructor(t){this.ar=t}next(){return this.ar+=2,this.ar}static ur(){return new Yi(0)}static cr(){return new Yi(-1)}}const Ji="LruGarbageCollector",Zi=1048576;function ts([t,e],[n,r]){const i=H(t,n);return 0===i?H(e,r):i}class es{constructor(t){this.Ir=t,this.buffer=new fe(ts),this.Er=0}dr(){return++this.Er}Ar(t){const e=[t,this.dr()];if(this.buffer.size<this.Ir)this.buffer=this.buffer.add(e);else{const t=this.buffer.last();ts(e,t)<0&&(this.buffer=this.buffer.delete(t).add(e))}}get maxValue(){return this.buffer.last()[0]}}class ns{constructor(t,e,n){this.garbageCollector=t,this.asyncQueue=e,this.localStore=n,this.Rr=null}start(){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.Vr(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return null!==this.Rr}Vr(t){A(Ji,`Garbage collection scheduled in ${t}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",t,async()=>{this.Rr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(t){Dt(t)?A(Ji,"Ignoring IndexedDB error during garbage collection: ",t):await St(t)}await this.Vr(3e5)})}}class rs{constructor(t,e){this.mr=t,this.params=e}calculateTargetCount(t,e){return this.mr.gr(t).next(t=>Math.floor(e/100*t))}nthSequenceNumber(t,e){if(0===e)return Ct.resolve(Nt.ce);const n=new es(e);return this.mr.forEachTarget(t,t=>n.Ar(t.sequenceNumber)).next(()=>this.mr.pr(t,t=>n.Ar(t))).next(()=>n.maxValue)}removeTargets(t,e,n){return this.mr.removeTargets(t,e,n)}removeOrphanedDocuments(t,e){return this.mr.removeOrphanedDocuments(t,e)}collect(t,e){return-1===this.params.cacheSizeCollectionThreshold?(A("LruGarbageCollector","Garbage collection skipped; disabled"),Ct.resolve(Qi)):this.getCacheSize(t).next(n=>n<this.params.cacheSizeCollectionThreshold?(A("LruGarbageCollector",`Garbage collection skipped; Cache size ${n} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),Qi):this.yr(t,e))}getCacheSize(t){return this.mr.getCacheSize(t)}yr(t,e){let n,r,i,s,o,c,u;const h=Date.now();return this.calculateTargetCount(t,this.params.percentileToCollect).next(e=>(e>this.params.maximumSequenceNumbersToCollect?(A("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${e}`),r=this.params.maximumSequenceNumbersToCollect):r=e,s=Date.now(),this.nthSequenceNumber(t,r))).next(r=>(n=r,o=Date.now(),this.removeTargets(t,n,e))).next(e=>(i=e,c=Date.now(),this.removeOrphanedDocuments(t,n))).next(t=>(u=Date.now(),C()<=a.$b.DEBUG&&A("LruGarbageCollector",`LRU Garbage Collection\n\tCounted targets in ${s-h}ms\n\tDetermined least recently used ${r} in `+(o-s)+"ms\n"+`\tRemoved ${i} targets in `+(c-o)+"ms\n"+`\tRemoved ${t} documents in `+(u-c)+"ms\n"+`Total Duration: ${u-h}ms`),Ct.resolve({didRun:!0,sequenceNumbersCollected:r,targetsRemoved:i,documentsRemoved:t})))}}function is(t,e){return new rs(t,e)}class ss{constructor(){this.changes=new Wn(t=>t.toString(),(t,e)=>t.isEqual(e)),this.changesApplied=!1}addEntry(t){this.assertNotApplied(),this.changes.set(t.key,t)}removeEntry(t,e){this.assertNotApplied(),this.changes.set(t,rn.newInvalidDocument(t).setReadTime(e))}getEntry(t,e){this.assertNotApplied();const n=this.changes.get(e);return void 0!==n?Ct.resolve(n):this.getFromCache(t,e)}getEntries(t,e){return this.getAllFromCache(t,e)}apply(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)}assertNotApplied(){}}class os{constructor(t,e){this.overlayedDocument=t,this.mutatedFields=e}}class as{constructor(t,e,n,r){this.remoteDocumentCache=t,this.mutationQueue=e,this.documentOverlayCache=n,this.indexManager=r}getDocument(t,e){let n=null;return this.documentOverlayCache.getOverlay(t,e).next(r=>(n=r,this.remoteDocumentCache.getEntry(t,e))).next(t=>(null!==n&&kr(n.mutation,t,ge.empty(),gt.now()),t))}getDocuments(t,e){return this.remoteDocumentCache.getEntries(t,e).next(e=>this.getLocalViewOfDocuments(t,e,or()).next(()=>e))}getLocalViewOfDocuments(t,e,n=or()){const r=er();return this.populateOverlays(t,r,e).next(()=>this.computeViews(t,e,r,n).next(t=>{let e=Zn();return t.forEach((t,n)=>{e=e.insert(t,n.overlayedDocument)}),e}))}getOverlayedDocuments(t,e){const n=er();return this.populateOverlays(t,n,e).next(()=>this.computeViews(t,e,n,or()))}populateOverlays(t,e,n){const r=[];return n.forEach(t=>{e.has(t)||r.push(t)}),this.documentOverlayCache.getOverlays(t,r).next(t=>{t.forEach((t,n)=>{e.set(t,n)})})}computeViews(t,e,n,r){let i=Yn();const s=rr(),o=rr();return e.forEach((t,e)=>{const o=n.get(e.key);r.has(e.key)&&(void 0===o||o.mutation instanceof Mr)?i=i.insert(e.key,e):void 0!==o?(s.set(e.key,o.mutation.getFieldMask()),kr(o.mutation,e,o.mutation.getFieldMask(),gt.now())):s.set(e.key,ge.empty())}),this.recalculateAndSaveOverlays(t,i).next(t=>(t.forEach((t,e)=>s.set(t,e)),e.forEach((t,e)=>o.set(t,new os(e,s.get(t)??null))),o))}recalculateAndSaveOverlays(t,e){const n=rr();let r=new he((t,e)=>t-e),i=or();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(t,e).next(t=>{for(const i of t)i.keys().forEach(t=>{const s=e.get(t);if(null===s)return;let o=n.get(t)||ge.empty();o=i.applyToLocalView(s,o),n.set(t,o);const a=(r.get(i.batchId)||or()).add(t);r=r.insert(i.batchId,a)})}).next(()=>{const s=[],o=r.getReverseIterator();for(;o.hasNext();){const r=o.getNext(),a=r.key,c=r.value,u=nr();c.forEach(t=>{if(!i.has(t)){const r=Dr(e.get(t),n.get(t));null!==r&&u.set(t,r),i=i.add(t)}}),s.push(this.documentOverlayCache.saveOverlays(t,a,u))}return Ct.waitFor(s)}).next(()=>n)}recalculateAndSaveOverlaysForDocumentKeys(t,e){return this.remoteDocumentCache.getEntries(t,e).next(e=>this.recalculateAndSaveOverlays(t,e))}getDocumentsMatchingQuery(t,e,n,r){return function(t){return it.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}(e)?this.getDocumentsMatchingDocumentQuery(t,e.path):Pn(e)?this.getDocumentsMatchingCollectionGroupQuery(t,e,n,r):this.getDocumentsMatchingCollectionQuery(t,e,n,r)}getNextDocuments(t,e,n,r){return this.remoteDocumentCache.getAllFromCollectionGroup(t,e,n,r).next(i=>{const s=r-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(t,e,n.largestBatchId,r-i.size):Ct.resolve(er());let o=yt,a=i;return s.next(e=>Ct.forEach(e,(e,n)=>(o<n.largestBatchId&&(o=n.largestBatchId),i.get(e)?Ct.resolve():this.remoteDocumentCache.getEntry(t,e).next(t=>{a=a.insert(e,t)}))).next(()=>this.populateOverlays(t,e,i)).next(()=>this.computeViews(t,a,e,or())).next(t=>({batchId:o,changes:tr(t)})))})}getDocumentsMatchingDocumentQuery(t,e){return this.getDocument(t,new it(e)).next(t=>{let e=Zn();return t.isFoundDocument()&&(e=e.insert(t.key,t)),e})}getDocumentsMatchingCollectionGroupQuery(t,e,n,r){const i=e.collectionGroup;let s=Zn();return this.indexManager.getCollectionParents(t,i).next(o=>Ct.forEach(o,o=>{const a=function(t,e){return new xn(e,null,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)}(e,o.child(i));return this.getDocumentsMatchingCollectionQuery(t,a,n,r).next(t=>{t.forEach((t,e)=>{s=s.insert(t,e)})})}).next(()=>s))}getDocumentsMatchingCollectionQuery(t,e,n,r){let i;return this.documentOverlayCache.getOverlaysForCollection(t,e.path,n.largestBatchId).next(s=>(i=s,this.remoteDocumentCache.getDocumentsMatchingQuery(t,e,n,i,r))).next(t=>{i.forEach((e,n)=>{const r=n.getKey();null===t.get(r)&&(t=t.insert(r,rn.newInvalidDocument(r)))});let n=Zn();return t.forEach((t,r)=>{const s=i.get(t);void 0!==s&&kr(s.mutation,r,ge.empty(),gt.now()),Kn(e,r)&&(n=n.insert(t,r))}),n})}}class cs{constructor(t){this.serializer=t,this.Lr=new Map,this.kr=new Map}getBundleMetadata(t,e){return Ct.resolve(this.Lr.get(e))}saveBundleMetadata(t,e){return this.Lr.set(e.id,function(t){return{id:t.id,version:t.version,createTime:wi(t.createTime)}}(e)),Ct.resolve()}getNamedQuery(t,e){return Ct.resolve(this.kr.get(e))}saveNamedQuery(t,e){return this.kr.set(e.name,function(t){return{name:t.name,query:zi(t.bundledQuery),readTime:wi(t.readTime)}}(e)),Ct.resolve()}}class us{constructor(){this.overlays=new he(it.comparator),this.qr=new Map}getOverlay(t,e){return Ct.resolve(this.overlays.get(e))}getOverlays(t,e){const n=er();return Ct.forEach(e,e=>this.getOverlay(t,e).next(t=>{null!==t&&n.set(e,t)})).next(()=>n)}saveOverlays(t,e,n){return n.forEach((n,r)=>{this.St(t,e,r)}),Ct.resolve()}removeOverlaysForBatchId(t,e,n){const r=this.qr.get(n);return void 0!==r&&(r.forEach(t=>this.overlays=this.overlays.remove(t)),this.qr.delete(n)),Ct.resolve()}getOverlaysForCollection(t,e,n){const r=er(),i=e.length+1,s=new it(e.child("")),o=this.overlays.getIteratorFrom(s);for(;o.hasNext();){const t=o.getNext().value,s=t.getKey();if(!e.isPrefixOf(s.path))break;s.path.length===i&&t.largestBatchId>n&&r.set(t.getKey(),t)}return Ct.resolve(r)}getOverlaysForCollectionGroup(t,e,n,r){let i=new he((t,e)=>t-e);const s=this.overlays.getIterator();for(;s.hasNext();){const t=s.getNext().value;if(t.getKey().getCollectionGroup()===e&&t.largestBatchId>n){let e=i.get(t.largestBatchId);null===e&&(e=er(),i=i.insert(t.largestBatchId,e)),e.set(t.getKey(),t)}}const o=er(),a=i.getIterator();for(;a.hasNext()&&(a.getNext().value.forEach((t,e)=>o.set(t,e)),!(o.size()>=r)););return Ct.resolve(o)}St(t,e,n){const r=this.overlays.get(n.key);if(null!==r){const t=this.qr.get(r.largestBatchId).delete(n.key);this.qr.set(r.largestBatchId,t)}this.overlays=this.overlays.insert(n.key,new qr(e,n));let i=this.qr.get(e);void 0===i&&(i=or(),this.qr.set(e,i)),this.qr.set(e,i.add(n.key))}}class hs{constructor(){this.sessionToken=ye.EMPTY_BYTE_STRING}getSessionToken(t){return Ct.resolve(this.sessionToken)}setSessionToken(t,e){return this.sessionToken=e,Ct.resolve()}}class ls{constructor(){this.Qr=new fe(ds.$r),this.Ur=new fe(ds.Kr)}isEmpty(){return this.Qr.isEmpty()}addReference(t,e){const n=new ds(t,e);this.Qr=this.Qr.add(n),this.Ur=this.Ur.add(n)}Wr(t,e){t.forEach(t=>this.addReference(t,e))}removeReference(t,e){this.Gr(new ds(t,e))}zr(t,e){t.forEach(t=>this.removeReference(t,e))}jr(t){const e=new it(new et([])),n=new ds(e,t),r=new ds(e,t+1),i=[];return this.Ur.forEachInRange([n,r],t=>{this.Gr(t),i.push(t.key)}),i}Jr(){this.Qr.forEach(t=>this.Gr(t))}Gr(t){this.Qr=this.Qr.delete(t),this.Ur=this.Ur.delete(t)}Hr(t){const e=new it(new et([])),n=new ds(e,t),r=new ds(e,t+1);let i=or();return this.Ur.forEachInRange([n,r],t=>{i=i.add(t.key)}),i}containsKey(t){const e=new ds(t,0),n=this.Qr.firstAfterOrEqual(e);return null!==n&&t.isEqual(n.key)}}class ds{constructor(t,e){this.key=t,this.Yr=e}static $r(t,e){return it.comparator(t.key,e.key)||H(t.Yr,e.Yr)}static Kr(t,e){return H(t.Yr,e.Yr)||it.comparator(t.key,e.key)}}class fs{constructor(t,e){this.indexManager=t,this.referenceDelegate=e,this.mutationQueue=[],this.tr=1,this.Zr=new fe(ds.$r)}checkEmpty(t){return Ct.resolve(0===this.mutationQueue.length)}addMutationBatch(t,e,n,r){const i=this.tr;this.tr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const s=new jr(i,e,n,r);this.mutationQueue.push(s);for(const o of r)this.Zr=this.Zr.add(new ds(o.key,i)),this.indexManager.addToCollectionParentIndex(t,o.key.path.popLast());return Ct.resolve(s)}lookupMutationBatch(t,e){return Ct.resolve(this.Xr(e))}getNextMutationBatchAfterBatchId(t,e){const n=e+1,r=this.ei(n),i=r<0?0:r;return Ct.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return Ct.resolve(0===this.mutationQueue.length?kt:this.tr-1)}getAllMutationBatches(t){return Ct.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(t,e){const n=new ds(e,0),r=new ds(e,Number.POSITIVE_INFINITY),i=[];return this.Zr.forEachInRange([n,r],t=>{const e=this.Xr(t.Yr);i.push(e)}),Ct.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(t,e){let n=new fe(H);return e.forEach(t=>{const e=new ds(t,0),r=new ds(t,Number.POSITIVE_INFINITY);this.Zr.forEachInRange([e,r],t=>{n=n.add(t.Yr)})}),Ct.resolve(this.ti(n))}getAllMutationBatchesAffectingQuery(t,e){const n=e.path,r=n.length+1;let i=n;it.isDocumentKey(i)||(i=i.child(""));const s=new ds(new it(i),0);let o=new fe(H);return this.Zr.forEachWhile(t=>{const e=t.key.path;return!!n.isPrefixOf(e)&&(e.length===r&&(o=o.add(t.Yr)),!0)},s),Ct.resolve(this.ti(o))}ti(t){const e=[];return t.forEach(t=>{const n=this.Xr(t);null!==n&&e.push(n)}),e}removeMutationBatch(t,e){O(0===this.ni(e.batchId,"removed"),55003),this.mutationQueue.shift();let n=this.Zr;return Ct.forEach(e.mutations,r=>{const i=new ds(r.key,e.batchId);return n=n.delete(i),this.referenceDelegate.markPotentiallyOrphaned(t,r.key)}).next(()=>{this.Zr=n})}ir(t){}containsKey(t,e){const n=new ds(e,0),r=this.Zr.firstAfterOrEqual(n);return Ct.resolve(e.isEqual(r&&r.key))}performConsistencyCheck(t){return this.mutationQueue.length,Ct.resolve()}ni(t,e){return this.ei(t)}ei(t){return 0===this.mutationQueue.length?0:t-this.mutationQueue[0].batchId}Xr(t){const e=this.ei(t);return e<0||e>=this.mutationQueue.length?null:this.mutationQueue[e]}}class ps{constructor(t){this.ri=t,this.docs=new he(it.comparator),this.size=0}setIndexManager(t){this.indexManager=t}addEntry(t,e){const n=e.key,r=this.docs.get(n),i=r?r.size:0,s=this.ri(e);return this.docs=this.docs.insert(n,{document:e.mutableCopy(),size:s}),this.size+=s-i,this.indexManager.addToCollectionParentIndex(t,n.path.popLast())}removeEntry(t){const e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)}getEntry(t,e){const n=this.docs.get(e);return Ct.resolve(n?n.document.mutableCopy():rn.newInvalidDocument(e))}getEntries(t,e){let n=Yn();return e.forEach(t=>{const e=this.docs.get(t);n=n.insert(t,e?e.document.mutableCopy():rn.newInvalidDocument(t))}),Ct.resolve(n)}getDocumentsMatchingQuery(t,e,n,r){let i=Yn();const s=e.path,o=new it(s.child("__id-9223372036854775808__")),a=this.docs.getIteratorFrom(o);for(;a.hasNext();){const{key:t,value:{document:o}}=a.getNext();if(!s.isPrefixOf(t.path))break;t.path.length>s.length+1||Tt(bt(o),n)<=0||(r.has(o.key)||Kn(e,o))&&(i=i.insert(o.key,o.mutableCopy()))}return Ct.resolve(i)}getAllFromCollectionGroup(t,e,n,r){R(9500)}ii(t,e){return Ct.forEach(this.docs,t=>e(t))}newChangeBuffer(t){return new gs(this)}getSize(t){return Ct.resolve(this.size)}}class gs extends ss{constructor(t){super(),this.Nr=t}applyChanges(t){const e=[];return this.changes.forEach((n,r)=>{r.isValidDocument()?e.push(this.Nr.addEntry(t,r)):this.Nr.removeEntry(n)}),Ct.waitFor(e)}getFromCache(t,e){return this.Nr.getEntry(t,e)}getAllFromCache(t,e){return this.Nr.getEntries(t,e)}}class ms{constructor(t){this.persistence=t,this.si=new Wn(t=>Nn(t),kn),this.lastRemoteSnapshotVersion=mt.min(),this.highestTargetId=0,this.oi=0,this._i=new ls,this.targetCount=0,this.ai=Yi.ur()}forEachTarget(t,e){return this.si.forEach((t,n)=>e(n)),Ct.resolve()}getLastRemoteSnapshotVersion(t){return Ct.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(t){return Ct.resolve(this.oi)}allocateTargetId(t){return this.highestTargetId=this.ai.next(),Ct.resolve(this.highestTargetId)}setTargetsMetadata(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.oi&&(this.oi=e),Ct.resolve()}Pr(t){this.si.set(t.target,t);const e=t.targetId;e>this.highestTargetId&&(this.ai=new Yi(e),this.highestTargetId=e),t.sequenceNumber>this.oi&&(this.oi=t.sequenceNumber)}addTargetData(t,e){return this.Pr(e),this.targetCount+=1,Ct.resolve()}updateTargetData(t,e){return this.Pr(e),Ct.resolve()}removeTargetData(t,e){return this.si.delete(e.target),this._i.jr(e.targetId),this.targetCount-=1,Ct.resolve()}removeTargets(t,e,n){let r=0;const i=[];return this.si.forEach((s,o)=>{o.sequenceNumber<=e&&null===n.get(o.targetId)&&(this.si.delete(s),i.push(this.removeMatchingKeysForTargetId(t,o.targetId)),r++)}),Ct.waitFor(i).next(()=>r)}getTargetCount(t){return Ct.resolve(this.targetCount)}getTargetData(t,e){const n=this.si.get(e)||null;return Ct.resolve(n)}addMatchingKeys(t,e,n){return this._i.Wr(e,n),Ct.resolve()}removeMatchingKeys(t,e,n){this._i.zr(e,n);const r=this.persistence.referenceDelegate,i=[];return r&&e.forEach(e=>{i.push(r.markPotentiallyOrphaned(t,e))}),Ct.waitFor(i)}removeMatchingKeysForTargetId(t,e){return this._i.jr(e),Ct.resolve()}getMatchingKeysForTargetId(t,e){const n=this._i.Hr(e);return Ct.resolve(n)}containsKey(t,e){return Ct.resolve(this._i.containsKey(e))}}class ys{constructor(t,e){this.ui={},this.overlays={},this.ci=new Nt(0),this.li=!1,this.li=!0,this.hi=new hs,this.referenceDelegate=t(this),this.Pi=new ms(this),this.indexManager=new Gi,this.remoteDocumentCache=function(t){return new ps(t)}(t=>this.referenceDelegate.Ti(t)),this.serializer=new $i(e),this.Ii=new cs(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.li=!1,Promise.resolve()}get started(){return this.li}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(t){return this.indexManager}getDocumentOverlayCache(t){let e=this.overlays[t.toKey()];return e||(e=new us,this.overlays[t.toKey()]=e),e}getMutationQueue(t,e){let n=this.ui[t.toKey()];return n||(n=new fs(e,this.referenceDelegate),this.ui[t.toKey()]=n),n}getGlobalsCache(){return this.hi}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ii}runTransaction(t,e,n){A("MemoryPersistence","Starting transaction:",t);const r=new ws(this.ci.next());return this.referenceDelegate.Ei(),n(r).next(t=>this.referenceDelegate.di(r).next(()=>t)).toPromise().then(t=>(r.raiseOnCommittedEvent(),t))}Ai(t,e){return Ct.or(Object.values(this.ui).map(n=>()=>n.containsKey(t,e)))}}class ws extends It{constructor(t){super(),this.currentSequenceNumber=t}}class vs{constructor(t){this.persistence=t,this.Ri=new ls,this.Vi=null}static mi(t){return new vs(t)}get fi(){if(this.Vi)return this.Vi;throw R(60996)}addReference(t,e,n){return this.Ri.addReference(n,e),this.fi.delete(n.toString()),Ct.resolve()}removeReference(t,e,n){return this.Ri.removeReference(n,e),this.fi.add(n.toString()),Ct.resolve()}markPotentiallyOrphaned(t,e){return this.fi.add(e.toString()),Ct.resolve()}removeTarget(t,e){this.Ri.jr(e.targetId).forEach(t=>this.fi.add(t.toString()));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(t,e.targetId).next(t=>{t.forEach(t=>this.fi.add(t.toString()))}).next(()=>n.removeTargetData(t,e))}Ei(){this.Vi=new Set}di(t){const e=this.persistence.getRemoteDocumentCache().newChangeBuffer();return Ct.forEach(this.fi,n=>{const r=it.fromPath(n);return this.gi(t,r).next(t=>{t||e.removeEntry(r,mt.min())})}).next(()=>(this.Vi=null,e.apply(t)))}updateLimboDocument(t,e){return this.gi(t,e).next(t=>{t?this.fi.delete(e.toString()):this.fi.add(e.toString())})}Ti(t){return 0}gi(t,e){return Ct.or([()=>Ct.resolve(this.Ri.containsKey(e)),()=>this.persistence.getTargetCache().containsKey(t,e),()=>this.persistence.Ai(t,e)])}}class bs{constructor(t,e){this.persistence=t,this.pi=new Wn(t=>Lt(t.path),(t,e)=>t.isEqual(e)),this.garbageCollector=is(this,e)}static mi(t,e){return new bs(t,e)}Ei(){}di(t){return Ct.resolve()}forEachTarget(t,e){return this.persistence.getTargetCache().forEachTarget(t,e)}gr(t){const e=this.wr(t);return this.persistence.getTargetCache().getTargetCount(t).next(t=>e.next(e=>t+e))}wr(t){let e=0;return this.pr(t,t=>{e++}).next(()=>e)}pr(t,e){return Ct.forEach(this.pi,(n,r)=>this.br(t,n,r).next(t=>t?Ct.resolve():e(r)))}removeTargets(t,e,n){return this.persistence.getTargetCache().removeTargets(t,e,n)}removeOrphanedDocuments(t,e){let n=0;const r=this.persistence.getRemoteDocumentCache(),i=r.newChangeBuffer();return r.ii(t,r=>this.br(t,r,e).next(t=>{t||(n++,i.removeEntry(r,mt.min()))})).next(()=>i.apply(t)).next(()=>n)}markPotentiallyOrphaned(t,e){return this.pi.set(e,t.currentSequenceNumber),Ct.resolve()}removeTarget(t,e){const n=e.withSequenceNumber(t.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(t,n)}addReference(t,e,n){return this.pi.set(n,t.currentSequenceNumber),Ct.resolve()}removeReference(t,e,n){return this.pi.set(n,t.currentSequenceNumber),Ct.resolve()}updateLimboDocument(t,e){return this.pi.set(e,t.currentSequenceNumber),Ct.resolve()}Ti(t){let e=t.key.toString().length;return t.isFoundDocument()&&(e+=Ke(t.data.value)),e}br(t,e,n){return Ct.or([()=>this.persistence.Ai(t,e),()=>this.persistence.getTargetCache().containsKey(t,e),()=>{const t=this.pi.get(e);return Ct.resolve(void 0!==t&&t>n)}])}getCacheSize(t){return this.persistence.getRemoteDocumentCache().getSize(t)}}class Es{constructor(t,e,n,r){this.targetId=t,this.fromCache=e,this.Es=n,this.ds=r}static As(t,e){let n=or(),r=or();for(const i of e.docChanges)switch(i.type){case 0:n=n.add(i.doc.key);break;case 1:r=r.add(i.doc.key)}return new Es(t,e.fromCache,n,r)}}class Ts{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(t){this._documentReadCount+=t}}class _s{constructor(){this.Rs=!1,this.Vs=!1,this.fs=100,this.gs=(0,c.nr)()?8:At((0,c.ZQ)())>0?6:4}initialize(t,e){this.ps=t,this.indexManager=e,this.Rs=!0}getDocumentsMatchingQuery(t,e,n,r){const i={result:null};return this.ys(t,e).next(t=>{i.result=t}).next(()=>{if(!i.result)return this.ws(t,e,r,n).next(t=>{i.result=t})}).next(()=>{if(i.result)return;const n=new Ts;return this.Ss(t,e,n).next(r=>{if(i.result=r,this.Vs)return this.bs(t,e,n,r.size)})}).next(()=>i.result)}bs(t,e,n,r){return n.documentReadCount<this.fs?(C()<=a.$b.DEBUG&&A("QueryEngine","SDK will not create cache indexes for query:",zn(e),"since it only creates cache indexes for collection contains","more than or equal to",this.fs,"documents"),Ct.resolve()):(C()<=a.$b.DEBUG&&A("QueryEngine","Query:",zn(e),"scans",n.documentReadCount,"local documents and returns",r,"documents as results."),n.documentReadCount>this.gs*r?(C()<=a.$b.DEBUG&&A("QueryEngine","The SDK decides to create cache indexes for query:",zn(e),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(t,Fn(e))):Ct.resolve())}ys(t,e){if(Ln(e))return Ct.resolve(null);let n=Fn(e);return this.indexManager.getIndexType(t,n).next(r=>0===r?null:(null!==e.limit&&1===r&&(e=Bn(e,null,"F"),n=Fn(e)),this.indexManager.getDocumentsMatchingTarget(t,n).next(r=>{const i=or(...r);return this.ps.getDocuments(t,i).next(r=>this.indexManager.getMinOffset(t,n).next(n=>{const s=this.Ds(e,r);return this.Cs(e,s,i,n.readTime)?this.ys(t,Bn(e,null,"F")):this.vs(t,s,e,n)}))})))}ws(t,e,n,r){return Ln(e)||r.isEqual(mt.min())?Ct.resolve(null):this.ps.getDocuments(t,n).next(i=>{const s=this.Ds(e,i);return this.Cs(e,s,n,r)?Ct.resolve(null):(C()<=a.$b.DEBUG&&A("QueryEngine","Re-using previous result from %s to execute query: %s",r.toString(),zn(e)),this.vs(t,s,e,vt(r,yt)).next(t=>t))})}Ds(t,e){let n=new fe(Hn(t));return e.forEach((e,r)=>{Kn(t,r)&&(n=n.add(r))}),n}Cs(t,e,n,r){if(null===t.limit)return!1;if(n.size!==e.size)return!0;const i="F"===t.limitType?e.last():e.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(r)>0)}Ss(t,e,n){return C()<=a.$b.DEBUG&&A("QueryEngine","Using full collection scan to execute query:",zn(e)),this.ps.getDocumentsMatchingQuery(t,e,Et.min(),n)}vs(t,e,n,r){return this.ps.getDocumentsMatchingQuery(t,n,r).next(t=>(e.forEach(e=>{t=t.insert(e.key,e)}),t))}}const Is="LocalStore",Ss=3e8;class Cs{constructor(t,e,n,r){this.persistence=t,this.Fs=e,this.serializer=r,this.Ms=new he(H),this.xs=new Wn(t=>Nn(t),kn),this.Os=new Map,this.Ns=t.getRemoteDocumentCache(),this.Pi=t.getTargetCache(),this.Ii=t.getBundleCache(),this.Bs(n)}Bs(t){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(t),this.indexManager=this.persistence.getIndexManager(t),this.mutationQueue=this.persistence.getMutationQueue(t,this.indexManager),this.localDocuments=new as(this.Ns,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Ns.setIndexManager(this.indexManager),this.Fs.initialize(this.localDocuments,this.indexManager)}collectGarbage(t){return this.persistence.runTransaction("Collect garbage","readwrite-primary",e=>t.collect(e,this.Ms))}}function As(t,e,n,r){return new Cs(t,e,n,r)}async function Ds(t,e){const n=M(t);return await n.persistence.runTransaction("Handle user change","readonly",t=>{let r;return n.mutationQueue.getAllMutationBatches(t).next(i=>(r=i,n.Bs(e),n.mutationQueue.getAllMutationBatches(t))).next(e=>{const i=[],s=[];let o=or();for(const t of r){i.push(t.batchId);for(const e of t.mutations)o=o.add(e.key)}for(const t of e){s.push(t.batchId);for(const e of t.mutations)o=o.add(e.key)}return n.localDocuments.getDocuments(t,o).next(t=>({Ls:t,removedBatchIds:i,addedBatchIds:s}))})})}function Ns(t){const e=M(t);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.Pi.getLastRemoteSnapshotVersion(t))}function ks(t,e,n){let r=or(),i=or();return n.forEach(t=>r=r.add(t)),e.getEntries(t,r).next(t=>{let r=Yn();return n.forEach((n,s)=>{const o=t.get(n);s.isFoundDocument()!==o.isFoundDocument()&&(i=i.add(n)),s.isNoDocument()&&s.version.isEqual(mt.min())?(e.removeEntry(n,s.readTime),r=r.insert(n,s)):!o.isValidDocument()||s.version.compareTo(o.version)>0||0===s.version.compareTo(o.version)&&o.hasPendingWrites?(e.addEntry(s),r=r.insert(n,s)):A(Is,"Ignoring outdated watch update for ",n,". Current version:",o.version," Watch version:",s.version)}),{ks:r,qs:i}})}function Rs(t,e){const n=M(t);return n.persistence.runTransaction("Get next mutation batch","readonly",t=>(void 0===e&&(e=kt),n.mutationQueue.getNextMutationBatchAfterBatchId(t,e)))}function xs(t,e){const n=M(t);return n.persistence.runTransaction("Allocate target","readwrite",t=>{let r;return n.Pi.getTargetData(t,e).next(i=>i?(r=i,Ct.resolve(r)):n.Pi.allocateTargetId(t).next(i=>(r=new qi(e,i,"TargetPurposeListen",t.currentSequenceNumber),n.Pi.addTargetData(t,r).next(()=>r))))}).then(t=>{const r=n.Ms.get(t.targetId);return(null===r||t.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(n.Ms=n.Ms.insert(t.targetId,t),n.xs.set(e,t.targetId)),t})}async function Os(t,e,n){const r=M(t),i=r.Ms.get(e),s=n?"readwrite":"readwrite-primary";try{n||await r.persistence.runTransaction("Release target",s,t=>r.persistence.referenceDelegate.removeTarget(t,i))}catch(t){if(!Dt(t))throw t;A(Is,`Failed to update sequence numbers for target ${e}: ${t}`)}r.Ms=r.Ms.remove(e),r.xs.delete(i.target)}function Ms(t,e,n){const r=M(t);let i=mt.min(),s=or();return r.persistence.runTransaction("Execute query","readwrite",t=>function(t,e,n){const r=M(t),i=r.xs.get(n);return void 0!==i?Ct.resolve(r.Ms.get(i)):r.Pi.getTargetData(e,n)}(r,t,Fn(e)).next(e=>{if(e)return i=e.lastLimboFreeSnapshotVersion,r.Pi.getMatchingKeysForTargetId(t,e.targetId).next(t=>{s=t})}).next(()=>r.Fs.getDocumentsMatchingQuery(t,e,n?i:mt.min(),n?s:or())).next(t=>(Ls(r,Gn(e),t),{documents:t,Qs:s})))}function Ls(t,e,n){let r=t.Os.get(e)||mt.min();n.forEach((t,e)=>{e.readTime.compareTo(r)>0&&(r=e.readTime)}),t.Os.set(e,r)}class Ps{constructor(){this.activeTargetIds=cr()}zs(t){this.activeTargetIds=this.activeTargetIds.add(t)}js(t){this.activeTargetIds=this.activeTargetIds.delete(t)}Gs(){const t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)}}class Vs{constructor(){this.Mo=new Ps,this.xo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(t){}updateMutationState(t,e,n){}addLocalQueryTarget(t,e=!0){return e&&this.Mo.zs(t),this.xo[t]||"not-current"}updateQueryState(t,e,n){this.xo[t]=e}removeLocalQueryTarget(t){this.Mo.js(t)}isLocalQueryTarget(t){return this.Mo.activeTargetIds.has(t)}clearQueryState(t){delete this.xo[t]}getAllActiveQueryTargets(){return this.Mo.activeTargetIds}isActiveQueryTarget(t){return this.Mo.activeTargetIds.has(t)}start(){return this.Mo=new Ps,Promise.resolve()}handleUserChange(t,e,n){}setOnlineState(t){}shutdown(){}writeSequenceNumber(t){}notifyBundleLoaded(t){}}class Fs{Oo(t){}shutdown(){}}const Us="ConnectivityMonitor";class js{constructor(){this.No=()=>this.Bo(),this.Lo=()=>this.ko(),this.qo=[],this.Qo()}Oo(t){this.qo.push(t)}shutdown(){window.removeEventListener("online",this.No),window.removeEventListener("offline",this.Lo)}Qo(){window.addEventListener("online",this.No),window.addEventListener("offline",this.Lo)}Bo(){A(Us,"Network connectivity changed: AVAILABLE");for(const t of this.qo)t(0)}ko(){A(Us,"Network connectivity changed: UNAVAILABLE");for(const t of this.qo)t(1)}static v(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}let Bs=null;function qs(){return null===Bs?Bs=268435456+Math.round(2147483648*Math.random()):Bs++,"0x"+Bs.toString(16)}const $s="RestConnection",zs={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class Ks{get $o(){return!1}constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;const e=t.ssl?"https":"http",n=encodeURIComponent(this.databaseId.projectId),r=encodeURIComponent(this.databaseId.database);this.Uo=e+"://"+t.host,this.Ko=`projects/${n}/databases/${r}`,this.Wo=this.databaseId.database===ke?`project_id=${n}`:`project_id=${n}&database_id=${r}`}Go(t,e,n,r,i){const s=qs(),o=this.zo(t,e.toUriEncodedString());A($s,`Sending RPC '${t}' ${s}:`,o,n);const a={"google-cloud-resource-prefix":this.Ko,"x-goog-request-params":this.Wo};this.jo(a,r,i);const{host:u}=new URL(o),h=(0,c.zJ)(u);return this.Jo(t,o,a,n,h).then(e=>(A($s,`Received RPC '${t}' ${s}: `,e),e),e=>{throw N($s,`RPC '${t}' ${s} failed with error: `,e,"url: ",o,"request:",n),e})}Ho(t,e,n,r,i,s){return this.Go(t,e,n,r,i)}jo(t,e,n){t["X-Goog-Api-Client"]="gl-js/ fire/"+I,t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),e&&e.headers.forEach((e,n)=>t[n]=e),n&&n.headers.forEach((e,n)=>t[n]=e)}zo(t,e){const n=zs[t];return`${this.Uo}/v1/${e}:${n}`}terminate(){}}class Gs{constructor(t){this.Yo=t.Yo,this.Zo=t.Zo}Xo(t){this.e_=t}t_(t){this.n_=t}r_(t){this.i_=t}onMessage(t){this.s_=t}close(){this.Zo()}send(t){this.Yo(t)}o_(){this.e_()}__(){this.n_()}a_(t){this.i_(t)}u_(t){this.s_(t)}}const Hs="WebChannelConnection";class Qs extends Ks{constructor(t){super(t),this.c_=[],this.forceLongPolling=t.forceLongPolling,this.autoDetectLongPolling=t.autoDetectLongPolling,this.useFetchStreams=t.useFetchStreams,this.longPollingOptions=t.longPollingOptions}Jo(t,e,n,r,i){const s=qs();return new Promise((i,o)=>{const a=new l;a.setWithCredentials(!0),a.listenOnce(f.COMPLETE,()=>{try{switch(a.getLastErrorCode()){case p.NO_ERROR:const e=a.getResponseJson();A(Hs,`XHR for RPC '${t}' ${s} received:`,JSON.stringify(e)),i(e);break;case p.TIMEOUT:A(Hs,`RPC '${t}' ${s} timed out`),o(new P(L.DEADLINE_EXCEEDED,"Request time out"));break;case p.HTTP_ERROR:const n=a.getStatus();if(A(Hs,`RPC '${t}' ${s} failed with status:`,n,"response text:",a.getResponseText()),n>0){let t=a.getResponseJson();Array.isArray(t)&&(t=t[0]);const e=t?.error;if(e&&e.status&&e.message){const t=function(t){const e=t.toLowerCase().replace(/_/g,"-");return Object.values(L).indexOf(e)>=0?e:L.UNKNOWN}(e.status);o(new P(t,e.message))}else o(new P(L.UNKNOWN,"Server responded with status "+a.getStatus()))}else o(new P(L.UNAVAILABLE,"Connection failed."));break;default:R(9055,{l_:t,streamId:s,h_:a.getLastErrorCode(),P_:a.getLastError()})}}finally{A(Hs,`RPC '${t}' ${s} completed.`)}});const c=JSON.stringify(r);A(Hs,`RPC '${t}' ${s} sending request:`,r),a.send(e,"POST",c,n,15)})}T_(t,e,n){const r=qs(),i=[this.Uo,"/","google.firestore.v1.Firestore","/",t,"/channel"],s=w(),o=y(),a={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},c=this.longPollingOptions.timeoutSeconds;void 0!==c&&(a.longPollingTimeout=Math.round(1e3*c)),this.useFetchStreams&&(a.useFetchStreams=!0),this.jo(a.initMessageHeaders,e,n),a.encodeInitMessageHeaders=!0;const u=i.join("");A(Hs,`Creating RPC '${t}' stream ${r}: ${u}`,a);const h=s.createWebChannel(u,a);this.I_(h);let l=!1,f=!1;const p=new Gs({Yo:e=>{f?A(Hs,`Not sending because RPC '${t}' stream ${r} is closed:`,e):(l||(A(Hs,`Opening RPC '${t}' stream ${r} transport.`),h.open(),l=!0),A(Hs,`RPC '${t}' stream ${r} sending:`,e),h.send(e))},Zo:()=>h.close()}),v=(t,e,n)=>{t.listen(e,t=>{try{n(t)}catch(t){setTimeout(()=>{throw t},0)}})};return v(h,d.EventType.OPEN,()=>{f||(A(Hs,`RPC '${t}' stream ${r} transport opened.`),p.o_())}),v(h,d.EventType.CLOSE,()=>{f||(f=!0,A(Hs,`RPC '${t}' stream ${r} transport closed`),p.a_(),this.E_(h))}),v(h,d.EventType.ERROR,e=>{f||(f=!0,N(Hs,`RPC '${t}' stream ${r} transport errored. Name:`,e.name,"Message:",e.message),p.a_(new P(L.UNAVAILABLE,"The operation could not be completed")))}),v(h,d.EventType.MESSAGE,e=>{if(!f){const n=e.data[0];O(!!n,16349);const i=n,s=i?.error||i[0]?.error;if(s){A(Hs,`RPC '${t}' stream ${r} received error:`,s);const e=s.status;let n=function(t){const e=zr[t];if(void 0!==e)return Hr(e)}(e),i=s.message;void 0===n&&(n=L.INTERNAL,i="Unknown error status: "+e+" with message "+s.message),f=!0,p.a_(new P(n,i)),h.close()}else A(Hs,`RPC '${t}' stream ${r} received:`,n),p.u_(n)}}),v(o,m.STAT_EVENT,e=>{e.stat===g.PROXY?A(Hs,`RPC '${t}' stream ${r} detected buffering proxy`):e.stat===g.NOPROXY&&A(Hs,`RPC '${t}' stream ${r} detected no buffering proxy`)}),setTimeout(()=>{p.__()},0),p}terminate(){this.c_.forEach(t=>t.close()),this.c_=[]}I_(t){this.c_.push(t)}E_(t){this.c_=this.c_.filter(e=>e===t)}}function Ws(){return"undefined"!=typeof document?document:null}function Xs(t){return new fi(t,!0)}class Ys{constructor(t,e,n=1e3,r=1.5,i=6e4){this.Mi=t,this.timerId=e,this.d_=n,this.A_=r,this.R_=i,this.V_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.V_=0}g_(){this.V_=this.R_}p_(t){this.cancel();const e=Math.floor(this.V_+this.y_()),n=Math.max(0,Date.now()-this.f_),r=Math.max(0,e-n);r>0&&A("ExponentialBackoff",`Backing off for ${r} ms (base delay: ${this.V_} ms, delay with jitter: ${e} ms, last attempt: ${n} ms ago)`),this.m_=this.Mi.enqueueAfterDelay(this.timerId,r,()=>(this.f_=Date.now(),t())),this.V_*=this.A_,this.V_<this.d_&&(this.V_=this.d_),this.V_>this.R_&&(this.V_=this.R_)}w_(){null!==this.m_&&(this.m_.skipDelay(),this.m_=null)}cancel(){null!==this.m_&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.V_}}const Js="PersistentStream";class Zs{constructor(t,e,n,r,i,s,o,a){this.Mi=t,this.S_=n,this.b_=r,this.connection=i,this.authCredentialsProvider=s,this.appCheckCredentialsProvider=o,this.listener=a,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new Ys(t,e)}x_(){return 1===this.state||5===this.state||this.O_()}O_(){return 2===this.state||3===this.state}start(){this.F_=0,4!==this.state?this.auth():this.N_()}async stop(){this.x_()&&await this.close(0)}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&null===this.C_&&(this.C_=this.Mi.enqueueAfterDelay(this.S_,6e4,()=>this.k_()))}q_(t){this.Q_(),this.stream.send(t)}async k_(){if(this.O_())return this.close(0)}Q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(t,e){this.Q_(),this.U_(),this.M_.cancel(),this.D_++,4!==t?this.M_.reset():e&&e.code===L.RESOURCE_EXHAUSTED?(D(e.toString()),D("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):e&&e.code===L.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.K_(),this.stream.close(),this.stream=null),this.state=t,await this.listener.r_(e)}K_(){}auth(){this.state=1;const t=this.W_(this.D_),e=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([t,n])=>{this.D_===e&&this.G_(t,n)},e=>{t(()=>{const t=new P(L.UNKNOWN,"Fetching auth token failed: "+e.message);return this.z_(t)})})}G_(t,e){const n=this.W_(this.D_);this.stream=this.j_(t,e),this.stream.Xo(()=>{n(()=>this.listener.Xo())}),this.stream.t_(()=>{n(()=>(this.state=2,this.v_=this.Mi.enqueueAfterDelay(this.b_,1e4,()=>(this.O_()&&(this.state=3),Promise.resolve())),this.listener.t_()))}),this.stream.r_(t=>{n(()=>this.z_(t))}),this.stream.onMessage(t=>{n(()=>1==++this.F_?this.J_(t):this.onNext(t))})}N_(){this.state=5,this.M_.p_(async()=>{this.state=0,this.start()})}z_(t){return A(Js,`close with error: ${t}`),this.stream=null,this.close(4,t)}W_(t){return e=>{this.Mi.enqueueAndForget(()=>this.D_===t?e():(A(Js,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class to extends Zs{constructor(t,e,n,r,i,s){super(t,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",e,n,r,s),this.serializer=i}j_(t,e){return this.connection.T_("Listen",t,e)}J_(t){return this.onNext(t)}onNext(t){this.M_.reset();const e=function(t,e){let n;if("targetChange"in e){e.targetChange;const r=function(t){return"NO_CHANGE"===t?0:"ADD"===t?1:"REMOVE"===t?2:"CURRENT"===t?3:"RESET"===t?4:R(39313,{state:t})}(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],s=function(t,e){return t.useProto3Json?(O(void 0===e||"string"==typeof e,58123),ye.fromBase64String(e||"")):(O(void 0===e||e instanceof Buffer||e instanceof Uint8Array,16193),ye.fromUint8Array(e||new Uint8Array))}(t,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&function(t){const e=void 0===t.code?L.UNKNOWN:Hr(t.code);return new P(e,t.message||"")}(o);n=new si(r,i,s,a||null)}else if("documentChange"in e){e.documentChange;const r=e.documentChange;r.document,r.document.name,r.document.updateTime;const i=_i(t,r.document.name),s=wi(r.document.updateTime),o=r.document.createTime?wi(r.document.createTime):mt.min(),a=new en({mapValue:{fields:r.document.fields}}),c=rn.newFoundDocument(i,s,o,a),u=r.targetIds||[],h=r.removedTargetIds||[];n=new ri(u,h,c.key,c)}else if("documentDelete"in e){e.documentDelete;const r=e.documentDelete;r.document;const i=_i(t,r.document),s=r.readTime?wi(r.readTime):mt.min(),o=rn.newNoDocument(i,s),a=r.removedTargetIds||[];n=new ri([],a,o.key,o)}else if("documentRemove"in e){e.documentRemove;const r=e.documentRemove;r.document;const i=_i(t,r.document),s=r.removedTargetIds||[];n=new ri([],s,i,null)}else{if(!("filter"in e))return R(11601,{Rt:e});{e.filter;const t=e.filter;t.targetId;const{count:r=0,unchangedNames:i}=t,s=new $r(r,i),o=t.targetId;n=new ii(o,s)}}return n}(this.serializer,t),n=function(t){if(!("targetChange"in t))return mt.min();const e=t.targetChange;return e.targetIds&&e.targetIds.length?mt.min():e.readTime?wi(e.readTime):mt.min()}(t);return this.listener.H_(e,n)}Y_(t){const e={};e.database=Ci(this.serializer),e.addTarget=function(t,e){let n;const r=e.target;if(n=Rn(r)?{documents:ki(t,r)}:{query:Ri(t,r).ft},n.targetId=e.targetId,e.resumeToken.approximateByteSize()>0){n.resumeToken=mi(t,e.resumeToken);const r=pi(t,e.expectedCount);null!==r&&(n.expectedCount=r)}else if(e.snapshotVersion.compareTo(mt.min())>0){n.readTime=gi(t,e.snapshotVersion.toTimestamp());const r=pi(t,e.expectedCount);null!==r&&(n.expectedCount=r)}return n}(this.serializer,t);const n=function(t,e){const n=function(t){switch(t){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return R(28987,{purpose:t})}}(e.purpose);return null==n?null:{"goog-listen-tags":n}}(this.serializer,t);n&&(e.labels=n),this.q_(e)}Z_(t){const e={};e.database=Ci(this.serializer),e.removeTarget=t,this.q_(e)}}class eo extends Zs{constructor(t,e,n,r,i,s){super(t,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",e,n,r,s),this.serializer=i}get X_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}K_(){this.X_&&this.ea([])}j_(t,e){return this.connection.T_("Write",t,e)}J_(t){return O(!!t.streamToken,31322),this.lastStreamToken=t.streamToken,O(!t.writeResults||0===t.writeResults.length,55816),this.listener.ta()}onNext(t){O(!!t.streamToken,12678),this.lastStreamToken=t.streamToken,this.M_.reset();const e=function(t,e){return t&&t.length>0?(O(void 0!==e,14353),t.map(t=>function(t,e){let n=t.updateTime?wi(t.updateTime):wi(e);return n.isEqual(mt.min())&&(n=wi(e)),new Ir(n,t.transformResults||[])}(t,e))):[]}(t.writeResults,t.commitTime),n=wi(t.commitTime);return this.listener.na(n,e)}ra(){const t={};t.database=Ci(this.serializer),this.q_(t)}ea(t){const e={streamToken:this.lastStreamToken,writes:t.map(t=>Ni(this.serializer,t))};this.q_(e)}}class no{}class ro extends no{constructor(t,e,n,r){super(),this.authCredentials=t,this.appCheckCredentials=e,this.connection=n,this.serializer=r,this.ia=!1}sa(){if(this.ia)throw new P(L.FAILED_PRECONDITION,"The client has already been terminated.")}Go(t,e,n,r){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([i,s])=>this.connection.Go(t,bi(e,n),r,i,s)).catch(t=>{throw"FirebaseError"===t.name?(t.code===L.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),t):new P(L.UNKNOWN,t.toString())})}Ho(t,e,n,r,i){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,o])=>this.connection.Ho(t,bi(e,n),r,s,o,i)).catch(t=>{throw"FirebaseError"===t.name?(t.code===L.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),t):new P(L.UNKNOWN,t.toString())})}terminate(){this.ia=!0,this.connection.terminate()}}class io{constructor(t,e){this.asyncQueue=t,this.onlineStateHandler=e,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){0===this.oa&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve())))}ha(t){"Online"===this.state?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${t.toString()}`),this.ca("Offline")))}set(t){this.Pa(),this.oa=0,"Online"===t&&(this.aa=!1),this.ca(t)}ca(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))}la(t){const e=`Could not reach Cloud Firestore backend. ${t}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(D(e),this.aa=!1):A("OnlineStateTracker",e)}Pa(){null!==this._a&&(this._a.cancel(),this._a=null)}}const so="RemoteStore";class oo{constructor(t,e,n,r,i){this.localStore=t,this.datastore=e,this.asyncQueue=n,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.da=[],this.Aa=i,this.Aa.Oo(t=>{n.enqueueAndForget(async()=>{mo(this)&&(A(so,"Restarting streams for network reachability change."),await async function(t){const e=M(t);e.Ea.add(4),await co(e),e.Ra.set("Unknown"),e.Ea.delete(4),await ao(e)}(this))})}),this.Ra=new io(n,r)}}async function ao(t){if(mo(t))for(const e of t.da)await e(!0)}async function co(t){for(const e of t.da)await e(!1)}function uo(t,e){const n=M(t);n.Ia.has(e.targetId)||(n.Ia.set(e.targetId,e),go(n)?po(n):Lo(n).O_()&&lo(n,e))}function ho(t,e){const n=M(t),r=Lo(n);n.Ia.delete(e),r.O_()&&fo(n,e),0===n.Ia.size&&(r.O_()?r.L_():mo(n)&&n.Ra.set("Unknown"))}function lo(t,e){if(t.Va.Ue(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(mt.min())>0){const n=t.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(n)}Lo(t).Y_(e)}function fo(t,e){t.Va.Ue(e),Lo(t).Z_(e)}function po(t){t.Va=new ai({getRemoteKeysForTarget:e=>t.remoteSyncer.getRemoteKeysForTarget(e),At:e=>t.Ia.get(e)||null,ht:()=>t.datastore.serializer.databaseId}),Lo(t).start(),t.Ra.ua()}function go(t){return mo(t)&&!Lo(t).x_()&&t.Ia.size>0}function mo(t){return 0===M(t).Ea.size}function yo(t){t.Va=void 0}async function wo(t){t.Ra.set("Online")}async function vo(t){t.Ia.forEach((e,n)=>{lo(t,e)})}async function bo(t,e){yo(t),go(t)?(t.Ra.ha(e),po(t)):t.Ra.set("Unknown")}async function Eo(t,e,n){if(t.Ra.set("Online"),e instanceof si&&2===e.state&&e.cause)try{await async function(t,e){const n=e.cause;for(const r of e.targetIds)t.Ia.has(r)&&(await t.remoteSyncer.rejectListen(r,n),t.Ia.delete(r),t.Va.removeTarget(r))}(t,e)}catch(n){A(so,"Failed to remove targets %s: %s ",e.targetIds.join(","),n),await To(t,n)}else if(e instanceof ri?t.Va.Ze(e):e instanceof ii?t.Va.st(e):t.Va.tt(e),!n.isEqual(mt.min()))try{const e=await Ns(t.localStore);n.compareTo(e)>=0&&await function(t,e){const n=t.Va.Tt(e);return n.targetChanges.forEach((n,r)=>{if(n.resumeToken.approximateByteSize()>0){const i=t.Ia.get(r);i&&t.Ia.set(r,i.withResumeToken(n.resumeToken,e))}}),n.targetMismatches.forEach((e,n)=>{const r=t.Ia.get(e);if(!r)return;t.Ia.set(e,r.withResumeToken(ye.EMPTY_BYTE_STRING,r.snapshotVersion)),fo(t,e);const i=new qi(r.target,e,n,r.sequenceNumber);lo(t,i)}),t.remoteSyncer.applyRemoteEvent(n)}(t,n)}catch(e){A(so,"Failed to raise snapshot:",e),await To(t,e)}}async function To(t,e,n){if(!Dt(e))throw e;t.Ea.add(1),await co(t),t.Ra.set("Offline"),n||(n=()=>Ns(t.localStore)),t.asyncQueue.enqueueRetryable(async()=>{A(so,"Retrying IndexedDB access"),await n(),t.Ea.delete(1),await ao(t)})}function _o(t,e){return e().catch(n=>To(t,n,e))}async function Io(t){const e=M(t),n=Po(e);let r=e.Ta.length>0?e.Ta[e.Ta.length-1].batchId:kt;for(;So(e);)try{const t=await Rs(e.localStore,r);if(null===t){0===e.Ta.length&&n.L_();break}r=t.batchId,Co(e,t)}catch(t){await To(e,t)}Ao(e)&&Do(e)}function So(t){return mo(t)&&t.Ta.length<10}function Co(t,e){t.Ta.push(e);const n=Po(t);n.O_()&&n.X_&&n.ea(e.mutations)}function Ao(t){return mo(t)&&!Po(t).x_()&&t.Ta.length>0}function Do(t){Po(t).start()}async function No(t){Po(t).ra()}async function ko(t){const e=Po(t);for(const n of t.Ta)e.ea(n.mutations)}async function Ro(t,e,n){const r=t.Ta.shift(),i=Br.from(r,e,n);await _o(t,()=>t.remoteSyncer.applySuccessfulWrite(i)),await Io(t)}async function xo(t,e){e&&Po(t).X_&&await async function(t,e){if(function(t){return Gr(t)&&t!==L.ABORTED}(e.code)){const n=t.Ta.shift();Po(t).B_(),await _o(t,()=>t.remoteSyncer.rejectFailedWrite(n.batchId,e)),await Io(t)}}(t,e),Ao(t)&&Do(t)}async function Oo(t,e){const n=M(t);n.asyncQueue.verifyOperationInProgress(),A(so,"RemoteStore received new credentials");const r=mo(n);n.Ea.add(3),await co(n),r&&n.Ra.set("Unknown"),await n.remoteSyncer.handleCredentialChange(e),n.Ea.delete(3),await ao(n)}async function Mo(t,e){const n=M(t);e?(n.Ea.delete(2),await ao(n)):e||(n.Ea.add(2),await co(n),n.Ra.set("Unknown"))}function Lo(t){return t.ma||(t.ma=function(t,e,n){const r=M(t);return r.sa(),new to(e,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,n)}(t.datastore,t.asyncQueue,{Xo:wo.bind(null,t),t_:vo.bind(null,t),r_:bo.bind(null,t),H_:Eo.bind(null,t)}),t.da.push(async e=>{e?(t.ma.B_(),go(t)?po(t):t.Ra.set("Unknown")):(await t.ma.stop(),yo(t))})),t.ma}function Po(t){return t.fa||(t.fa=function(t,e,n){const r=M(t);return r.sa(),new eo(e,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,n)}(t.datastore,t.asyncQueue,{Xo:()=>Promise.resolve(),t_:No.bind(null,t),r_:xo.bind(null,t),ta:ko.bind(null,t),na:Ro.bind(null,t)}),t.da.push(async e=>{e?(t.fa.B_(),await Io(t)):(await t.fa.stop(),t.Ta.length>0&&(A(so,`Stopping write stream with ${t.Ta.length} pending writes`),t.Ta=[]))})),t.fa}class Vo{constructor(t,e,n,r,i){this.asyncQueue=t,this.timerId=e,this.targetTimeMs=n,this.op=r,this.removalCallback=i,this.deferred=new V,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(t=>{})}get promise(){return this.deferred.promise}static createAndSchedule(t,e,n,r,i){const s=Date.now()+n,o=new Vo(t,e,s,r,i);return o.start(n),o}start(t){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),t)}skipDelay(){return this.handleDelayElapsed()}cancel(t){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new P(L.CANCELLED,"Operation cancelled"+(t?": "+t:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(t=>this.deferred.resolve(t))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Fo(t,e){if(D("AsyncQueue",`${e}: ${t}`),Dt(t))return new P(L.UNAVAILABLE,`${e}: ${t}`);throw t}class Uo{static emptySet(t){return new Uo(t.comparator)}constructor(t){this.comparator=t?(e,n)=>t(e,n)||it.comparator(e.key,n.key):(t,e)=>it.comparator(t.key,e.key),this.keyedMap=Zn(),this.sortedSet=new he(this.comparator)}has(t){return null!=this.keyedMap.get(t)}get(t){return this.keyedMap.get(t)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(t){const e=this.keyedMap.get(t);return e?this.sortedSet.indexOf(e):-1}get size(){return this.sortedSet.size}forEach(t){this.sortedSet.inorderTraversal((e,n)=>(t(e),!1))}add(t){const e=this.delete(t.key);return e.copy(e.keyedMap.insert(t.key,t),e.sortedSet.insert(t,null))}delete(t){const e=this.get(t);return e?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(e)):this}isEqual(t){if(!(t instanceof Uo))return!1;if(this.size!==t.size)return!1;const e=this.sortedSet.getIterator(),n=t.sortedSet.getIterator();for(;e.hasNext();){const t=e.getNext().key,r=n.getNext().key;if(!t.isEqual(r))return!1}return!0}toString(){const t=[];return this.forEach(e=>{t.push(e.toString())}),0===t.length?"DocumentSet ()":"DocumentSet (\n  "+t.join("  \n")+"\n)"}copy(t,e){const n=new Uo;return n.comparator=this.comparator,n.keyedMap=t,n.sortedSet=e,n}}class jo{constructor(){this.ga=new he(it.comparator)}track(t){const e=t.doc.key,n=this.ga.get(e);n?0!==t.type&&3===n.type?this.ga=this.ga.insert(e,t):3===t.type&&1!==n.type?this.ga=this.ga.insert(e,{type:n.type,doc:t.doc}):2===t.type&&2===n.type?this.ga=this.ga.insert(e,{type:2,doc:t.doc}):2===t.type&&0===n.type?this.ga=this.ga.insert(e,{type:0,doc:t.doc}):1===t.type&&0===n.type?this.ga=this.ga.remove(e):1===t.type&&2===n.type?this.ga=this.ga.insert(e,{type:1,doc:n.doc}):0===t.type&&1===n.type?this.ga=this.ga.insert(e,{type:2,doc:t.doc}):R(63341,{Rt:t,pa:n}):this.ga=this.ga.insert(e,t)}ya(){const t=[];return this.ga.inorderTraversal((e,n)=>{t.push(n)}),t}}class Bo{constructor(t,e,n,r,i,s,o,a,c){this.query=t,this.docs=e,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=i,this.fromCache=s,this.syncStateChanged=o,this.excludesMetadataChanges=a,this.hasCachedResults=c}static fromInitialDocuments(t,e,n,r,i){const s=[];return e.forEach(t=>{s.push({type:0,doc:t})}),new Bo(t,e,Uo.emptySet(e),s,n,r,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(t){if(!(this.fromCache===t.fromCache&&this.hasCachedResults===t.hasCachedResults&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&qn(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;const e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(let r=0;r<e.length;r++)if(e[r].type!==n[r].type||!e[r].doc.isEqual(n[r].doc))return!1;return!0}}class qo{constructor(){this.wa=void 0,this.Sa=[]}ba(){return this.Sa.some(t=>t.Da())}}class $o{constructor(){this.queries=zo(),this.onlineState="Unknown",this.Ca=new Set}terminate(){!function(t,e){const n=M(t),r=n.queries;n.queries=zo(),r.forEach((t,n)=>{for(const r of n.Sa)r.onError(e)})}(this,new P(L.ABORTED,"Firestore shutting down"))}}function zo(){return new Wn(t=>$n(t),qn)}async function Ko(t,e){const n=M(t);let r=3;const i=e.query;let s=n.queries.get(i);s?!s.ba()&&e.Da()&&(r=2):(s=new qo,r=e.Da()?0:1);try{switch(r){case 0:s.wa=await n.onListen(i,!0);break;case 1:s.wa=await n.onListen(i,!1);break;case 2:await n.onFirstRemoteStoreListen(i)}}catch(t){const n=Fo(t,`Initialization of query '${zn(e.query)}' failed`);return void e.onError(n)}n.queries.set(i,s),s.Sa.push(e),e.va(n.onlineState),s.wa&&e.Fa(s.wa)&&Wo(n)}async function Go(t,e){const n=M(t),r=e.query;let i=3;const s=n.queries.get(r);if(s){const t=s.Sa.indexOf(e);t>=0&&(s.Sa.splice(t,1),0===s.Sa.length?i=e.Da()?0:1:!s.ba()&&e.Da()&&(i=2))}switch(i){case 0:return n.queries.delete(r),n.onUnlisten(r,!0);case 1:return n.queries.delete(r),n.onUnlisten(r,!1);case 2:return n.onLastRemoteStoreUnlisten(r);default:return}}function Ho(t,e){const n=M(t);let r=!1;for(const i of e){const t=i.query,e=n.queries.get(t);if(e){for(const t of e.Sa)t.Fa(i)&&(r=!0);e.wa=i}}r&&Wo(n)}function Qo(t,e,n){const r=M(t),i=r.queries.get(e);if(i)for(const s of i.Sa)s.onError(n);r.queries.delete(e)}function Wo(t){t.Ca.forEach(t=>{t.next()})}var Xo,Yo;(Yo=Xo||(Xo={})).Ma="default",Yo.Cache="cache";class Jo{constructor(t,e,n){this.query=t,this.xa=e,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=n||{}}Fa(t){if(!this.options.includeMetadataChanges){const e=[];for(const n of t.docChanges)3!==n.type&&e.push(n);t=new Bo(t.query,t.docs,t.oldDocs,e,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0,t.hasCachedResults)}let e=!1;return this.Oa?this.Ba(t)&&(this.xa.next(t),e=!0):this.La(t,this.onlineState)&&(this.ka(t),e=!0),this.Na=t,e}onError(t){this.xa.error(t)}va(t){this.onlineState=t;let e=!1;return this.Na&&!this.Oa&&this.La(this.Na,t)&&(this.ka(this.Na),e=!0),e}La(t,e){if(!t.fromCache)return!0;if(!this.Da())return!0;const n="Offline"!==e;return(!this.options.qa||!n)&&(!t.docs.isEmpty()||t.hasCachedResults||"Offline"===e)}Ba(t){if(t.docChanges.length>0)return!0;const e=this.Na&&this.Na.hasPendingWrites!==t.hasPendingWrites;return!(!t.syncStateChanged&&!e)&&!0===this.options.includeMetadataChanges}ka(t){t=Bo.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache,t.hasCachedResults),this.Oa=!0,this.xa.next(t)}Da(){return this.options.source!==Xo.Cache}}class Zo{constructor(t){this.key=t}}class ta{constructor(t){this.key=t}}class ea{constructor(t,e){this.query=t,this.Ya=e,this.Za=null,this.hasCachedResults=!1,this.current=!1,this.Xa=or(),this.mutatedKeys=or(),this.eu=Hn(t),this.tu=new Uo(this.eu)}get nu(){return this.Ya}ru(t,e){const n=e?e.iu:new jo,r=e?e.tu:this.tu;let i=e?e.mutatedKeys:this.mutatedKeys,s=r,o=!1;const a="F"===this.query.limitType&&r.size===this.query.limit?r.last():null,c="L"===this.query.limitType&&r.size===this.query.limit?r.first():null;if(t.inorderTraversal((t,e)=>{const u=r.get(t),h=Kn(this.query,e)?e:null,l=!!u&&this.mutatedKeys.has(u.key),d=!!h&&(h.hasLocalMutations||this.mutatedKeys.has(h.key)&&h.hasCommittedMutations);let f=!1;u&&h?u.data.isEqual(h.data)?l!==d&&(n.track({type:3,doc:h}),f=!0):this.su(u,h)||(n.track({type:2,doc:h}),f=!0,(a&&this.eu(h,a)>0||c&&this.eu(h,c)<0)&&(o=!0)):!u&&h?(n.track({type:0,doc:h}),f=!0):u&&!h&&(n.track({type:1,doc:u}),f=!0,(a||c)&&(o=!0)),f&&(h?(s=s.add(h),i=d?i.add(t):i.delete(t)):(s=s.delete(t),i=i.delete(t)))}),null!==this.query.limit)for(;s.size>this.query.limit;){const t="F"===this.query.limitType?s.last():s.first();s=s.delete(t.key),i=i.delete(t.key),n.track({type:1,doc:t})}return{tu:s,iu:n,Cs:o,mutatedKeys:i}}su(t,e){return t.hasLocalMutations&&e.hasCommittedMutations&&!e.hasLocalMutations}applyChanges(t,e,n,r){const i=this.tu;this.tu=t.tu,this.mutatedKeys=t.mutatedKeys;const s=t.iu.ya();s.sort((t,e)=>function(t,e){const n=t=>{switch(t){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return R(20277,{Rt:t})}};return n(t)-n(e)}(t.type,e.type)||this.eu(t.doc,e.doc)),this.ou(n),r=r??!1;const o=e&&!r?this._u():[],a=0===this.Xa.size&&this.current&&!r?1:0,c=a!==this.Za;return this.Za=a,0!==s.length||c?{snapshot:new Bo(this.query,t.tu,i,s,t.mutatedKeys,0===a,c,!1,!!n&&n.resumeToken.approximateByteSize()>0),au:o}:{au:o}}va(t){return this.current&&"Offline"===t?(this.current=!1,this.applyChanges({tu:this.tu,iu:new jo,mutatedKeys:this.mutatedKeys,Cs:!1},!1)):{au:[]}}uu(t){return!this.Ya.has(t)&&!!this.tu.has(t)&&!this.tu.get(t).hasLocalMutations}ou(t){t&&(t.addedDocuments.forEach(t=>this.Ya=this.Ya.add(t)),t.modifiedDocuments.forEach(t=>{}),t.removedDocuments.forEach(t=>this.Ya=this.Ya.delete(t)),this.current=t.current)}_u(){if(!this.current)return[];const t=this.Xa;this.Xa=or(),this.tu.forEach(t=>{this.uu(t.key)&&(this.Xa=this.Xa.add(t.key))});const e=[];return t.forEach(t=>{this.Xa.has(t)||e.push(new ta(t))}),this.Xa.forEach(n=>{t.has(n)||e.push(new Zo(n))}),e}cu(t){this.Ya=t.Qs,this.Xa=or();const e=this.ru(t.documents);return this.applyChanges(e,!0)}lu(){return Bo.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,0===this.Za,this.hasCachedResults)}}const na="SyncEngine";class ra{constructor(t,e,n){this.query=t,this.targetId=e,this.view=n}}class ia{constructor(t){this.key=t,this.hu=!1}}class sa{constructor(t,e,n,r,i,s){this.localStore=t,this.remoteStore=e,this.eventManager=n,this.sharedClientState=r,this.currentUser=i,this.maxConcurrentLimboResolutions=s,this.Pu={},this.Tu=new Wn(t=>$n(t),qn),this.Iu=new Map,this.Eu=new Set,this.du=new he(it.comparator),this.Au=new Map,this.Ru=new ls,this.Vu={},this.mu=new Map,this.fu=Yi.cr(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return!0===this.gu}}async function oa(t,e,n=!0){const r=Aa(t);let i;const s=r.Tu.get(e);return s?(r.sharedClientState.addLocalQueryTarget(s.targetId),i=s.view.lu()):i=await ca(r,e,n,!0),i}async function aa(t,e){const n=Aa(t);await ca(n,e,!0,!1)}async function ca(t,e,n,r){const i=await xs(t.localStore,Fn(e)),s=i.targetId,o=t.sharedClientState.addLocalQueryTarget(s,n);let a;return r&&(a=await ua(t,e,s,"current"===o,i.resumeToken)),t.isPrimaryClient&&n&&uo(t.remoteStore,i),a}async function ua(t,e,n,r,i){t.pu=(e,n,r)=>async function(t,e,n,r){let i=e.view.ru(n);i.Cs&&(i=await Ms(t.localStore,e.query,!1).then(({documents:t})=>e.view.ru(t,i)));const s=r&&r.targetChanges.get(e.targetId),o=r&&null!=r.targetMismatches.get(e.targetId),a=e.view.applyChanges(i,t.isPrimaryClient,s,o);return Ea(t,e.targetId,a.au),a.snapshot}(t,e,n,r);const s=await Ms(t.localStore,e,!0),o=new ea(e,s.Qs),a=o.ru(s.documents),c=ni.createSynthesizedTargetChangeForCurrentChange(n,r&&"Offline"!==t.onlineState,i),u=o.applyChanges(a,t.isPrimaryClient,c);Ea(t,n,u.au);const h=new ra(e,n,o);return t.Tu.set(e,h),t.Iu.has(n)?t.Iu.get(n).push(e):t.Iu.set(n,[e]),u.snapshot}async function ha(t,e,n){const r=M(t),i=r.Tu.get(e),s=r.Iu.get(i.targetId);if(s.length>1)return r.Iu.set(i.targetId,s.filter(t=>!qn(t,e))),void r.Tu.delete(e);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(i.targetId),r.sharedClientState.isActiveQueryTarget(i.targetId)||await Os(r.localStore,i.targetId,!1).then(()=>{r.sharedClientState.clearQueryState(i.targetId),n&&ho(r.remoteStore,i.targetId),va(r,i.targetId)}).catch(St)):(va(r,i.targetId),await Os(r.localStore,i.targetId,!0))}async function la(t,e){const n=M(t),r=n.Tu.get(e),i=n.Iu.get(r.targetId);n.isPrimaryClient&&1===i.length&&(n.sharedClientState.removeLocalQueryTarget(r.targetId),ho(n.remoteStore,r.targetId))}async function da(t,e){const n=M(t);try{const t=await function(t,e){const n=M(t),r=e.snapshotVersion;let i=n.Ms;return n.persistence.runTransaction("Apply remote event","readwrite-primary",t=>{const s=n.Ns.newChangeBuffer({trackRemovals:!0});i=n.Ms;const o=[];e.targetChanges.forEach((s,a)=>{const c=i.get(a);if(!c)return;o.push(n.Pi.removeMatchingKeys(t,s.removedDocuments,a).next(()=>n.Pi.addMatchingKeys(t,s.addedDocuments,a)));let u=c.withSequenceNumber(t.currentSequenceNumber);null!==e.targetMismatches.get(a)?u=u.withResumeToken(ye.EMPTY_BYTE_STRING,mt.min()).withLastLimboFreeSnapshotVersion(mt.min()):s.resumeToken.approximateByteSize()>0&&(u=u.withResumeToken(s.resumeToken,r)),i=i.insert(a,u),function(t,e,n){return 0===t.resumeToken.approximateByteSize()||(e.snapshotVersion.toMicroseconds()-t.snapshotVersion.toMicroseconds()>=Ss||n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size>0)}(c,u,s)&&o.push(n.Pi.updateTargetData(t,u))});let a=Yn(),c=or();if(e.documentUpdates.forEach(r=>{e.resolvedLimboDocuments.has(r)&&o.push(n.persistence.referenceDelegate.updateLimboDocument(t,r))}),o.push(ks(t,s,e.documentUpdates).next(t=>{a=t.ks,c=t.qs})),!r.isEqual(mt.min())){const e=n.Pi.getLastRemoteSnapshotVersion(t).next(e=>n.Pi.setTargetsMetadata(t,t.currentSequenceNumber,r));o.push(e)}return Ct.waitFor(o).next(()=>s.apply(t)).next(()=>n.localDocuments.getLocalViewOfDocuments(t,a,c)).next(()=>a)}).then(t=>(n.Ms=i,t))}(n.localStore,e);e.targetChanges.forEach((t,e)=>{const r=n.Au.get(e);r&&(O(t.addedDocuments.size+t.modifiedDocuments.size+t.removedDocuments.size<=1,22616),t.addedDocuments.size>0?r.hu=!0:t.modifiedDocuments.size>0?O(r.hu,14607):t.removedDocuments.size>0&&(O(r.hu,42227),r.hu=!1))}),await Ia(n,t,e)}catch(t){await St(t)}}function fa(t,e,n){const r=M(t);if(r.isPrimaryClient&&0===n||!r.isPrimaryClient&&1===n){const t=[];r.Tu.forEach((n,r)=>{const i=r.view.va(e);i.snapshot&&t.push(i.snapshot)}),function(t,e){const n=M(t);n.onlineState=e;let r=!1;n.queries.forEach((t,n)=>{for(const i of n.Sa)i.va(e)&&(r=!0)}),r&&Wo(n)}(r.eventManager,e),t.length&&r.Pu.H_(t),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}async function pa(t,e,n){const r=M(t);r.sharedClientState.updateQueryState(e,"rejected",n);const i=r.Au.get(e),s=i&&i.key;if(s){let t=new he(it.comparator);t=t.insert(s,rn.newNoDocument(s,mt.min()));const n=or().add(s),i=new ei(mt.min(),new Map,new he(H),t,n);await da(r,i),r.du=r.du.remove(s),r.Au.delete(e),_a(r)}else await Os(r.localStore,e,!1).then(()=>va(r,e,n)).catch(St)}async function ga(t,e){const n=M(t),r=e.batch.batchId;try{const t=await function(t,e){const n=M(t);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",t=>{const r=e.batch.keys(),i=n.Ns.newChangeBuffer({trackRemovals:!0});return function(t,e,n,r){const i=n.batch,s=i.keys();let o=Ct.resolve();return s.forEach(t=>{o=o.next(()=>r.getEntry(e,t)).next(e=>{const s=n.docVersions.get(t);O(null!==s,48541),e.version.compareTo(s)<0&&(i.applyToRemoteDocument(e,n),e.isValidDocument()&&(e.setReadTime(n.commitVersion),r.addEntry(e)))})}),o.next(()=>t.mutationQueue.removeMutationBatch(e,i))}(n,t,e,i).next(()=>i.apply(t)).next(()=>n.mutationQueue.performConsistencyCheck(t)).next(()=>n.documentOverlayCache.removeOverlaysForBatchId(t,r,e.batch.batchId)).next(()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(t,function(t){let e=or();for(let n=0;n<t.mutationResults.length;++n)t.mutationResults[n].transformResults.length>0&&(e=e.add(t.batch.mutations[n].key));return e}(e))).next(()=>n.localDocuments.getDocuments(t,r))})}(n.localStore,e);wa(n,r,null),ya(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),await Ia(n,t)}catch(t){await St(t)}}async function ma(t,e,n){const r=M(t);try{const t=await function(t,e){const n=M(t);return n.persistence.runTransaction("Reject batch","readwrite-primary",t=>{let r;return n.mutationQueue.lookupMutationBatch(t,e).next(e=>(O(null!==e,37113),r=e.keys(),n.mutationQueue.removeMutationBatch(t,e))).next(()=>n.mutationQueue.performConsistencyCheck(t)).next(()=>n.documentOverlayCache.removeOverlaysForBatchId(t,r,e)).next(()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(t,r)).next(()=>n.localDocuments.getDocuments(t,r))})}(r.localStore,e);wa(r,e,n),ya(r,e),r.sharedClientState.updateMutationState(e,"rejected",n),await Ia(r,t)}catch(n){await St(n)}}function ya(t,e){(t.mu.get(e)||[]).forEach(t=>{t.resolve()}),t.mu.delete(e)}function wa(t,e,n){const r=M(t);let i=r.Vu[r.currentUser.toKey()];if(i){const t=i.get(e);t&&(n?t.reject(n):t.resolve(),i=i.remove(e)),r.Vu[r.currentUser.toKey()]=i}}function va(t,e,n=null){t.sharedClientState.removeLocalQueryTarget(e);for(const r of t.Iu.get(e))t.Tu.delete(r),n&&t.Pu.yu(r,n);t.Iu.delete(e),t.isPrimaryClient&&t.Ru.jr(e).forEach(e=>{t.Ru.containsKey(e)||ba(t,e)})}function ba(t,e){t.Eu.delete(e.path.canonicalString());const n=t.du.get(e);null!==n&&(ho(t.remoteStore,n),t.du=t.du.remove(e),t.Au.delete(n),_a(t))}function Ea(t,e,n){for(const r of n)r instanceof Zo?(t.Ru.addReference(r.key,e),Ta(t,r)):r instanceof ta?(A(na,"Document no longer in limbo: "+r.key),t.Ru.removeReference(r.key,e),t.Ru.containsKey(r.key)||ba(t,r.key)):R(19791,{wu:r})}function Ta(t,e){const n=e.key,r=n.path.canonicalString();t.du.get(n)||t.Eu.has(r)||(A(na,"New document in limbo: "+n),t.Eu.add(r),_a(t))}function _a(t){for(;t.Eu.size>0&&t.du.size<t.maxConcurrentLimboResolutions;){const e=t.Eu.values().next().value;t.Eu.delete(e);const n=new it(et.fromString(e)),r=t.fu.next();t.Au.set(r,new ia(n)),t.du=t.du.insert(n,r),uo(t.remoteStore,new qi(Fn(Mn(n.path)),r,"TargetPurposeLimboResolution",Nt.ce))}}async function Ia(t,e,n){const r=M(t),i=[],s=[],o=[];r.Tu.isEmpty()||(r.Tu.forEach((t,a)=>{o.push(r.pu(a,e,n).then(t=>{if((t||n)&&r.isPrimaryClient){const e=t?!t.fromCache:n?.targetChanges.get(a.targetId)?.current;r.sharedClientState.updateQueryState(a.targetId,e?"current":"not-current")}if(t){i.push(t);const e=Es.As(a.targetId,t);s.push(e)}}))}),await Promise.all(o),r.Pu.H_(i),await async function(t,e){const n=M(t);try{await n.persistence.runTransaction("notifyLocalViewChanges","readwrite",t=>Ct.forEach(e,e=>Ct.forEach(e.Es,r=>n.persistence.referenceDelegate.addReference(t,e.targetId,r)).next(()=>Ct.forEach(e.ds,r=>n.persistence.referenceDelegate.removeReference(t,e.targetId,r)))))}catch(t){if(!Dt(t))throw t;A(Is,"Failed to update sequence numbers: "+t)}for(const r of e){const t=r.targetId;if(!r.fromCache){const e=n.Ms.get(t),r=e.snapshotVersion,i=e.withLastLimboFreeSnapshotVersion(r);n.Ms=n.Ms.insert(t,i)}}}(r.localStore,s))}async function Sa(t,e){const n=M(t);if(!n.currentUser.isEqual(e)){A(na,"User change. New user:",e.toKey());const t=await Ds(n.localStore,e);n.currentUser=e,function(t,e){t.mu.forEach(t=>{t.forEach(t=>{t.reject(new P(L.CANCELLED,e))})}),t.mu.clear()}(n,"'waitForPendingWrites' promise is rejected due to a user change."),n.sharedClientState.handleUserChange(e,t.removedBatchIds,t.addedBatchIds),await Ia(n,t.Ls)}}function Ca(t,e){const n=M(t),r=n.Au.get(e);if(r&&r.hu)return or().add(r.key);{let t=or();const r=n.Iu.get(e);if(!r)return t;for(const e of r){const r=n.Tu.get(e);t=t.unionWith(r.view.nu)}return t}}function Aa(t){const e=M(t);return e.remoteStore.remoteSyncer.applyRemoteEvent=da.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=Ca.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=pa.bind(null,e),e.Pu.H_=Ho.bind(null,e.eventManager),e.Pu.yu=Qo.bind(null,e.eventManager),e}function Da(t){const e=M(t);return e.remoteStore.remoteSyncer.applySuccessfulWrite=ga.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=ma.bind(null,e),e}class Na{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(t){this.serializer=Xs(t.databaseInfo.databaseId),this.sharedClientState=this.Du(t),this.persistence=this.Cu(t),await this.persistence.start(),this.localStore=this.vu(t),this.gcScheduler=this.Fu(t,this.localStore),this.indexBackfillerScheduler=this.Mu(t,this.localStore)}Fu(t,e){return null}Mu(t,e){return null}vu(t){return As(this.persistence,new _s,t.initialUser,this.serializer)}Cu(t){return new ys(vs.mi,this.serializer)}Du(t){return new Vs}async terminate(){this.gcScheduler?.stop(),this.indexBackfillerScheduler?.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}Na.provider={build:()=>new Na};class ka extends Na{constructor(t){super(),this.cacheSizeBytes=t}Fu(t,e){O(this.persistence.referenceDelegate instanceof bs,46915);const n=this.persistence.referenceDelegate.garbageCollector;return new ns(n,t.asyncQueue,e)}Cu(t){const e=void 0!==this.cacheSizeBytes?Xi.withCacheSize(this.cacheSizeBytes):Xi.DEFAULT;return new ys(t=>bs.mi(t,e),this.serializer)}}class Ra{async initialize(t,e){this.localStore||(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(e),this.remoteStore=this.createRemoteStore(e),this.eventManager=this.createEventManager(e),this.syncEngine=this.createSyncEngine(e,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=t=>fa(this.syncEngine,t,1),this.remoteStore.remoteSyncer.handleCredentialChange=Sa.bind(null,this.syncEngine),await Mo(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(t){return new $o}createDatastore(t){const e=Xs(t.databaseInfo.databaseId),n=function(t){return new Qs(t)}(t.databaseInfo);return function(t,e,n,r){return new ro(t,e,n,r)}(t.authCredentials,t.appCheckCredentials,n,e)}createRemoteStore(t){return function(t,e,n,r,i){return new oo(t,e,n,r,i)}(this.localStore,this.datastore,t.asyncQueue,t=>fa(this.syncEngine,t,0),js.v()?new js:new Fs)}createSyncEngine(t,e){return function(t,e,n,r,i,s,o){const a=new sa(t,e,n,r,i,s);return o&&(a.gu=!0),a}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,e)}async terminate(){await async function(t){const e=M(t);A(so,"RemoteStore shutting down."),e.Ea.add(5),await co(e),e.Aa.shutdown(),e.Ra.set("Unknown")}(this.remoteStore),this.datastore?.terminate(),this.eventManager?.terminate()}}Ra.provider={build:()=>new Ra};class xa{constructor(t){this.observer=t,this.muted=!1}next(t){this.muted||this.observer.next&&this.Ou(this.observer.next,t)}error(t){this.muted||(this.observer.error?this.Ou(this.observer.error,t):D("Uncaught Error in snapshot listener:",t.toString()))}Nu(){this.muted=!0}Ou(t,e){setTimeout(()=>{this.muted||t(e)},0)}}const Oa="FirestoreClient";class Ma{constructor(t,e,n,r,i){this.authCredentials=t,this.appCheckCredentials=e,this.asyncQueue=n,this.databaseInfo=r,this.user=_.UNAUTHENTICATED,this.clientId=G.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=i,this.authCredentials.start(n,async t=>{A(Oa,"Received user=",t.uid),await this.authCredentialListener(t),this.user=t}),this.appCheckCredentials.start(n,t=>(A(Oa,"Received new app check token=",t),this.appCheckCredentialListener(t,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(t){this.authCredentialListener=t}setAppCheckTokenChangeListener(t){this.appCheckCredentialListener=t}terminate(){this.asyncQueue.enterRestrictedMode();const t=new V;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),t.resolve()}catch(e){const n=Fo(e,"Failed to shutdown persistence");t.reject(n)}}),t.promise}}async function La(t,e){t.asyncQueue.verifyOperationInProgress(),A(Oa,"Initializing OfflineComponentProvider");const n=t.configuration;await e.initialize(n);let r=n.initialUser;t.setCredentialChangeListener(async t=>{r.isEqual(t)||(await Ds(e.localStore,t),r=t)}),e.persistence.setDatabaseDeletedListener(()=>t.terminate()),t._offlineComponents=e}async function Pa(t,e){t.asyncQueue.verifyOperationInProgress();const n=await Va(t);A(Oa,"Initializing OnlineComponentProvider"),await e.initialize(n,t.configuration),t.setCredentialChangeListener(t=>Oo(e.remoteStore,t)),t.setAppCheckTokenChangeListener((t,n)=>Oo(e.remoteStore,n)),t._onlineComponents=e}async function Va(t){if(!t._offlineComponents)if(t._uninitializedComponentsProvider){A(Oa,"Using user provided OfflineComponentProvider");try{await La(t,t._uninitializedComponentsProvider._offline)}catch(e){const n=e;if(!function(t){return"FirebaseError"===t.name?t.code===L.FAILED_PRECONDITION||t.code===L.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&t instanceof DOMException)||22===t.code||20===t.code||11===t.code}(n))throw n;N("Error using user provided cache. Falling back to memory cache: "+n),await La(t,new Na)}}else A(Oa,"Using default OfflineComponentProvider"),await La(t,new ka(void 0));return t._offlineComponents}async function Fa(t){return t._onlineComponents||(t._uninitializedComponentsProvider?(A(Oa,"Using user provided OnlineComponentProvider"),await Pa(t,t._uninitializedComponentsProvider._online)):(A(Oa,"Using default OnlineComponentProvider"),await Pa(t,new Ra))),t._onlineComponents}function Ua(t){return Fa(t).then(t=>t.syncEngine)}async function ja(t){const e=await Fa(t),n=e.eventManager;return n.onListen=oa.bind(null,e.syncEngine),n.onUnlisten=ha.bind(null,e.syncEngine),n.onFirstRemoteStoreListen=aa.bind(null,e.syncEngine),n.onLastRemoteStoreUnlisten=la.bind(null,e.syncEngine),n}function Ba(t,e,n={}){const r=new V;return t.asyncQueue.enqueueAndForget(async()=>function(t,e,n,r,i){const s=new xa({next:n=>{s.Nu(),e.enqueueAndForget(()=>Go(t,o)),n.fromCache&&"server"===r.source?i.reject(new P(L.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(n)},error:t=>i.reject(t)}),o=new Jo(n,s,{includeMetadataChanges:!0,qa:!0});return Ko(t,o)}(await ja(t),t.asyncQueue,e,n,r)),r.promise}function qa(t){const e={};return void 0!==t.timeoutSeconds&&(e.timeoutSeconds=t.timeoutSeconds),e}const $a=new Map,za="firestore.googleapis.com",Ka=!0;class Ga{constructor(t){if(void 0===t.host){if(void 0!==t.ssl)throw new P(L.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=za,this.ssl=Ka}else this.host=t.host,this.ssl=t.ssl??Ka;if(this.isUsingEmulator=void 0!==t.emulatorOptions,this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,this.localCache=t.localCache,void 0===t.cacheSizeBytes)this.cacheSizeBytes=Wi;else{if(-1!==t.cacheSizeBytes&&t.cacheSizeBytes<Zi)throw new P(L.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}(function(t,e,n,r){if(!0===e&&!0===r)throw new P(L.INVALID_ARGUMENT,`${t} and ${n} cannot be used together.`)})("experimentalForceLongPolling",t.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",t.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:void 0===t.experimentalAutoDetectLongPolling?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=qa(t.experimentalLongPollingOptions??{}),function(t){if(void 0!==t.timeoutSeconds){if(isNaN(t.timeoutSeconds))throw new P(L.INVALID_ARGUMENT,`invalid long polling timeout: ${t.timeoutSeconds} (must not be NaN)`);if(t.timeoutSeconds<5)throw new P(L.INVALID_ARGUMENT,`invalid long polling timeout: ${t.timeoutSeconds} (minimum allowed value is 5)`);if(t.timeoutSeconds>30)throw new P(L.INVALID_ARGUMENT,`invalid long polling timeout: ${t.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!t.useFetchStreams}isEqual(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&function(t,e){return t.timeoutSeconds===e.timeoutSeconds}(this.experimentalLongPollingOptions,t.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties&&this.useFetchStreams===t.useFetchStreams}}class Ha{constructor(t,e,n,r){this._authCredentials=t,this._appCheckCredentials=e,this._databaseId=n,this._app=r,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Ga({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new P(L.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return"notTerminated"!==this._terminateTask}_setSettings(t){if(this._settingsFrozen)throw new P(L.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Ga(t),this._emulatorOptions=t.emulatorOptions||{},void 0!==t.credentials&&(this._authCredentials=function(t){if(!t)return new U;switch(t.type){case"firstParty":return new q(t.sessionIndex||"0",t.iamToken||null,t.authTokenFactory||null);case"provider":return t.client;default:throw new P(L.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(t.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return"notTerminated"===this._terminateTask&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){"notTerminated"===this._terminateTask?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){const e=$a.get(t);e&&(A("ComponentProvider","Removing Datastore"),$a.delete(t),e.terminate())}(this),Promise.resolve()}}class Qa{constructor(t,e,n){this.converter=e,this._query=n,this.type="query",this.firestore=t}withConverter(t){return new Qa(this.firestore,t,this._query)}}class Wa{constructor(t,e,n){this.converter=e,this._key=n,this.type="document",this.firestore=t}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Xa(this.firestore,this.converter,this._key.path.popLast())}withConverter(t){return new Wa(this.firestore,t,this._key)}toJSON(){return{type:Wa._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(t,e,n){if(dt(e,Wa._jsonSchema))return new Wa(t,n||null,new it(et.fromString(e.referencePath)))}}Wa._jsonSchemaVersion="firestore/documentReference/1.0",Wa._jsonSchema={type:lt("string",Wa._jsonSchemaVersion),referencePath:lt("string")};class Xa extends Qa{constructor(t,e,n){super(t,e,Mn(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const t=this._path.popLast();return t.isEmpty()?null:new Wa(this.firestore,null,new it(t))}withConverter(t){return new Xa(this.firestore,t,this._path)}}function Ya(t,e,...n){if(t=(0,c.Ku)(t),st("collection","path",e),t instanceof Ha){const r=et.fromString(e,...n);return at(r),new Xa(t,null,r)}{if(!(t instanceof Wa||t instanceof Xa))throw new P(L.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=t._path.child(et.fromString(e,...n));return at(r),new Xa(t.firestore,null,r)}}function Ja(t,e,...n){if(t=(0,c.Ku)(t),1===arguments.length&&(e=G.newId()),st("doc","path",e),t instanceof Ha){const r=et.fromString(e,...n);return ot(r),new Wa(t,null,new it(r))}{if(!(t instanceof Wa||t instanceof Xa))throw new P(L.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=t._path.child(et.fromString(e,...n));return ot(r),new Wa(t.firestore,t instanceof Xa?t.converter:null,new it(r))}}const Za="AsyncQueue";class tc{constructor(t=Promise.resolve()){this.Xu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new Ys(this,"async_queue_retry"),this._c=()=>{const t=Ws();t&&A(Za,"Visibility state changed to "+t.visibilityState),this.M_.w_()},this.ac=t;const e=Ws();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(t){this.enqueue(t)}enqueueAndForgetEvenWhileRestricted(t){this.uc(),this.cc(t)}enterRestrictedMode(t){if(!this.ec){this.ec=!0,this.sc=t||!1;const e=Ws();e&&"function"==typeof e.removeEventListener&&e.removeEventListener("visibilitychange",this._c)}}enqueue(t){if(this.uc(),this.ec)return new Promise(()=>{});const e=new V;return this.cc(()=>this.ec&&this.sc?Promise.resolve():(t().then(e.resolve,e.reject),e.promise)).then(()=>e.promise)}enqueueRetryable(t){this.enqueueAndForget(()=>(this.Xu.push(t),this.lc()))}async lc(){if(0!==this.Xu.length){try{await this.Xu[0](),this.Xu.shift(),this.M_.reset()}catch(t){if(!Dt(t))throw t;A(Za,"Operation failed with retryable error: "+t)}this.Xu.length>0&&this.M_.p_(()=>this.lc())}}cc(t){const e=this.ac.then(()=>(this.rc=!0,t().catch(t=>{throw this.nc=t,this.rc=!1,D("INTERNAL UNHANDLED ERROR: ",ec(t)),t}).then(t=>(this.rc=!1,t))));return this.ac=e,e}enqueueAfterDelay(t,e,n){this.uc(),this.oc.indexOf(t)>-1&&(e=0);const r=Vo.createAndSchedule(this,t,e,n,t=>this.hc(t));return this.tc.push(r),r}uc(){this.nc&&R(47125,{Pc:ec(this.nc)})}verifyOperationInProgress(){}async Tc(){let t;do{t=this.ac,await t}while(t!==this.ac)}Ic(t){for(const e of this.tc)if(e.timerId===t)return!0;return!1}Ec(t){return this.Tc().then(()=>{this.tc.sort((t,e)=>t.targetTimeMs-e.targetTimeMs);for(const e of this.tc)if(e.skipDelay(),"all"!==t&&e.timerId===t)break;return this.Tc()})}dc(t){this.oc.push(t)}hc(t){const e=this.tc.indexOf(t);this.tc.splice(e,1)}}function ec(t){let e=t.message||"";return t.stack&&(e=t.stack.includes(t.message)?t.stack:t.message+"\n"+t.stack),e}function nc(t){return function(t,e){if("object"!=typeof t||null===t)return!1;const n=t;for(const r of e)if(r in n&&"function"==typeof n[r])return!0;return!1}(t,["next","error","complete"])}class rc extends Ha{constructor(t,e,n,r){super(t,e,n,r),this.type="firestore",this._queue=new tc,this._persistenceKey=r?.name||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const t=this._firestoreClient.terminate();this._queue=new tc(t),this._firestoreClient=void 0,await t}}}function ic(t,e,n){n||(n=ke);const r=(0,s.j6)(t,"firestore");if(r.isInitialized(n)){const t=r.getImmediate({identifier:n}),i=r.getOptions(n);if((0,c.bD)(i,e))return t;throw new P(L.FAILED_PRECONDITION,"initializeFirestore() has already been called with different options. To avoid this error, call initializeFirestore() with the same options as when it was originally called, or call getFirestore() to return the already initialized instance.")}if(void 0!==e.cacheSizeBytes&&void 0!==e.localCache)throw new P(L.INVALID_ARGUMENT,"cache and cacheSizeBytes cannot be specified at the same time as cacheSizeBytes willbe deprecated. Instead, specify the cache size in the cache object");if(void 0!==e.cacheSizeBytes&&-1!==e.cacheSizeBytes&&e.cacheSizeBytes<Zi)throw new P(L.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");return e.host&&(0,c.zJ)(e.host)&&(0,c.gE)(e.host),r.initialize({options:e,instanceIdentifier:n})}function sc(t){if(t._terminated)throw new P(L.FAILED_PRECONDITION,"The client has already been terminated.");return t._firestoreClient||oc(t),t._firestoreClient}function oc(t){const e=t._freezeSettings(),n=function(t,e,n,r){return new Ne(t,e,n,r.host,r.ssl,r.experimentalForceLongPolling,r.experimentalAutoDetectLongPolling,qa(r.experimentalLongPollingOptions),r.useFetchStreams,r.isUsingEmulator)}(t._databaseId,t._app?.options.appId||"",t._persistenceKey,e);t._componentsProvider||e.localCache?._offlineComponentProvider&&e.localCache?._onlineComponentProvider&&(t._componentsProvider={_offline:e.localCache._offlineComponentProvider,_online:e.localCache._onlineComponentProvider}),t._firestoreClient=new Ma(t._authCredentials,t._appCheckCredentials,t._queue,n,t._componentsProvider&&function(t){const e=t?._online.build();return{_offline:t?._offline.build(e),_online:e}}(t._componentsProvider))}class ac{constructor(t){this._byteString=t}static fromBase64String(t){try{return new ac(ye.fromBase64String(t))}catch(t){throw new P(L.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(t){return new ac(ye.fromUint8Array(t))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(t){return this._byteString.isEqual(t._byteString)}toJSON(){return{type:ac._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(t){if(dt(t,ac._jsonSchema))return ac.fromBase64String(t.bytes)}}ac._jsonSchemaVersion="firestore/bytes/1.0",ac._jsonSchema={type:lt("string",ac._jsonSchemaVersion),bytes:lt("string")};class cc{constructor(...t){for(let e=0;e<t.length;++e)if(0===t[e].length)throw new P(L.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new rt(t)}isEqual(t){return this._internalPath.isEqual(t._internalPath)}}class uc{constructor(t){this._methodName=t}}class hc{constructor(t,e){if(!isFinite(t)||t<-90||t>90)throw new P(L.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||e>180)throw new P(L.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this._lat=t,this._long=e}get latitude(){return this._lat}get longitude(){return this._long}isEqual(t){return this._lat===t._lat&&this._long===t._long}_compareTo(t){return H(this._lat,t._lat)||H(this._long,t._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:hc._jsonSchemaVersion}}static fromJSON(t){if(dt(t,hc._jsonSchema))return new hc(t.latitude,t.longitude)}}hc._jsonSchemaVersion="firestore/geoPoint/1.0",hc._jsonSchema={type:lt("string",hc._jsonSchemaVersion),latitude:lt("number"),longitude:lt("number")};class lc{constructor(t){this._values=(t||[]).map(t=>t)}toArray(){return this._values.map(t=>t)}isEqual(t){return function(t,e){if(t.length!==e.length)return!1;for(let n=0;n<t.length;++n)if(t[n]!==e[n])return!1;return!0}(this._values,t._values)}toJSON(){return{type:lc._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(t){if(dt(t,lc._jsonSchema)){if(Array.isArray(t.vectorValues)&&t.vectorValues.every(t=>"number"==typeof t))return new lc(t.vectorValues);throw new P(L.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}lc._jsonSchemaVersion="firestore/vectorValue/1.0",lc._jsonSchema={type:lt("string",lc._jsonSchemaVersion),vectorValues:lt("object")};const dc=/^__.*__$/;class fc{constructor(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}toMutation(t,e){return null!==this.fieldMask?new Mr(t,this.data,this.fieldMask,e,this.fieldTransforms):new Or(t,this.data,e,this.fieldTransforms)}}function pc(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw R(40011,{Ac:t})}}class gc{constructor(t,e,n,r,i,s){this.settings=t,this.databaseId=e,this.serializer=n,this.ignoreUndefinedProperties=r,void 0===i&&this.Rc(),this.fieldTransforms=i||[],this.fieldMask=s||[]}get path(){return this.settings.path}get Ac(){return this.settings.Ac}Vc(t){return new gc({...this.settings,...t},this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}mc(t){const e=this.path?.child(t),n=this.Vc({path:e,fc:!1});return n.gc(t),n}yc(t){const e=this.path?.child(t),n=this.Vc({path:e,fc:!1});return n.Rc(),n}wc(t){return this.Vc({path:void 0,fc:!0})}Sc(t){return Ac(t,this.settings.methodName,this.settings.bc||!1,this.path,this.settings.Dc)}contains(t){return void 0!==this.fieldMask.find(e=>t.isPrefixOf(e))||void 0!==this.fieldTransforms.find(e=>t.isPrefixOf(e.field))}Rc(){if(this.path)for(let t=0;t<this.path.length;t++)this.gc(this.path.get(t))}gc(t){if(0===t.length)throw this.Sc("Document fields must not be empty");if(pc(this.Ac)&&dc.test(t))throw this.Sc('Document fields cannot begin and end with "__"')}}class mc{constructor(t,e,n){this.databaseId=t,this.ignoreUndefinedProperties=e,this.serializer=n||Xs(t)}Cc(t,e,n,r=!1){return new gc({Ac:t,methodName:e,Dc:n,path:rt.emptyPath(),fc:!1,bc:r},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function yc(t){const e=t._freezeSettings(),n=Xs(t._databaseId);return new mc(t._databaseId,!!e.ignoreUndefinedProperties,n)}function wc(t,e,n,r,i,s={}){const o=t.Cc(s.merge||s.mergeFields?2:0,e,n,i);_c("Data must be an object, but it was:",o,r);const a=Ec(r,o);let c,u;if(s.merge)c=new ge(o.fieldMask),u=o.fieldTransforms;else if(s.mergeFields){const t=[];for(const r of s.mergeFields){const i=Ic(e,r,n);if(!o.contains(i))throw new P(L.INVALID_ARGUMENT,`Field '${i}' is specified in your field mask but missing from your input data.`);Dc(t,i)||t.push(i)}c=new ge(t),u=o.fieldTransforms.filter(t=>c.covers(t.field))}else c=null,u=o.fieldTransforms;return new fc(new en(a),c,u)}function vc(t,e,n,r=!1){return bc(n,t.Cc(r?4:3,e))}function bc(t,e){if(Tc(t=(0,c.Ku)(t)))return _c("Unsupported field value:",e,t),Ec(t,e);if(t instanceof uc)return function(t,e){if(!pc(e.Ac))throw e.Sc(`${t._methodName}() can only be used with update() and set()`);if(!e.path)throw e.Sc(`${t._methodName}() is not currently supported inside arrays`);const n=t._toFieldTransform(e);n&&e.fieldTransforms.push(n)}(t,e),null;if(void 0===t&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),t instanceof Array){if(e.settings.fc&&4!==e.Ac)throw e.Sc("Nested arrays are not supported");return function(t,e){const n=[];let r=0;for(const i of t){let t=bc(i,e.wc(r));null==t&&(t={nullValue:"NULL_VALUE"}),n.push(t),r++}return{arrayValue:{values:n}}}(t,e)}return function(t,e){if(null===(t=(0,c.Ku)(t)))return{nullValue:"NULL_VALUE"};if("number"==typeof t)return lr(e.serializer,t);if("boolean"==typeof t)return{booleanValue:t};if("string"==typeof t)return{stringValue:t};if(t instanceof Date){const n=gt.fromDate(t);return{timestampValue:gi(e.serializer,n)}}if(t instanceof gt){const n=new gt(t.seconds,1e3*Math.floor(t.nanoseconds/1e3));return{timestampValue:gi(e.serializer,n)}}if(t instanceof hc)return{geoPointValue:{latitude:t.latitude,longitude:t.longitude}};if(t instanceof ac)return{bytesValue:mi(e.serializer,t._byteString)};if(t instanceof Wa){const n=e.databaseId,r=t.firestore._databaseId;if(!r.isEqual(n))throw e.Sc(`Document reference is for database ${r.projectId}/${r.database} but should be for database ${n.projectId}/${n.database}`);return{referenceValue:vi(t.firestore._databaseId||e.databaseId,t._key.path)}}if(t instanceof lc)return function(t,e){return{mapValue:{fields:{[xe]:{stringValue:Le},[Pe]:{arrayValue:{values:t.toArray().map(t=>{if("number"!=typeof t)throw e.Sc("VectorValues must only contain numeric values.");return ur(e.serializer,t)})}}}}}}(t,e);throw e.Sc(`Unsupported field value: ${ut(t)}`)}(t,e)}function Ec(t,e){const n={};return ue(t)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):ce(t,(t,r)=>{const i=bc(r,e.mc(t));null!=i&&(n[t]=i)}),{mapValue:{fields:n}}}function Tc(t){return!("object"!=typeof t||null===t||t instanceof Array||t instanceof Date||t instanceof gt||t instanceof hc||t instanceof ac||t instanceof Wa||t instanceof uc||t instanceof lc)}function _c(t,e,n){if(!Tc(n)||!ct(n)){const r=ut(n);throw"an object"===r?e.Sc(t+" a custom object"):e.Sc(t+" "+r)}}function Ic(t,e,n){if((e=(0,c.Ku)(e))instanceof cc)return e._internalPath;if("string"==typeof e)return Cc(t,e);throw Ac("Field path arguments must be of type string or ",t,!1,void 0,n)}const Sc=new RegExp("[~\\*/\\[\\]]");function Cc(t,e,n){if(e.search(Sc)>=0)throw Ac(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,t,!1,void 0,n);try{return new cc(...e.split("."))._internalPath}catch(r){throw Ac(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,t,!1,void 0,n)}}function Ac(t,e,n,r,i){const s=r&&!r.isEmpty(),o=void 0!==i;let a=`Function ${e}() called with invalid data`;n&&(a+=" (via `toFirestore()`)"),a+=". ";let c="";return(s||o)&&(c+=" (found",s&&(c+=` in field ${r}`),o&&(c+=` in document ${i}`),c+=")"),new P(L.INVALID_ARGUMENT,a+t+c)}function Dc(t,e){return t.some(t=>t.isEqual(e))}class Nc{constructor(t,e,n,r,i){this._firestore=t,this._userDataWriter=e,this._key=n,this._document=r,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new Wa(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const t=new kc(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(t)}return this._userDataWriter.convertValue(this._document.data.value)}}get(t){if(this._document){const e=this._document.data.field(Rc("DocumentSnapshot.get",t));if(null!==e)return this._userDataWriter.convertValue(e)}}}class kc extends Nc{data(){return super.data()}}function Rc(t,e){return"string"==typeof e?Cc(t,e):e instanceof cc?e._internalPath:e._delegate._internalPath}function xc(t){if("L"===t.limitType&&0===t.explicitOrderBy.length)throw new P(L.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class Oc{}class Mc extends Oc{}function Lc(t,e,...n){let r=[];e instanceof Oc&&r.push(e),r=r.concat(n),function(t){const e=t.filter(t=>t instanceof Vc).length,n=t.filter(t=>t instanceof Pc).length;if(e>1||e>0&&n>0)throw new P(L.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r);for(const i of r)t=i._apply(t);return t}class Pc extends Mc{constructor(t,e,n){super(),this._field=t,this._op=e,this._value=n,this.type="where"}static _create(t,e,n){return new Pc(t,e,n)}_apply(t){const e=this._parse(t);return qc(t._query,e),new Qa(t.firestore,t.converter,jn(t._query,e))}_parse(t){const e=yc(t.firestore),n=function(t,e,n,r,i,s,o){let a;if(i.isKeyField()){if("array-contains"===s||"array-contains-any"===s)throw new P(L.INVALID_ARGUMENT,`Invalid Query. You can't perform '${s}' queries on documentId().`);if("in"===s||"not-in"===s){Bc(o,s);const e=[];for(const n of o)e.push(jc(r,t,n));a={arrayValue:{values:e}}}else a=jc(r,t,o)}else"in"!==s&&"not-in"!==s&&"array-contains-any"!==s||Bc(o,s),a=vc(n,e,o,"in"===s||"not-in"===s);return ln.create(i,s,a)}(t._query,"where",e,t.firestore._databaseId,this._field,this._op,this._value);return n}}class Vc extends Oc{constructor(t,e){super(),this.type=t,this._queryConstraints=e}static _create(t,e){return new Vc(t,e)}_parse(t){const e=this._queryConstraints.map(e=>e._parse(t)).filter(t=>t.getFilters().length>0);return 1===e.length?e[0]:dn.create(e,this._getOperator())}_apply(t){const e=this._parse(t);return 0===e.getFilters().length?t:(function(t,e){let n=t;const r=e.getFlattenedFilters();for(const i of r)qc(n,i),n=jn(n,i)}(t._query,e),new Qa(t.firestore,t.converter,jn(t._query,e)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return"and"===this.type?"and":"or"}}class Fc extends Mc{constructor(t,e){super(),this._field=t,this._direction=e,this.type="orderBy"}static _create(t,e){return new Fc(t,e)}_apply(t){const e=function(t,e,n){if(null!==t.startAt)throw new P(L.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==t.endAt)throw new P(L.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new cn(e,n)}(t._query,this._field,this._direction);return new Qa(t.firestore,t.converter,function(t,e){const n=t.explicitOrderBy.concat([e]);return new xn(t.path,t.collectionGroup,n,t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)}(t._query,e))}}function Uc(t,e="asc"){const n=e,r=Rc("orderBy",t);return Fc._create(r,n)}function jc(t,e,n){if("string"==typeof(n=(0,c.Ku)(n))){if(""===n)throw new P(L.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!Pn(e)&&-1!==n.indexOf("/"))throw new P(L.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);const r=e.path.child(et.fromString(n));if(!it.isDocumentKey(r))throw new P(L.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return Ge(t,new it(r))}if(n instanceof Wa)return Ge(t,n._key);throw new P(L.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${ut(n)}.`)}function Bc(t,e){if(!Array.isArray(t)||0===t.length)throw new P(L.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function qc(t,e){const n=function(t,e){for(const n of t)for(const t of n.getFlattenedFilters())if(e.indexOf(t.op)>=0)return t.op;return null}(t.filters,function(t){switch(t){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(null!==n)throw n===e.op?new P(L.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new P(L.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${n.toString()}' filters.`)}class $c{convertValue(t,e="none"){switch(Ve(t)){case 0:return null;case 1:return t.booleanValue;case 2:return be(t.integerValue||t.doubleValue);case 3:return this.convertTimestamp(t.timestampValue);case 4:return this.convertServerTimestamp(t,e);case 5:return t.stringValue;case 6:return this.convertBytes(Ee(t.bytesValue));case 7:return this.convertReference(t.referenceValue);case 8:return this.convertGeoPoint(t.geoPointValue);case 9:return this.convertArray(t.arrayValue,e);case 11:return this.convertObject(t.mapValue,e);case 10:return this.convertVectorValue(t.mapValue);default:throw R(62114,{value:t})}}convertObject(t,e){return this.convertObjectMap(t.fields,e)}convertObjectMap(t,e="none"){const n={};return ce(t,(t,r)=>{n[t]=this.convertValue(r,e)}),n}convertVectorValue(t){const e=t.fields?.[Pe].arrayValue?.values?.map(t=>be(t.doubleValue));return new lc(e)}convertGeoPoint(t){return new hc(be(t.latitude),be(t.longitude))}convertArray(t,e){return(t.values||[]).map(t=>this.convertValue(t,e))}convertServerTimestamp(t,e){switch(e){case"previous":const n=Ae(t);return null==n?null:this.convertValue(n,e);case"estimate":return this.convertTimestamp(De(t));default:return null}}convertTimestamp(t){const e=ve(t);return new gt(e.seconds,e.nanos)}convertDocumentKey(t,e){const n=et.fromString(t);O(Bi(n),9688,{name:t});const r=new Re(n.get(1),n.get(3)),i=new it(n.popFirst(5));return r.isEqual(e)||D(`Document ${i} contains a document reference within a different database (${r.projectId}/${r.database}) which is not supported. It will be treated as a reference in the current database (${e.projectId}/${e.database}) instead.`),i}}function zc(t,e,n){let r;return r=t?n&&(n.merge||n.mergeFields)?t.toFirestore(e,n):t.toFirestore(e):e,r}class Kc{constructor(t,e){this.hasPendingWrites=t,this.fromCache=e}isEqual(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache}}class Gc extends Nc{constructor(t,e,n,r,i,s){super(t,e,n,r,s),this._firestore=t,this._firestoreImpl=t,this.metadata=i}exists(){return super.exists()}data(t={}){if(this._document){if(this._converter){const e=new Hc(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(e,t)}return this._userDataWriter.convertValue(this._document.data.value,t.serverTimestamps)}}get(t,e={}){if(this._document){const n=this._document.data.field(Rc("DocumentSnapshot.get",t));if(null!==n)return this._userDataWriter.convertValue(n,e.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new P(L.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const t=this._document,e={};return e.type=Gc._jsonSchemaVersion,e.bundle="",e.bundleSource="DocumentSnapshot",e.bundleName=this._key.toString(),t&&t.isValidDocument()&&t.isFoundDocument()?(this._userDataWriter.convertObjectMap(t.data.value.mapValue.fields,"previous"),e.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),e):e}}Gc._jsonSchemaVersion="firestore/documentSnapshot/1.0",Gc._jsonSchema={type:lt("string",Gc._jsonSchemaVersion),bundleSource:lt("string","DocumentSnapshot"),bundleName:lt("string"),bundle:lt("string")};class Hc extends Gc{data(t={}){return super.data(t)}}class Qc{constructor(t,e,n,r){this._firestore=t,this._userDataWriter=e,this._snapshot=r,this.metadata=new Kc(r.hasPendingWrites,r.fromCache),this.query=n}get docs(){const t=[];return this.forEach(e=>t.push(e)),t}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(t,e){this._snapshot.docs.forEach(n=>{t.call(e,new Hc(this._firestore,this._userDataWriter,n.key,n,new Kc(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))})}docChanges(t={}){const e=!!t.includeMetadataChanges;if(e&&this._snapshot.excludesMetadataChanges)throw new P(L.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=function(t,e){if(t._snapshot.oldDocs.isEmpty()){let e=0;return t._snapshot.docChanges.map(n=>{const r=new Hc(t._firestore,t._userDataWriter,n.doc.key,n.doc,new Kc(t._snapshot.mutatedKeys.has(n.doc.key),t._snapshot.fromCache),t.query.converter);return n.doc,{type:"added",doc:r,oldIndex:-1,newIndex:e++}})}{let n=t._snapshot.oldDocs;return t._snapshot.docChanges.filter(t=>e||3!==t.type).map(e=>{const r=new Hc(t._firestore,t._userDataWriter,e.doc.key,e.doc,new Kc(t._snapshot.mutatedKeys.has(e.doc.key),t._snapshot.fromCache),t.query.converter);let i=-1,s=-1;return 0!==e.type&&(i=n.indexOf(e.doc.key),n=n.delete(e.doc.key)),1!==e.type&&(n=n.add(e.doc),s=n.indexOf(e.doc.key)),{type:Wc(e.type),doc:r,oldIndex:i,newIndex:s}})}}(this,e),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new P(L.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const t={};t.type=Qc._jsonSchemaVersion,t.bundleSource="QuerySnapshot",t.bundleName=G.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;const e=[],n=[],r=[];return this.docs.forEach(t=>{null!==t._document&&(e.push(t._document),n.push(this._userDataWriter.convertObjectMap(t._document.data.value.mapValue.fields,"previous")),r.push(t.ref.path))}),t.bundle=(this._firestore,this.query._query,t.bundleName,"NOT SUPPORTED"),t}}function Wc(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return R(61501,{type:t})}}Qc._jsonSchemaVersion="firestore/querySnapshot/1.0",Qc._jsonSchema={type:lt("string",Qc._jsonSchemaVersion),bundleSource:lt("string","QuerySnapshot"),bundleName:lt("string"),bundle:lt("string")};class Xc extends $c{constructor(t){super(),this.firestore=t}convertBytes(t){return new ac(t)}convertReference(t){const e=this.convertDocumentKey(t,this.firestore._databaseId);return new Wa(this.firestore,null,e)}}function Yc(t){t=ht(t,Qa);const e=ht(t.firestore,rc),n=sc(e),r=new Xc(e);return xc(t._query),Ba(n,t._query).then(n=>new Qc(e,r,t,n))}function Jc(t,e,n){t=ht(t,Wa);const r=ht(t.firestore,rc),i=zc(t.converter,e,n);return tu(r,[wc(yc(r),"setDoc",t._key,i,null!==t.converter,n).toMutation(t._key,Sr.none())])}function Zc(t,...e){t=(0,c.Ku)(t);let n={includeMetadataChanges:!1,source:"default"},r=0;"object"!=typeof e[r]||nc(e[r])||(n=e[r++]);const i={includeMetadataChanges:n.includeMetadataChanges,source:n.source};if(nc(e[r])){const t=e[r];e[r]=t.next?.bind(t),e[r+1]=t.error?.bind(t),e[r+2]=t.complete?.bind(t)}let s,o,a;if(t instanceof Wa)o=ht(t.firestore,rc),a=Mn(t._key.path),s={next:n=>{e[r]&&e[r](eu(o,t,n))},error:e[r+1],complete:e[r+2]};else{const n=ht(t,Qa);o=ht(n.firestore,rc),a=n._query;const i=new Xc(o);s={next:t=>{e[r]&&e[r](new Qc(o,i,n,t))},error:e[r+1],complete:e[r+2]},xc(t._query)}return function(t,e,n,r){const i=new xa(r),s=new Jo(e,i,n);return t.asyncQueue.enqueueAndForget(async()=>Ko(await ja(t),s)),()=>{i.Nu(),t.asyncQueue.enqueueAndForget(async()=>Go(await ja(t),s))}}(sc(o),a,i,s)}function tu(t,e){return function(t,e){const n=new V;return t.asyncQueue.enqueueAndForget(async()=>async function(t,e,n){const r=Da(t);try{const t=await function(t,e){const n=M(t),r=gt.now(),i=e.reduce((t,e)=>t.add(e.key),or());let s,o;return n.persistence.runTransaction("Locally write mutations","readwrite",t=>{let a=Yn(),c=or();return n.Ns.getEntries(t,i).next(t=>{a=t,a.forEach((t,e)=>{e.isValidDocument()||(c=c.add(t))})}).next(()=>n.localDocuments.getOverlayedDocuments(t,a)).next(i=>{s=i;const o=[];for(const t of e){const e=Rr(t,s.get(t.key).overlayedDocument);null!=e&&o.push(new Mr(t.key,e,nn(e.value.mapValue),Sr.exists(!0)))}return n.mutationQueue.addMutationBatch(t,r,o,e)}).next(e=>{o=e;const r=e.applyToLocalDocumentSet(s,c);return n.documentOverlayCache.saveOverlays(t,e.batchId,r)})}).then(()=>({batchId:o.batchId,changes:tr(s)}))}(r.localStore,e);r.sharedClientState.addPendingMutation(t.batchId),function(t,e,n){let r=t.Vu[t.currentUser.toKey()];r||(r=new he(H)),r=r.insert(e,n),t.Vu[t.currentUser.toKey()]=r}(r,t.batchId,n),await Ia(r,t.changes),await Io(r.remoteStore)}catch(t){const e=Fo(t,"Failed to persist write");n.reject(e)}}(await Ua(t),e,n)),n.promise}(sc(t),e)}function eu(t,e,n){const r=n.docs.get(e._key),i=new Xc(t);return new Gc(t,i,e._key,r,new Kc(n.hasPendingWrites,n.fromCache),e.converter)}new WeakMap;!function(t,e=!0){!function(t){I=t}(s.MF),(0,s.om)(new o.uA("firestore",(t,{instanceIdentifier:n,options:r})=>{const i=t.getProvider("app").getImmediate(),s=new rc(new j(t.getProvider("auth-internal")),new z(i,t.getProvider("app-check-internal")),function(t,e){if(!Object.prototype.hasOwnProperty.apply(t.options,["projectId"]))throw new P(L.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Re(t.options.projectId,e)}(i,n),i);return r={useFetchStreams:e,...r},s._setSettings(r),s},"PUBLIC").setMultipleInstances(!0)),(0,s.KO)(E,T,t),(0,s.KO)(E,T,"esm2020")}()},9943:(t,e,n)=>{n.d(e,{Dk:()=>J,KO:()=>Z,MF:()=>W,Sx:()=>Y,Wp:()=>X,j6:()=>z,om:()=>$,xZ:()=>K});var r=n(1711),i=n(722),s=n(734),o=n(4297);class a{constructor(t){this.container=t}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(function(t){const e=t.getComponent();return"VERSION"===e?.type}(t)){const e=t.getImmediate();return`${e.library}/${e.version}`}return null}).filter(t=>t).join(" ")}}const c="@firebase/app",u="0.14.6",h=new i.Vy("@firebase/app"),l="@firebase/app-compat",d="@firebase/analytics-compat",f="@firebase/analytics",p="@firebase/app-check-compat",g="@firebase/app-check",m="@firebase/auth",y="@firebase/auth-compat",w="@firebase/database",v="@firebase/data-connect",b="@firebase/database-compat",E="@firebase/functions",T="@firebase/functions-compat",_="@firebase/installations",I="@firebase/installations-compat",S="@firebase/messaging",C="@firebase/messaging-compat",A="@firebase/performance",D="@firebase/performance-compat",N="@firebase/remote-config",k="@firebase/remote-config-compat",R="@firebase/storage",x="@firebase/storage-compat",O="@firebase/firestore",M="@firebase/ai",L="@firebase/firestore-compat",P="firebase",V="[DEFAULT]",F={[c]:"fire-core",[l]:"fire-core-compat",[f]:"fire-analytics",[d]:"fire-analytics-compat",[g]:"fire-app-check",[p]:"fire-app-check-compat",[m]:"fire-auth",[y]:"fire-auth-compat",[w]:"fire-rtdb",[v]:"fire-data-connect",[b]:"fire-rtdb-compat",[E]:"fire-fn",[T]:"fire-fn-compat",[_]:"fire-iid",[I]:"fire-iid-compat",[S]:"fire-fcm",[C]:"fire-fcm-compat",[A]:"fire-perf",[D]:"fire-perf-compat",[N]:"fire-rc",[k]:"fire-rc-compat",[R]:"fire-gcs",[x]:"fire-gcs-compat",[O]:"fire-fst",[L]:"fire-fst-compat",[M]:"fire-vertex","fire-js":"fire-js",[P]:"fire-js-all"},U=new Map,j=new Map,B=new Map;function q(t,e){try{t.container.addComponent(e)}catch(n){h.debug(`Component ${e.name} failed to register with FirebaseApp ${t.name}`,n)}}function $(t){const e=t.name;if(B.has(e))return h.debug(`There were multiple attempts to register component ${e}.`),!1;B.set(e,t);for(const n of U.values())q(n,t);for(const n of j.values())q(n,t);return!0}function z(t,e){const n=t.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),t.container.getProvider(e)}function K(t){return null!=t&&void 0!==t.settings}const G={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},H=new s.FA("app","Firebase",G);class Q{constructor(t,e,n){this._isDeleted=!1,this._options={...t},this._config={...e},this._name=e.name,this._automaticDataCollectionEnabled=e.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new r.uA("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(t){this.checkDestroyed(),this._automaticDataCollectionEnabled=t}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(t){this._isDeleted=t}checkDestroyed(){if(this.isDeleted)throw H.create("app-deleted",{appName:this._name})}}const W="12.6.0";function X(t,e={}){let n=t;if("object"!=typeof e){e={name:e}}const i={name:V,automaticDataCollectionEnabled:!0,...e},o=i.name;if("string"!=typeof o||!o)throw H.create("bad-app-name",{appName:String(o)});if(n||(n=(0,s.T9)()),!n)throw H.create("no-options");const a=U.get(o);if(a){if((0,s.bD)(n,a.options)&&(0,s.bD)(i,a.config))return a;throw H.create("duplicate-app",{appName:o})}const c=new r.h1(o);for(const r of B.values())c.addComponent(r);const u=new Q(n,i,c);return U.set(o,u),u}function Y(t=V){const e=U.get(t);if(!e&&t===V&&(0,s.T9)())return X();if(!e)throw H.create("no-app",{appName:t});return e}function J(){return Array.from(U.values())}function Z(t,e,n){let i=F[t]??t;n&&(i+=`-${n}`);const s=i.match(/\s|\//),o=e.match(/\s|\//);if(s||o){const t=[`Unable to register library "${i}" with version "${e}":`];return s&&t.push(`library name "${i}" contains illegal characters (whitespace or "/")`),s&&o&&t.push("and"),o&&t.push(`version name "${e}" contains illegal characters (whitespace or "/")`),void h.warn(t.join(" "))}$(new r.uA(`${i}-version`,()=>({library:i,version:e}),"VERSION"))}const tt="firebase-heartbeat-store";let et=null;function nt(){return et||(et=(0,o.P2)("firebase-heartbeat-database",1,{upgrade:(t,e)=>{if(0===e)try{t.createObjectStore(tt)}catch(n){console.warn(n)}}}).catch(t=>{throw H.create("idb-open",{originalErrorMessage:t.message})})),et}async function rt(t,e){try{const n=(await nt()).transaction(tt,"readwrite"),r=n.objectStore(tt);await r.put(e,it(t)),await n.done}catch(n){if(n instanceof s.g)h.warn(n.message);else{const t=H.create("idb-set",{originalErrorMessage:n?.message});h.warn(t.message)}}}function it(t){return`${t.name}!${t.options.appId}`}class st{constructor(t){this.container=t,this._heartbeatsCache=null;const e=this.container.getProvider("app").getImmediate();this._storage=new at(e),this._heartbeatsCachePromise=this._storage.read().then(t=>(this._heartbeatsCache=t,t))}async triggerHeartbeat(){try{const t=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),e=ot();if(null==this._heartbeatsCache?.heartbeats&&(this._heartbeatsCache=await this._heartbeatsCachePromise,null==this._heartbeatsCache?.heartbeats))return;if(this._heartbeatsCache.lastSentHeartbeatDate===e||this._heartbeatsCache.heartbeats.some(t=>t.date===e))return;if(this._heartbeatsCache.heartbeats.push({date:e,agent:t}),this._heartbeatsCache.heartbeats.length>30){const t=function(t){if(0===t.length)return-1;let e=0,n=t[0].date;for(let r=1;r<t.length;r++)t[r].date<n&&(n=t[r].date,e=r);return e}(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(t,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(t){h.warn(t)}}async getHeartbeatsHeader(){try{if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,null==this._heartbeatsCache?.heartbeats||0===this._heartbeatsCache.heartbeats.length)return"";const t=ot(),{heartbeatsToSend:e,unsentEntries:n}=function(t,e=1024){const n=[];let r=t.slice();for(const i of t){const t=n.find(t=>t.agent===i.agent);if(t){if(t.dates.push(i.date),ct(n)>e){t.dates.pop();break}}else if(n.push({agent:i.agent,dates:[i.date]}),ct(n)>e){n.pop();break}r=r.slice(1)}return{heartbeatsToSend:n,unsentEntries:r}}(this._heartbeatsCache.heartbeats),r=(0,s.Uj)(JSON.stringify({version:2,heartbeats:e}));return this._heartbeatsCache.lastSentHeartbeatDate=t,n.length>0?(this._heartbeatsCache.heartbeats=n,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),r}catch(t){return h.warn(t),""}}}function ot(){return(new Date).toISOString().substring(0,10)}class at{constructor(t){this.app=t,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!(0,s.zW)()&&(0,s.eX)().then(()=>!0).catch(()=>!1)}async read(){if(await this._canUseIndexedDBPromise){const t=await async function(t){try{const e=(await nt()).transaction(tt),n=await e.objectStore(tt).get(it(t));return await e.done,n}catch(e){if(e instanceof s.g)h.warn(e.message);else{const t=H.create("idb-get",{originalErrorMessage:e?.message});h.warn(t.message)}}}(this.app);return t?.heartbeats?t:{heartbeats:[]}}return{heartbeats:[]}}async overwrite(t){if(await this._canUseIndexedDBPromise){const e=await this.read();return rt(this.app,{lastSentHeartbeatDate:t.lastSentHeartbeatDate??e.lastSentHeartbeatDate,heartbeats:t.heartbeats})}}async add(t){if(await this._canUseIndexedDBPromise){const e=await this.read();return rt(this.app,{lastSentHeartbeatDate:t.lastSentHeartbeatDate??e.lastSentHeartbeatDate,heartbeats:[...e.heartbeats,...t.heartbeats]})}}}function ct(t){return(0,s.Uj)(JSON.stringify({version:2,heartbeats:t})).length}var ut;ut="",$(new r.uA("platform-logger",t=>new a(t),"PRIVATE")),$(new r.uA("heartbeat",t=>new st(t),"PRIVATE")),Z(c,u,ut),Z(c,u,"esm2020"),Z("fire-js","")}}]);