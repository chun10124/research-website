"use strict";(globalThis.webpackChunkresearch=globalThis.webpackChunkresearch||[]).push([[42],{2294:(e,t,d)=>{d.d(t,{_Z:()=>s,bY:()=>c});var r=d(223),o=d(8185),n=d(7673),a=d(8193);const i=(0,r.Dk)().length?(0,r.Sx)():(0,r.Wp)({apiKey:"AIzaSyAUDHCT_dtMHQFPcUh6-gFSIFXT6dR9MVg",authDomain:"my-tools-1228.firebaseapp.com",projectId:"my-tools-1228",storageBucket:"my-tools-1228.firebasestorage.app",messagingSenderId:"511787460330",appId:"1:511787460330:web:2896507029051b666e5993",measurementId:"G-WFF13TV61G"}),l=(0,o._A)(i,{experimentalForceLongPolling:!0,useFetchStreams:!1}),s=(0,o.rJ)(l,"stockWatchlist"),c=(0,o.H9)(l,"trade_journals","my_only_log");let p;a.A.canUseDOM&&(p=(0,n.P5)(i))},8071:(e,t,d)=>{d.r(t),d.d(t,{default:()=>S});var r=d(6540),o=d(1656),n=d(8185),a=d(2294);const i=async(e,t)=>{try{const d=(0,n.H9)(a._Z,e);await(0,n.BN)(d,{...t,updatedAt:Date.now()},{merge:!0}),console.log(`[${e}] \u66f4\u65b0\u6210\u529f`)}catch(d){throw console.error(`\u274c [${e}] Firebase \u5beb\u5165\u5931\u6557:`,d.message),d}},l=()=>{const[e,t]=(0,r.useState)([]),[d,o]=(0,r.useState)(!0),l=async()=>{try{const e=await(async()=>{const e=(0,n.P)(a._Z,(0,n.My)("category","asc"));try{const t=(await(0,n.GG)(e)).docs.map(e=>({id:e.id,...e.data()}));return console.log(`[\u8b80\u53d6] \u6210\u529f\u5f9e\u96f2\u7aef\u7372\u53d6 ${t.length} \u7b46\u8cc7\u6599\u3002`),t}catch(t){return console.error("\u274c Firebase \u8b80\u53d6\u5931\u6557:",t),[]}})();t([...e]),o(!1),console.log("\u2705 \u6578\u64da\u5df2\u5e73\u6ed1\u540c\u6b65"),console.log("\u8868\u683c\u6578\u64da\u5df2\u6210\u529f\u5f37\u5236\u540c\u6b65")}catch(e){console.error("\u5237\u65b0\u5931\u6557:",e),o(!1)}};(0,r.useEffect)(()=>{"undefined"!=typeof window&&l()},[]);return{stocks:e,loading:d,updateStockField:async(e,t,d)=>{try{await i(e,{[t]:d}),await l(),console.log(`\u2705 [${e}] \u756b\u9762\u5df2\u81ea\u52d5\u5237\u65b0`)}catch(r){console.error("\u274c \u66f4\u65b0\u5931\u6557:",r)}},refreshData:l}},s=async e=>{try{if(!e)return null;const d=`https://stock-proxy.tzuchun11232004.workers.dev/?url=${encodeURIComponent(e)}`,r=await fetch(d);if(!r.ok){const t=await r.text();return console.warn(`[\u96a7\u9053\u932f\u8aa4 ${r.status}]: ${e.substring(0,40)} -> ${t}`),null}const o=await r.text();if(!o||""===o.trim())return null;try{return JSON.parse(o)}catch(t){return console.error("Worker \u56de\u50b3\u5167\u5bb9\u975e JSON \u683c\u5f0f:",o.substring(0,100)),null}}catch(d){return console.error("\u79c1\u4eba\u96a7\u9053\u8acb\u6c42\u6216\u9023\u7dda\u767c\u751f\u7570\u5e38:",d.message),null}},c=async(e,t=()=>{})=>{const d=String(e||"").trim();if(!d||"NaN"===d||"undefined"===d)throw new Error("\u7121\u6548\u7684\u80a1\u7968\u4ee3\u78bc");const r="2025-10-15",o=(e,t)=>`https://api.finmindtrade.com/api/v4/data?${new URLSearchParams({dataset:e,data_id:d,start_date:t,token:"eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJkYXRlIjoiMjAyNS0xMi0xNCAxNzowNzo1MyIsInVzZXJfaWQiOiJjaHVuMTAxMjQiLCJpcCI6IjYxLjIyOC43Ni4yMDYifQ.mSi9H6Lrus7e_wkaNxlYd6OoFmh79NQoQ7pZajx166s"}).toString()}`;try{t(` [${d}] \u6b63\u5728\u900f\u904e\u5c08\u5c6c\u96a7\u9053\u540c\u6b65\u6578\u64da...`);const[e,n,a,i,l,c]=await Promise.all([s(o("TaiwanStockPrice",r)),s(o("TaiwanStockInstitutionalInvestorsBuySell",r)),s(o("TaiwanStockShareholding",r)),s(o("TaiwanStockMonthRevenue","2024-01-01")),s(o("TaiwanStockInfo","")),s(o("TaiwanStockPER",r))]);if(!e||!e.data||0===e.data.length)throw new Error("\u7121\u6cd5\u53d6\u5f97\u57fa\u790e\u80a1\u50f9\u6578\u64da\uff0c\u8acb\u6aa2\u67e5\u4ee3\u78bc\u6216\u96a7\u9053\u72c0\u614b");const p=c?.data&&c.data.length>0?c.data[c.data.length-1].PER:"--",x=(e.data||[]).map(e=>e.close).reverse(),h=(n?.data||[]).filter(e=>"Foreign_Investor"===e.name||"\u5916\u8cc7"===e.name).map(e=>Math.round(((e.buy||0)-(e.sell||0))/1e3)).reverse(),u=(a?.data||[]).map(e=>Math.round((e.ForeignInvestmentShares||0)/1e3)).reverse(),g=(i?.data||[]).map(e=>Math.round((e.revenue||0)/1e3)),y=g.map((e,t)=>{const d=g[t-12];return d&&d>0?parseFloat(((e-d)/d*100).toFixed(2)):null}).filter(e=>null!==e),f=(l?.data||[]).find(e=>e.stock_id===d)?.stock_name||"\u672a\u77e5";return{code:d,name:f,currentPrice:x[0]||0,yesterdayClose:x[1]||0,realTimePE:p,lastUpdate:Date.now(),history:{priceClose:x,foreignChipFlowNet:h,foreignTotalHolding:u,revenueRaw:g,revenueYoY:y}}}catch(n){throw t(`\u274c \u932f\u8aa4: ${n.message}`),n}},p={K_PERIOD:2},x=40,h=.2,u=(e,t)=>{if(!e||e.length<t)return null;return e.slice(0,t).reduce((e,t)=>e+t,0)/t},g=(e,t,d,r)=>{if(!e||e.length<t+1||e.length<d+r)return null;const o=(e[0]+e[t])/2,n=u(e.slice(d),r);return void 0!==o&&null!==n?o-n:null},y=(e,t)=>null==e?null:parseFloat(Math.tanh(t*e).toFixed(2)),f=e=>{const t=e.history?.priceClose||[],d=e.history?.foreignChipFlowNet||[],r=e.history?.foreignTotalHolding||[],o=e.history?.revenueYoY?[...e.history.revenueYoY].reverse():[];if(t.length<24)return{calculatedStatus:"\u6578\u64da\u4e0d\u8db3"};const n=e.currentPrice||1,a=g(t,7,3,9),i=g(t,7,3,21),l=((e,t)=>{if(!e||e.length<t+2)return null;const d=u(e,t),r=u(e.slice(1),t),o=u(e.slice(2),t);return null===d||null===r||null===o?null:(d+o)/2-r})(o,p.K_PERIOD),s=y(null!==a?a/n:null,x),c=y(null!==i?i/n:null,x),f=y(l,h),w=d.slice(0,5).reduce((e,t)=>e+t,0),b=r[21]?(r[0]-r[21])/r[21]*100:0,m=e.yesterdayClose?(e.currentPrice-e.yesterdayClose)/e.yesterdayClose*100:0;return{DailyChange:null!==m?parseFloat(m.toFixed(2)):0,WeeklyChipFlow:w,HoldingGrowth_M:parseFloat(b.toFixed(2)),MA9Curvature:s,MA21Curvature:c,RevenueYoYCurvature:f,realTimePE:e.realTimePE||"--",calculatedStatus:"\u66f4\u65b0\u6210\u529f"}};var w=d(4848);const b=(e,t)=>{const d=e>0?"red":e<0?"green":"#333";if(!t||0===e||null==e)return{color:d,backgroundColor:"transparent"};const r=Math.min(.6*Math.abs(e),.6);return{backgroundColor:e>0?`rgba(231, 76, 60, ${r})`:`rgba(46, 204, 113, ${r})`,color:Math.abs(e)>.4?"#fff":d,fontWeight:Math.abs(e)>.5?"bold":"normal"}},m=({initialValue:e,onSave:t,type:d="text",style:o={}})=>{const[n,a]=(0,r.useState)(e||"");return(0,r.useEffect)(()=>{a(e||"")},[e]),(0,w.jsx)("input",{type:d,value:n,onChange:e=>a(e.target.value),onFocus:()=>a(e=>String(e).replace(/,/g,"")),onBlur:()=>{const e=String(n).replace(/,/g,"");if(""===e.trim())return void t(null);const d=parseFloat(e);isNaN(d)||t(d)},style:{width:"100%",border:"none",outline:"none",background:"transparent",textAlign:"center",padding:"4px",borderRadius:"4px",...o}})},j=({stocks:e,updateStockField:t,refreshData:d,loading:o})=>{const[n,a]=(0,r.useState)(!0),i=e||[];if((o||!1)&&0===i.length)return(0,w.jsx)("p",{children:"\u8f09\u5165\u4e2d... \u8acb\u7a0d\u5019"});const l=i.map(e=>{const t=f(e),d=parseFloat(e.currentPrice)||0,r=e.estimatedEPS,o=e.targetPrice,n=d>0&&r&&r>0?(d/r).toFixed(1):"--",a=o&&o>0&&d>0?(100*(o/d-1)).toFixed(1):null,i=(e,t=0)=>null==e||isNaN(e)||0===e?"":Number(e).toLocaleString("en-US",{minimumFractionDigits:t,maximumFractionDigits:t});return{...e,...t,displayPrice:i(d,1),displayWeeklyFlow:i(t.WeeklyChipFlow,0),displayEPS:i(r,1),displayTarget:i(o,0),forwardPE:n,potentialUpside:a,calculatedStatus:t.calculatedStatus||"\u8a08\u7b97\u6210\u529f"}});return(0,w.jsxs)("div",{style:{padding:"10px",maxWidth:"1600px",margin:"0 auto"},children:[(0,w.jsxs)("table",{style:{width:"100%",borderCollapse:"collapse",fontSize:"0.82rem",minWidth:"1200px",tableLayout:"fixed"},children:[(0,w.jsx)("thead",{children:(0,w.jsxs)("tr",{style:{backgroundColor:"#f8f9fa"},children:[(0,w.jsx)("th",{style:{padding:"4px 6px",border:"1px solid #ddd",width:"50px"},children:"\u4ee3\u865f"}),(0,w.jsx)("th",{style:{padding:"4px 6px",border:"1px solid #ddd",width:"85px"},children:"\u540d\u7a31"}),(0,w.jsx)("th",{style:{padding:"4px 6px",border:"1px solid #ddd",width:"65px"},children:"\u73fe\u50f9"}),(0,w.jsx)("th",{style:{padding:"4px 6px",border:"1px solid #ddd",width:"65px"},children:"\u6f32\u8dcc"}),(0,w.jsx)("th",{style:{padding:"4px 6px",border:"1px solid #ddd",width:"65px"},children:"PE"}),(0,w.jsx)("th",{style:{padding:"4px 6px",border:"1px solid #ddd",width:"65px"},children:"MA9"}),(0,w.jsx)("th",{style:{padding:"4px 6px",border:"1px solid #ddd",width:"65px"},children:"MA21"}),(0,w.jsx)("th",{style:{padding:"4px 6px",border:"1px solid #ddd",width:"65px"},children:"\u71df\u6536"}),(0,w.jsx)("th",{style:{padding:"4px 6px",border:"1px solid #ddd",width:"65px"},children:"\u5916\u8cc7\u9031"}),(0,w.jsx)("th",{style:{padding:"4px 6px",border:"1px solid #ddd",width:"65px"},children:"\u5916\u8cc7\u6301\u80a1"}),(0,w.jsx)("th",{style:{padding:"4px 6px",border:"1px solid #ddd",backgroundColor:"#e8f4fd",width:"65px"},children:"EPS"}),(0,w.jsx)("th",{style:{padding:"4px 6px",border:"1px solid #ddd",backgroundColor:"#e8f4fd",width:"65px"},children:"\u76ee\u6a19\u50f9"}),(0,w.jsx)("th",{style:{padding:"4px 6px",border:"1px solid #ddd",backgroundColor:"#e8f4fd",width:"65px"},children:"\u6f32\u5e45"}),(0,w.jsx)("th",{style:{padding:"4px 6px",border:"1px solid #ddd",backgroundColor:"#e8f4fd",width:"65px"},children:"\u524d\u77bbPE"}),(0,w.jsx)("th",{style:{padding:"4px 6px",border:"1px solid #ddd",backgroundColor:"#e8f4fd",width:"180px"},children:"\u7b46\u8a18"}),(0,w.jsx)("th",{style:{padding:"4px 6px",border:"1px solid #ddd",width:"65px"},children:"\u72c0\u614b"})]})}),(0,w.jsx)("tbody",{children:l.map(e=>(0,w.jsxs)("tr",{style:{height:"32px"},children:[(0,w.jsx)("td",{style:{padding:"4px 6px",border:"1px solid #ddd",fontWeight:"bold"},children:e.id}),(0,w.jsx)("td",{style:{padding:"4px 6px",border:"1px solid #ddd",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:e.name}),(0,w.jsx)("td",{style:{padding:"4px 6px",border:"1px solid #ddd",textAlign:"right"},children:e.displayPrice}),(0,w.jsxs)("td",{style:{padding:"4px 6px",border:"1px solid #ddd",textAlign:"center",color:e.DailyChange>0?"red":"green"},children:[e.DailyChange,"%"]}),(0,w.jsx)("td",{style:{padding:"4px 6px",border:"1px solid #ddd",textAlign:"center"},children:e.realTimePE}),(0,w.jsx)("td",{style:{padding:"4px 6px",border:"1px solid #ddd",textAlign:"center",...b(e.MA9Curvature,n)},children:e.MA9Curvature}),(0,w.jsx)("td",{style:{padding:"4px 6px",border:"1px solid #ddd",textAlign:"center",...b(e.MA21Curvature,n)},children:e.MA21Curvature}),(0,w.jsx)("td",{style:{padding:"4px 6px",border:"1px solid #ddd",textAlign:"center",...b(e.RevenueYoYCurvature,n)},children:e.RevenueYoYCurvature}),(0,w.jsx)("td",{style:{padding:"4px 6px",border:"1px solid #ddd",textAlign:"right",color:e.WeeklyChipFlow>0?"red":"green"},children:e.displayWeeklyFlow}),(0,w.jsxs)("td",{style:{padding:"4px 6px",border:"1px solid #ddd",textAlign:"right",color:e.HoldingGrowth_M>0?"red":"green"},children:[e.HoldingGrowth_M,"%"]}),(0,w.jsx)("td",{style:{padding:"2px",border:"1px solid #ddd"},children:(0,w.jsx)(m,{initialValue:e.displayEPS,onSave:async r=>{await t(e.id,"estimatedEPS",r),await new Promise(e=>setTimeout(e,300)),d&&await d()},style:{fontSize:"13px"}})}),(0,w.jsx)("td",{style:{padding:"2px",border:"1px solid #ddd"},children:(0,w.jsx)(m,{initialValue:e.displayTarget,onSave:async r=>{await t(e.id,"targetPrice",r),d&&await d()},style:{fontSize:"13px"}})}),(0,w.jsxs)("td",{style:{padding:"4px 6px",border:"1px solid #ddd",textAlign:"center",fontWeight:"bold",color:e.potentialUpside>0?"red":"green"},children:[e.potentialUpside,"%"]}),(0,w.jsx)("td",{style:{padding:"4px 6px",border:"1px solid #ddd",textAlign:"center"},children:e.forwardPE}),(0,w.jsx)("td",{style:{padding:"2px",border:"1px solid #ddd"},children:(0,w.jsx)(m,{initialValue:e.notes,onSave:async r=>{await t(e.id,"notes",r),d&&await d()},style:{textAlign:"left",fontSize:"13px"}})}),(0,w.jsx)("td",{style:{padding:"4px 6px",border:"1px solid #ddd",fontSize:"13px",color:"#999"},children:e.calculatedStatus})]},e.id))})]}),(0,w.jsx)("div",{style:{marginBottom:"10px",display:"flex",alignItems:"center"},children:(0,w.jsxs)("label",{style:{cursor:"pointer",display:"flex",alignItems:"center",fontSize:"12px",padding:"4px 10px",backgroundColor:n?"#e8f4fd":"#f5f5f5",borderRadius:"15px"},children:[(0,w.jsx)("input",{type:"checkbox",checked:n,onChange:()=>a(!n),style:{marginRight:"5px"}}),"\u71b1\u529b\u5716\uff1a",n?"\u958b":"\u95dc"]})})]})},S=()=>{const[e,t]=(0,r.useState)(""),[d,n]=(0,r.useState)(""),{stocks:a,loading:s,refreshData:p,updateStockField:x}=l();(e=>{const t=(0,r.useRef)(!1);(0,r.useEffect)(()=>{0===e.length||t.current||(async()=>{console.log("\ud83d\ude80 [\u6578\u64da\u540c\u6b65] \u555f\u52d5\u667a\u6167\u6aa2\u67e5..."),t.current=!0;for(const t of e)try{if(Date.now()-(t.lastUpdate||0)<216e5){console.log(`\u23e9 [${t.code}] ${t.name} \u6700\u8fd1\u5df2\u66f4\u65b0\uff0c\u8df3\u904e\u540c\u6b65\u3002`);continue}console.log(`\ud83d\udd04 [${t.code}] ${t.name} \u8cc7\u6599\u904e\u671f\uff0c\u958b\u59cb\u540c\u6b65...`);const e=await c(t.code,e=>{console.log(`   > ${e}`)});e&&(await i(t.id,{...e,estimatedEPS:t.estimatedEPS||0,targetPrice:t.targetPrice||0,notes:t.notes||""}),console.log(`\u2705 [${t.code}] \u66f4\u65b0\u6210\u529f\u3002`)),await new Promise(e=>setTimeout(e,2e3))}catch(d){console.error(`\u274c [${t.code}] \u540c\u6b65\u904e\u7a0b\u4e2d\u767c\u751f\u932f\u8aa4:`,d);continue}console.log("\ud83c\udfc1 [\u6578\u64da\u540c\u6b65] \u672c\u8f2a\u6aa2\u67e5\u7d50\u675f\u3002"),t.current=!1})()},[e.length])})(a);return(0,w.jsx)(o.A,{title:"\u91cf\u5316\u5206\u6790\u5100\u8868\u677f",children:(0,w.jsx)("main",{style:{padding:"20px 0"},children:(0,w.jsxs)("div",{style:{padding:"0 20px",maxWidth:"1650px",margin:"0 auto"},children:[(0,w.jsx)("div",{style:{overflowX:"auto",backgroundColor:"#fff",borderRadius:"8px",boxShadow:"0 4px 6px rgba(0,0,0,0.05)",marginBottom:"30px",marginLeft:"-25px",marginTop:"-25px"},children:(0,w.jsx)(j,{stocks:a,updateStockField:x,refreshData:p})}),(0,w.jsxs)("div",{style:{borderTop:"2px solid #eee",paddingTop:"25px",marginTop:"10px"},children:[(0,w.jsxs)("div",{style:{backgroundColor:"#f8f9fa",padding:"15px 25px",borderRadius:"12px",display:"inline-flex",alignItems:"center",gap:"15px"},children:[(0,w.jsx)("strong",{style:{fontSize:"1.1em",color:"#333"},children:"\u65b0\u589e/\u66f4\u65b0\u80a1\u7968"}),(0,w.jsx)("input",{type:"text",value:e,onChange:e=>t(e.target.value),placeholder:"\u8f38\u5165\u80a1\u7968\u4ee3\u78bc",disabled:s,style:{padding:"8px 12px",border:"1px solid #ccc",borderRadius:"6px",width:"140px",fontSize:"14px"}}),(0,w.jsx)("button",{onClick:async()=>{const d=e.trim();if(d){n(`\ud83d\udfe1 \u6b63\u5728\u521d\u59cb\u5316 ${d}...`);try{const e={id:d,code:d,name:"\u8b80\u53d6\u4e2d...",category:"\u81ea\u9078",lastUpdate:0,history:{priceClose:[],foreignChipFlowNet:[],foreignTotalHolding:[],revenueRaw:[],revenueYoY:[]}};await i(d,e),await p(),n(`\u6b63\u5728\u5f9e API \u6293\u53d6 ${d} \u7684\u8a73\u7d30\u6578\u64da...`),await(async e=>{console.log(`\ud83d\ude80 \u6b63\u5728\u540c\u6b65 ${e.name||e.code}...`);try{const t=await c(e.code);if(!t)return void console.warn(`\u26a0\ufe0f [${e.code}] \u672a\u80fd\u7372\u53d6\u6700\u65b0\u6578\u64da`);await i(e.code,{...t,estimatedEPS:e.estimatedEPS||0,targetPrice:e.targetPrice||0,notes:e.notes||"",lastUpdate:Date.now()}),console.log(`\u2705 [${e.code}] \u6578\u64da\u540c\u6b65\u6210\u529f\u4e26\u5b58\u5165\u96f2\u7aef\u3002`)}catch(t){throw console.error(`\u274c [${e.code}] syncStockSnapshots \u5931\u6557:`,t.message),t}})(e),await p(),n(`\u2705 ${d} \u540c\u6b65\u6210\u529f\uff01`),t("")}catch(r){console.error("\u540c\u6b65\u5931\u6557:",r),n(`\u274c \u5931\u6557\uff1a${r.message}`)}}else n("\u8acb\u8f38\u5165\u80a1\u7968\u4ee3\u78bc\uff01")},disabled:s||!e,style:{padding:"10px 20px",cursor:"pointer",backgroundColor:"#25c2a0",color:"white",border:"none",borderRadius:"6px",fontWeight:"bold",transition:"opacity 0.2s"},children:s?"\u8f09\u5165\u4e2d...":"\u540c\u6b65\u6578\u64da"}),(0,w.jsx)("span",{style:{marginLeft:"10px",color:d.startsWith("\u274c")?"#e74c3c":"#27ae60",fontWeight:"500"},children:d})]}),(0,w.jsx)("p",{style:{fontSize:"0.85em",color:"#888",marginTop:"10px",paddingLeft:"5px"},children:"* \u8f38\u5165\u80a1\u7968\u4ee3\u78bc\u5f8c\u9ede\u64ca\u540c\u6b65\uff0c\u7cfb\u7d71\u5c07\u81ea\u52d5\u5f9e API \u7372\u53d6\u6700\u65b0\u7684\u80a1\u50f9\u3001\u71df\u6536\u8207\u7c4c\u78bc\u6578\u64da\u3002"})]})]})})})}}}]);