"use strict";(globalThis.webpackChunkresearch=globalThis.webpackChunkresearch||[]).push([[42],{2294:(e,t,d)=>{d.d(t,{_Z:()=>s,bY:()=>p,db:()=>a});var r=d(223),o=d(8185),n=d(7673),i=d(8193);const l=(0,r.Wp)({apiKey:"AIzaSyAUDHCT_dtMHQFPcUh6-gFSIFXT6dR9MVg",authDomain:"my-tools-1228.firebaseapp.com",projectId:"my-tools-1228",storageBucket:"my-tools-1228.firebasestorage.app",messagingSenderId:"511787460330",appId:"1:511787460330:web:2896507029051b666e5993",measurementId:"G-WFF13TV61G"}),a=(0,o.aU)(l),s=(0,o.rJ)(a,"stockWatchlist"),p=(0,o.H9)(a,"trade_journals","my_only_log");let c;i.A.canUseDOM&&(c=(0,n.P5)(l))},8071:(e,t,d)=>{d.r(t),d.d(t,{default:()=>w});var r=d(6540),o=d(1656),n=d(8185),i=d(2294);const l=async(e,t)=>{try{const d=(0,n.H9)(i._Z,e);await(0,n.BN)(d,{...t,updatedAt:Date.now()},{merge:!0})}catch(d){throw console.error(`\u274c [${e}] Firebase \u5beb\u5165\u5931\u6557:`,d.message),d}},a=()=>{const[e,t]=(0,r.useState)([]),[d,o]=(0,r.useState)(!0);(0,r.useEffect)(()=>{if("undefined"==typeof window)return void o(!1);const e=(e=>{const t=(0,n.P)(i._Z,(0,n.My)("category","asc"));return(0,n.aQ)(t,t=>{try{const d=t.docs.map(e=>({id:e.id,...e.data()}));e(d),console.log(`\ud83d\udce1 [\u8a02\u95b1] \u6210\u529f\u63a5\u6536 ${d.length} \u7b46\u80a1\u7968\u6578\u64da\u3002`)}catch(d){console.error("\u274c Firebase \u8b80\u53d6 (onSnapshot) \u6578\u64da\u8655\u7406\u5931\u6557:",d),e([])}})})(e=>{t(e),o(!1)});return()=>e()},[]);return{stocks:e,loading:d,updateStockField:async(e,t,d)=>{try{const r=(0,n.H9)(i.db,"stockWatchlist",String(e));await(0,n.mZ)(r,{[t]:d}),console.log(`\u2705 [${e}] \u66f4\u65b0\u6210\u529f`)}catch(r){console.error("\u274c Firebase \u66f4\u65b0\u5931\u6557:",r)}}}},s=async(e,t=()=>{})=>{const d="2025-10-15",r=(t,d)=>{const r=new URLSearchParams({dataset:t,data_id:e,start_date:d,token:"eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJkYXRlIjoiMjAyNS0xMi0xNCAxNzowNzo1MyIsInVzZXJfaWQiOiJjaHVuMTAxMjQiLCJpcCI6IjYxLjIyOC43Ni4yMDYifQ.mSi9H6Lrus7e_wkaNxlYd6OoFmh79NQoQ7pZajx166s"});return`https://corsproxy.io/?${encodeURIComponent(`https://api.finmindtrade.com/api/v4/data?${r.toString()}`)}`};try{t(` [${e}] \u958b\u59cb\u6293\u53d6\u591a\u65b9 API \u6578\u64da (30\u65e5\u80a1\u50f9, 3\u6708\u71df\u6536)...`);const[o,n,i,l,a]=await Promise.all([fetch(r("TaiwanStockPrice",d)).then(e=>e.json()),fetch(r("TaiwanStockInstitutionalInvestorsBuySell",d)).then(e=>e.json()),fetch(r("TaiwanStockShareholding",d)).then(e=>e.json()),fetch(r("TaiwanStockMonthRevenue","2024-01-01")).then(e=>e.json()),fetch(r("TaiwanStockInfo","")).then(e=>e.json())]),s=(o.data||[]).map(e=>e.close).reverse(),p=(n.data||[]).filter(e=>"Foreign_Investor"===e.name||"\u5916\u8cc7"===e.name).map(e=>Math.round(((e.buy||0)-(e.sell||0))/1e3)).reverse(),c=(i.data||[]).map(e=>Math.round((e.ForeignInvestmentShares||0)/1e3)).reverse(),x=(l.data||[]).map(e=>Math.round((e.revenue||0)/1e3)),h=x.map((e,t)=>{const d=x[t-12];return d&&d>0?parseFloat(((e-d)/d*100).toFixed(2)):null}).filter(e=>null!==e),g=(a.data||[]).find(t=>t.stock_id===e),u=g?g.stock_name:"\u672a\u77e5";return{code:e,name:u,currentPrice:s[0]||0,yesterdayClose:s.length>=2?s[1]:0,history:{priceClose:s,foreignChipFlowNet:p,foreignTotalHolding:c,revenueRaw:x,revenueYoY:h}}}catch(o){throw t(`\u274c \u932f\u8aa4: ${o.message}`),o}},p={K_PERIOD:2},c=40,x=.2,h=(e,t)=>{if(!e||e.length<t)return null;return e.slice(0,t).reduce((e,t)=>e+t,0)/t},g=(e,t,d,r)=>{if(!e||e.length<t+1||e.length<d+r)return null;const o=(e[0]+e[t])/2,n=h(e.slice(d),r);return void 0!==o&&null!==n?o-n:null},u=(e,t)=>null==e?null:parseFloat(Math.tanh(t*e).toFixed(2)),y=e=>{const t=e.history?.priceClose||[],d=e.history?.foreignChipFlowNet||[],r=e.history?.foreignTotalHolding||[],o=e.history?.revenueYoY?[...e.history.revenueYoY].reverse():[];if(t.length<24)return{calculatedStatus:"\u6578\u64da\u4e0d\u8db3"};const n=e.currentPrice||1,i=g(t,7,3,9),l=g(t,7,3,21),a=((e,t)=>{if(!e||e.length<t+2)return null;const d=h(e,t),r=h(e.slice(1),t),o=h(e.slice(2),t);return null===d||null===r||null===o?null:(d+o)/2-r})(o,p.K_PERIOD),s=u(null!==i?i/n:null,c),y=u(null!==l?l/n:null,c),f=u(a,x),b=d.slice(0,5).reduce((e,t)=>e+t,0),m=r[21]?(r[0]-r[21])/r[21]*100:0,j=e.yesterdayClose?(e.currentPrice-e.yesterdayClose)/e.yesterdayClose*100:0;return{DailyChange:null!==j?parseFloat(j.toFixed(2)):0,WeeklyChipFlow:b,HoldingGrowth_M:parseFloat(m.toFixed(2)),MA9Curvature:s,MA21Curvature:y,RevenueYoYCurvature:f,calculatedStatus:"\u66f4\u65b0\u6210\u529f"}};var f=d(4848);const b=(e,t)=>{const d=e>0?"red":e<0?"green":"#333";if(!t||0===e||null==e)return{color:d,backgroundColor:"transparent"};const r=Math.min(.6*Math.abs(e),.6);return{backgroundColor:e>0?`rgba(231, 76, 60, ${r})`:`rgba(46, 204, 113, ${r})`,color:Math.abs(e)>.4?"#fff":d,fontWeight:Math.abs(e)>.5?"bold":"normal"}},m=({initialValue:e,onSave:t,type:d="text",style:o={}})=>{const[n,i]=(0,r.useState)(e||"");return(0,r.useEffect)(()=>{i(e||"")},[e]),(0,f.jsx)("input",{type:d,value:n,onChange:e=>i(e.target.value),onFocus:()=>i(e=>String(e).replace(/,/g,"")),onBlur:()=>{const e=String(n).replace(/,/g,"");if(""===e.trim())return void t(null);const d=parseFloat(e);isNaN(d)||t(d)},style:{width:"100%",border:"none",outline:"none",background:"transparent",textAlign:"center",padding:"4px",borderRadius:"4px",...o}})},j=()=>{const{stocks:e,loading:t,updateStockField:d}=a(),[o,n]=(0,r.useState)(!0);if(t)return(0,f.jsx)("p",{children:"\u8f09\u5165\u4e2d... \u8acb\u7a0d\u5019"});const i=e.map(e=>{const t=y(e),d=parseFloat(e.currentPrice)||0,r=e.estimatedEPS,o=e.targetPrice,n=d>0&&r&&r>0?(d/r).toFixed(1):"--",i=o&&o>0&&d>0?(100*(o/d-1)).toFixed(1):null,l=(e,t=0)=>null==e||isNaN(e)||0===e?"":Number(e).toLocaleString("en-US",{minimumFractionDigits:t,maximumFractionDigits:t});return{...e,...t,displayPrice:l(d,1),displayWeeklyFlow:l(t.WeeklyChipFlow,0),displayEPS:l(r,1),displayTarget:l(o,0),forwardPE:n,potentialUpside:i,calculatedStatus:t.calculatedStatus||"\u8a08\u7b97\u6210\u529f"}});return(0,f.jsxs)("div",{style:{padding:"20px",maxWidth:"1600px",margin:"0 auto"},children:[(0,f.jsxs)("table",{style:{width:"100%",borderCollapse:"collapse",fontSize:"0.9em",minWidth:"1400px",tableLayout:"fixed"},children:[(0,f.jsx)("thead",{children:(0,f.jsxs)("tr",{style:{backgroundColor:"#f2f2f2"},children:[(0,f.jsx)("th",{style:{padding:"8px",border:"1px solid #ddd",width:"55px"},children:"\u4ee3\u865f"}),(0,f.jsx)("th",{style:{padding:"8px",border:"1px solid #ddd",width:"90px"},children:"\u540d\u7a31"}),(0,f.jsx)("th",{style:{padding:"8px",border:"1px solid #ddd",width:"80px"},children:"\u73fe\u50f9"}),(0,f.jsx)("th",{style:{padding:"8px",border:"1px solid #ddd",width:"80px"},children:"\u6f32\u8dcc"}),(0,f.jsx)("th",{style:{padding:"8px",border:"1px solid #ddd",width:"80px"},children:"MA9\u52a0\u901f"}),(0,f.jsx)("th",{style:{padding:"8px",border:"1px solid #ddd",width:"80px"},children:"MA21\u52a0\u901f"}),(0,f.jsx)("th",{style:{padding:"8px",border:"1px solid #ddd",width:"80px"},children:"\u71df\u6536\u52a0\u901f"}),(0,f.jsx)("th",{style:{padding:"8px",border:"1px solid #ddd",width:"80px"},children:"\u5916\u8cc7\u9031\u8cb7\u8ce3"}),(0,f.jsx)("th",{style:{padding:"8px",border:"1px solid #ddd",width:"80px"},children:"\u6301\u80a1\u6708\u589e\u7387"}),(0,f.jsx)("th",{style:{padding:"8px",border:"1px solid #ddd",backgroundColor:"#e8f4fd",width:"80px"},children:"\u9810\u4f30EPS"}),(0,f.jsx)("th",{style:{padding:"8px",border:"1px solid #ddd",backgroundColor:"#e8f4fd",width:"80px"},children:"\u76ee\u6a19\u50f9"}),(0,f.jsx)("th",{style:{padding:"8px",border:"1px solid #ddd",backgroundColor:"#e8f4fd",width:"80px"},children:"\u6f5b\u5728\u6f32\u5e45"}),(0,f.jsx)("th",{style:{padding:"8px",border:"1px solid #ddd",backgroundColor:"#e8f4fd",width:"80px"},children:"\u524d\u77bbPE"}),(0,f.jsx)("th",{style:{padding:"8px",border:"1px solid #ddd",backgroundColor:"#e8f4fd",width:"200px"},children:"\u7b46\u8a18"}),(0,f.jsx)("th",{style:{padding:"8px",border:"1px solid #ddd",width:"80px"},children:"\u72c0\u614b"})]})}),(0,f.jsx)("tbody",{children:i.map(e=>(0,f.jsxs)("tr",{children:[(0,f.jsx)("td",{style:{padding:"8px",border:"1px solid #ddd",fontWeight:"bold"},children:e.id}),(0,f.jsx)("td",{style:{padding:"8px",border:"1px solid #ddd"},children:e.name||"N/A"}),(0,f.jsx)("td",{style:{padding:"8px",border:"1px solid #ddd",textAlign:"right"},children:e.displayPrice}),(0,f.jsx)("td",{style:{padding:"8px",border:"1px solid #ddd",textAlign:"center",color:e.DailyChange>0?"red":"green"},children:null!==e.DailyChange?`${e.DailyChange}%`:"0.00%"}),(0,f.jsx)("td",{style:{padding:"8px",border:"1px solid #ddd",textAlign:"center",...b(e.MA9Curvature,o)},children:e.MA9Curvature}),(0,f.jsx)("td",{style:{padding:"8px",border:"1px solid #ddd",textAlign:"center",...b(e.MA21Curvature,o)},children:e.MA21Curvature}),(0,f.jsx)("td",{style:{padding:"8px",border:"1px solid #ddd",textAlign:"center",...b(e.RevenueYoYCurvature,o)},children:e.RevenueYoYCurvature}),(0,f.jsx)("td",{style:{padding:"8px",border:"1px solid #ddd",textAlign:"right",color:e.WeeklyChipFlow>0?"red":e.WeeklyChipFlow<0?"green":"#333"},children:e.displayWeeklyFlow}),(0,f.jsxs)("td",{style:{padding:"8px",border:"1px solid #ddd",textAlign:"right",color:e.HoldingGrowth_M>0?"red":e.HoldingGrowth_M<0?"green":"#333"},children:[e.HoldingGrowth_M,"%"]}),(0,f.jsx)("td",{style:{padding:"4px",border:"1px solid #ddd"},children:(0,f.jsx)(m,{initialValue:e.displayEPS,onSave:t=>d(e.id,"estimatedEPS",t),style:{fontSize:"14px"}})}),(0,f.jsx)("td",{style:{padding:"4px",border:"1px solid #ddd"},children:(0,f.jsx)(m,{initialValue:e.displayTarget,onSave:t=>d(e.id,"targetPrice",t),style:{fontSize:"14px"}})}),(0,f.jsx)("td",{style:{padding:"8px",border:"1px solid #ddd",textAlign:"center",fontWeight:"bold",color:e.potentialUpside>0?"red":"green"},children:null!==e.potentialUpside?`${e.potentialUpside}%`:"--"}),(0,f.jsx)("td",{style:{padding:"8px",border:"1px solid #ddd",textAlign:"center"},children:e.forwardPE}),(0,f.jsx)("td",{style:{padding:"4px",border:"1px solid #ddd"},children:(0,f.jsx)(m,{initialValue:e.notes,onSave:t=>d(e.id,"notes",t),style:{textAlign:"left",fontSize:"14px"}})}),(0,f.jsx)("td",{style:{padding:"8px",border:"1px solid #ddd",fontSize:"12px"},children:e.calculatedStatus})]},e.id))})]}),(0,f.jsx)("div",{style:{marginBottom:"15px",display:"flex",alignItems:"center",gap:"10px"},children:(0,f.jsxs)("label",{style:{cursor:"pointer",display:"flex",alignItems:"center",fontSize:"14px",fontWeight:"bold",padding:"6px 12px",backgroundColor:o?"#e8f4fd":"#f5f5f5",borderRadius:"20px",transition:"all 0.3s"},children:[(0,f.jsx)("input",{type:"checkbox",checked:o,onChange:()=>n(!o),style:{marginRight:"8px",cursor:"pointer"}}),"\u6307\u6a19\u71b1\u529b\u5716\u986f\u793a\uff1a",o?"\u958b\u555f":"\u95dc\u9589"]})})]})},w=()=>{const[e,t]=(0,r.useState)(""),[d,n]=(0,r.useState)(""),{stocks:i,loading:p}=a();(e=>{(0,r.useEffect)(()=>{e.length>0&&(()=>{if(0===e.length)return!1;const t=e[0].lastUpdate||0;return Date.now()-t>36e5})()&&(async()=>{console.log("\ud83d\ude80 [\u6578\u64da\u540c\u6b65] \u958b\u59cb\u6279\u6b21\u66f4\u65b0\u5168\u9ad4\u80a1\u7968\u8cc7\u6599...");for(const d of e)try{const e=await s(d.code,e=>console.log(e));e&&(await l(d.id,{...e,eps:d.eps||0,targetPrice:d.targetPrice||0,memo:d.memo||"",category:d.category||"\u672a\u5206\u985e"}),console.log(`\u2705 ${d.name} (${d.code}) \u66f4\u65b0\u6210\u529f`)),await new Promise(e=>setTimeout(e,1e3))}catch(t){console.error(`\u274c ${d.code} \u540c\u6b65\u5931\u6557:`,t)}console.log("\ud83c\udfc1 [\u6578\u64da\u540c\u6b65] \u5168\u9ad4\u66f4\u65b0\u5b8c\u6210")})()},[e.length])})(i);return(0,f.jsx)(o.A,{title:"\u91cf\u5316\u5206\u6790\u5100\u8868\u677f",children:(0,f.jsx)("main",{style:{padding:"20px 0"},children:(0,f.jsxs)("div",{style:{padding:"0 20px",maxWidth:"1650px",margin:"0 auto"},children:[(0,f.jsx)("div",{style:{overflowX:"auto",backgroundColor:"#fff",borderRadius:"8px",boxShadow:"0 4px 6px rgba(0,0,0,0.05)",marginBottom:"30px",marginLeft:"-25px",marginTop:"-25px"},children:(0,f.jsx)(j,{})}),(0,f.jsxs)("div",{style:{borderTop:"2px solid #eee",paddingTop:"25px",marginTop:"10px"},children:[(0,f.jsxs)("div",{style:{backgroundColor:"#f8f9fa",padding:"15px 25px",borderRadius:"12px",display:"inline-flex",alignItems:"center",gap:"15px"},children:[(0,f.jsx)("strong",{style:{fontSize:"1.1em",color:"#333"},children:"\u65b0\u589e/\u66f4\u65b0\u80a1\u7968"}),(0,f.jsx)("input",{type:"text",value:e,onChange:e=>t(e.target.value),placeholder:"\u8f38\u5165\u80a1\u7968\u4ee3\u78bc",disabled:p,style:{padding:"8px 12px",border:"1px solid #ccc",borderRadius:"6px",width:"140px",fontSize:"14px"}}),(0,f.jsx)("button",{onClick:async()=>{const d=e.trim();if(d){n(`\ud83d\udfe1 \u5617\u8a66\u540c\u6b65 ${d}...`);try{await l(d,{code:d,name:`\u4ee3\u78bc ${d}`,category:"\u81ea\u9078",lastUpdate:0,history:{price:[]}}),n(`\u2705 ${d} \u65b0\u589e\u6210\u529f\uff01`),t("")}catch(r){n(`\u274c \u5931\u6557\uff1a${r.message}`)}}else n("\u8acb\u8f38\u5165\u80a1\u7968\u4ee3\u78bc\uff01")},disabled:p||!e,style:{padding:"10px 20px",cursor:"pointer",backgroundColor:"#25c2a0",color:"white",border:"none",borderRadius:"6px",fontWeight:"bold",transition:"opacity 0.2s"},children:p?"\u8f09\u5165\u4e2d...":"\u540c\u6b65\u6578\u64da"}),(0,f.jsx)("span",{style:{marginLeft:"10px",color:d.startsWith("\u274c")?"#e74c3c":"#27ae60",fontWeight:"500"},children:d})]}),(0,f.jsx)("p",{style:{fontSize:"0.85em",color:"#888",marginTop:"10px",paddingLeft:"5px"},children:"* \u8f38\u5165\u80a1\u7968\u4ee3\u78bc\u5f8c\u9ede\u64ca\u540c\u6b65\uff0c\u7cfb\u7d71\u5c07\u81ea\u52d5\u5f9e API \u7372\u53d6\u6700\u65b0\u7684\u80a1\u50f9\u3001\u71df\u6536\u8207\u7c4c\u78bc\u6578\u64da\u3002"})]})]})})})}}}]);