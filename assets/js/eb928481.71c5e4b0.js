"use strict";(globalThis.webpackChunkresearch=globalThis.webpackChunkresearch||[]).push([[253],{509:(e,t,i)=>{i.d(t,{A:()=>W});var o=i(6540),n=i(9410),s=i(8185),r=i(223),a=i(7673),l=i(8193);const d=(0,r.Wp)({apiKey:"AIzaSyAUDHCT_dtMHQFPcUh6-gFSIFXT6dR9MVg",authDomain:"my-tools-1228.firebaseapp.com",projectId:"my-tools-1228",storageBucket:"my-tools-1228.firebasestorage.app",messagingSenderId:"511787460330",appId:"1:511787460330:web:2896507029051b666e5993",measurementId:"G-WFF13TV61G"}),c=(0,s.aU)(d),p=(0,s.H9)(c,"trade_journals","my_only_log");let x;l.A.canUseDOM&&(x=(0,a.P5)(d));const u=e=>e>0?"red":e<0?"green":"inherit",m="#deb887",h=e=>null==e||isNaN(e)?"0.0":Number(e).toLocaleString("en-US",{minimumFractionDigits:1,maximumFractionDigits:1}),g=e=>{if(null==e||isNaN(e))return"0";return Math.round(e).toLocaleString("en-US",{minimumFractionDigits:0,maximumFractionDigits:0})},y=e=>{const t=()=>new Date;let i=null;switch(e){case"WEEK":const e=t();i=new Date(e.setDate(e.getDate()-e.getDay()));break;case"MONTH":const o=t();i=new Date(o.getFullYear(),o.getMonth(),1);break;case"QUARTER":const n=t();i=new Date(n.setMonth(n.getMonth()-3));break;case"HALFYEAR":const s=t();i=new Date(s.setMonth(s.getMonth()-6));break;case"YEAR":const r=t();i=new Date(r.setFullYear(r.getFullYear()-1));break;default:i=null}return i},b="historyDetailsContainer_wk0I",f="historyInfoRow_comM",j="historyTradeRow_eXtU",v="historyListItem_mt5u",C="historyActions_ri9g",w="tradeReason_Errh",N="pnlSelectContainer_KKgZ",S="pnlSearchInput_KtSv",L="pnlAmountCell_sbZg",R="responsiveContainer_v6SI",A="formInputRow_S0Mo",D="responsiveFlexRow_QYip",Q="responsiveFilterRow_lH0E",M="responsiveFilterRowControls_xWAm",I="tradeAction_Kt2K",F="pnlHeaderRow_Gj5x",E="tradeFormContainer_OqeV",T="pnlSummaryCard_rCTl",k="directionBtn_Ug4P",_="activeBuy_VAAX",B="activeSell_u4Gg";var U=i(4848);const W=function(){const[e,t]=(0,o.useState)([]),[i,r]=(0,o.useState)({id:"",code:"",name:"",direction:"BUY",quantity:"",price:"",date:(new Date).toISOString().substring(0,10),reason:""}),[a,l]=(0,o.useState)(null),[d,c]=(0,o.useState)("ALL"),[x,W]=(0,o.useState)("ALL"),[Y,z]=(0,o.useState)(""),[q,H]=(0,o.useState)("");(0,o.useEffect)(()=>{const e=(0,s.aQ)(p,e=>{if(e.exists()){const i=e.data().entries||[];t(i.sort((e,t)=>(t.timeId||0)-(e.timeId||0))),console.log("\u6578\u64da\u5df2\u5f9e Firestore \u52a0\u8f09\u4e26\u5373\u6642\u540c\u6b65\u3002")}else console.log("Firestore \u6587\u4ef6\u4e0d\u5b58\u5728\uff0c\u5f9e\u7a7a\u65e5\u8a8c\u958b\u59cb\u3002"),t([])},e=>{console.error("Firestore \u76e3\u807d\u5931\u6557:",e)});return()=>e()},[]);const K=async e=>{try{const i=e.sort((e,t)=>{const i=new Date(e.date),o=new Date(t.date)-i;return 0!==o?o:(t.timeId||0)-(e.timeId||0)});t(i),await(0,s.BN)(p,{entries:e}),console.log("\u6578\u64da\u5df2\u6210\u529f\u5beb\u5165 Firestore\u3002")}catch(i){console.error("\u5beb\u5165 Firestore \u5931\u6557:",i),alert("\u8b66\u544a\uff1a\u6578\u64da\u5beb\u5165\u96f2\u7aef\u5931\u6557\uff0c\u8acb\u6aa2\u67e5\u7db2\u8def\u9023\u7dda\u3002")}},O=(0,o.useMemo)(()=>{let t=[...e];const i=y(x);if(i){const e=i.getTime();t=t.filter(t=>new Date(t.date).getTime()>=e)}const o=Y.trim().toLowerCase();return o&&(t=t.filter(e=>e.code.toLowerCase().includes(o)||e.name.toLowerCase().includes(o))),t.sort((e,t)=>{const i=new Date(e.date),o=new Date(t.date);return o-i!==0?o-i:(t.timeId||0)-(e.timeId||0)}),t},[e,x,Y]),P=(0,o.useMemo)(()=>((e,t="ALL")=>{if(!e||0===e.length)return{byStock:[],totalRealizedPnl:0,winRate:0,totalClosedTrades:0};const i=[...e].sort((e,t)=>{const i=new Date(e.date)-new Date(t.date);return 0!==i?i:(e.timeId||0)-(t.timeId||0)}),o={},n=1e-6;i.forEach(e=>{const t=e.code;o[t]||(o[t]={name:e.name,positionQty:0,positionCost:0,trades:[]});const i=o[t],s=Number(e.quantity),r=Number(e.price),a=new Date(e.date).getTime();if(isNaN(s)||s<=n||isNaN(r)||r<.5)return;const l=(e,t,o,s)=>{let r=0;const l=Number(e),d=Number(t),c=Number(o);r=s?c*l-d*l:d*l-c*l,Math.abs(r)>n&&i.trades.push({pnl:r,closeTime:a})},d=e=>Math.abs(e)<n,c=()=>{i.positionQty=0,i.positionCost=0};if("BUY"===e.direction)if(i.positionQty<0){const e=Math.abs(i.positionQty),t=e>n?Number(i.positionCost)/e:0,o=Math.min(s,e),a=s-o;if(o>n){l(o,t,r,!1);const e=t*o;i.positionCost=Number(i.positionCost)-e,i.positionQty=Number(i.positionQty)+o}d(i.positionQty)&&a>n?(i.positionQty=a,i.positionCost=r*a):d(i.positionQty)&&c()}else i.positionCost=Number(i.positionCost)+r*s,i.positionQty=Number(i.positionQty)+s;if("SELL"===e.direction)if(i.positionQty>0){const e=i.positionQty,t=e>n?Number(i.positionCost)/e:0,o=Math.min(s,e),a=s-o;if(o>n){l(o,t,r,!0);const e=t*o;i.positionCost=Number(i.positionCost)-e,i.positionQty=Number(i.positionQty)-o}d(i.positionQty)&&a>n?(i.positionQty=-a,i.positionCost=r*a):d(i.positionQty)&&c()}else i.positionCost=Number(i.positionCost)+r*s,i.positionQty=Number(i.positionQty)-s});let s=null;if(t&&"ALL"!==t){const e=y(t);e&&(s=e.getTime())}const r=[];let a=0,l=0,d=0;Object.keys(o).forEach(e=>{const t=o[e],i=t.positionQty,c=Math.abs(i),p=c>n?Number(t.positionCost)/c:0;let x=0;t.trades.forEach(e=>{(!s||e.closeTime>=s)&&(x+=e.pnl,a+=e.pnl,e.pnl>0?(d++,l++):e.pnl<0&&l++)}),r.push({code:e,name:t.name,netQuantity:Math.round(i),avgCost:p,realizedPnl:x})});const c=l>0?(d/l*100).toFixed(2):0;return{byStock:r,totalRealizedPnl:Math.round(a),winRate:c,totalClosedTrades:l}})(e,d),[e,d]),$=e=>{const{name:t,value:i}=e.target;r(e=>({...e,[t]:i}))},G=e=>{r(t=>({...t,direction:e}))};return(0,U.jsxs)("div",{className:R,style:{maxWidth:"800px",margin:"20px auto",padding:"20px"},children:[(0,U.jsx)("h2",{children:a?"\u7de8\u8f2f\u4ea4\u6613\u8a18\u9304":"\u4ea4\u6613\u65e5\u8a8c\u8a18\u9304"}),(0,U.jsxs)("form",{onSubmit:t=>{t.preventDefault();const o=Number(i.quantity),s=Number(i.price);if(!i.code||!i.name||o<1||s<.1)return void alert("\u8acb\u586b\u5beb\u80a1\u7968\u540d\u7a31\u3001\u4ee3\u865f\uff0c\u4e26\u78ba\u4fdd\u6578\u91cf >= 1 \u4e14\u50f9\u683c >= 0.1\uff01");const d={...i,quantity:o,price:s};let c;if(a)c=e.map(e=>e.id===a?{...d,id:a}:e),l(null);else{c=[{...d,id:(0,n.A)(),timeId:Date.now()},...e]}K(c),r({id:"",code:"",name:"",direction:"BUY",quantity:"",price:"",date:(new Date).toISOString().substring(0,10),reason:""})},className:E,style:{marginBottom:"30px",border:`1px solid ${m}`,borderRadius:"5px",padding:"15px"},children:[(0,U.jsxs)("div",{className:A,style:{display:"flex",gap:"10px",marginBottom:"15px"},children:[(0,U.jsx)("input",{name:"name",value:i.name,onChange:$,placeholder:"\u80a1\u7968\u540d\u7a31 (e.g., \u53f0\u7a4d\u96fb)",required:!0,style:{flex:"1 1 auto",minWidth:"0",padding:"8px",border:"1px solid #a4a4a4ff"}}),(0,U.jsx)("input",{name:"code",value:i.code,onChange:$,placeholder:"\u4ee3\u865f (e.g., 2330)",required:!0,style:{flex:"1 1 auto",minWidth:"0",padding:"8px",border:"1px solid #a4a4a4ff"}}),(0,U.jsx)("input",{name:"quantity",type:"number",value:i.quantity,onChange:$,placeholder:"\u6578\u91cf (\u80a1)",required:!0,min:"1",step:"1",style:{flex:"1 1 auto",minWidth:"0",padding:"8px",border:"1px solid #a4a4a4ff"}}),(0,U.jsx)("input",{name:"price",type:"number",step:"0.1",value:i.price,onChange:$,placeholder:"\u50f9\u683c",required:!0,min:"0.1",style:{flex:"0 1 auto",padding:"8px",border:"1px solid #a4a4a4ff"}}),(0,U.jsx)("input",{name:"date",type:"date",value:i.date,onChange:$,required:!0,style:{flex:"3 0 auto",padding:"8px",border:"1px solid #a4a4a4ff"}})]}),(0,U.jsxs)("div",{style:{display:"flex",gap:"10px"},children:[(0,U.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:"5px"},children:[(0,U.jsx)("button",{type:"button",onClick:()=>G("BUY"),className:`${k} ${"BUY"===i.direction?_:""}`,style:{padding:"10px",color:"BUY"===i.direction?"white":"var(--ifm-color-primary)",border:"1px solid var(--ifm-color-primary)",cursor:"pointer",borderRadius:"3px",width:"120px",fontWeight:"bold",fontSize:"13px"},children:"\u8cb7\u5165 (BUY)"}),(0,U.jsx)("button",{type:"button",onClick:()=>G("SELL"),className:`${k} ${"SELL"===i.direction?B:""}`,style:{padding:"10px",color:"SELL"===i.direction?"white":"var(--ifm-color-primary)",border:"1px solid var(--ifm-color-primary)",cursor:"pointer",borderRadius:"3px",width:"120px",fontWeight:"bold",fontSize:"13px"},children:"\u8ce3\u51fa (SELL)"})]}),(0,U.jsx)("textarea",{name:"reason",value:i.reason,onChange:$,placeholder:"\u8f38\u5165\u4ea4\u6613\u7406\u7531\u6216\u7b56\u7565",rows:"6",style:{flexGrow:1,resize:"vertical",padding:"8px",border:"1px solid #a4a4a4ff",minHeight:"100px"}})]}),(0,U.jsxs)("div",{style:{marginTop:"15px",display:"flex",alignItems:"center",gap:"10px"},children:[(0,U.jsx)("button",{type:"submit",style:{padding:"10px 20px",backgroundColor:"var(--ifm-color-primary)",color:"white",border:"1px solid var(--ifm-color-primary)",cursor:"pointer",borderRadius:"3px",width:"120px",fontWeight:"bold",fontSize:"13px"},children:a?"\u66f4\u65b0\u8a18\u9304":"\u5132\u5b58\u4ea4\u6613\u8a18\u9304"}),a&&(0,U.jsx)("button",{type:"button",onClick:()=>{l(null),r({id:"",code:"",name:"",direction:"BUY",quantity:"",price:"",date:(new Date).toISOString().substring(0,10),reason:""})},style:{padding:"10px 20px",backgroundColor:"#6c757d",color:"white",border:"1px solid #6c757d",cursor:"pointer",borderRadius:"3px",width:"120px",fontWeight:"bold",fontSize:"13px"},children:"\u53d6\u6d88\u7de8\u8f2f"})]})]}),(()=>{const{byStock:e,totalRealizedPnl:t,winRate:i}=P,o=[...e.filter(e=>e.code.toLowerCase().includes(q.toLowerCase())||e.name.toLowerCase().includes(q.toLowerCase()))].sort((e,t)=>{const i=Math.abs(e.netQuantity*e.avgCost),o=Math.abs(t.netQuantity*t.avgCost);return o!==i?o-i:e.code.localeCompare(t.code)}),n={color:u(t),fontWeight:"bold"},s="ALL"===d?"\u5168\u90e8\u8a18\u9304":"\u7be9\u9078\u671f\u9593";return(0,U.jsxs)("div",{style:{marginTop:"30px",border:`1px solid ${m}`,borderRadius:"5px",padding:"15px"},children:[(0,U.jsxs)("div",{className:F,style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"15px"},children:[(0,U.jsxs)("h3",{style:{marginRight:"20px"},children:["\u5100\u8868\u677f\u8207\u640d\u76ca\u6458\u8981 (",s,")"]}),(0,U.jsxs)("div",{className:N,style:{display:"flex",gap:"10px"},children:[(0,U.jsx)("input",{type:"text",placeholder:"\u641c\u5c0b\u80a1\u7968\u4ee3\u865f/\u540d\u7a31",value:q,onChange:e=>H(e.target.value),className:S}),(0,U.jsxs)("select",{value:d,onChange:e=>c(e.target.value),style:{padding:"8px",border:"1px solid #eee",backgroundColor:"transparent",color:"inherit"},children:[(0,U.jsx)("option",{value:"ALL",children:"\u5168\u90e8"}),(0,U.jsx)("option",{value:"WEEK",children:"\u7576\u9031"}),(0,U.jsx)("option",{value:"MONTH",children:"\u7576\u6708"}),(0,U.jsx)("option",{value:"QUARTER",children:"\u8fd1\u4e00\u5b63"}),(0,U.jsx)("option",{value:"HALFYEAR",children:"\u8fd1\u534a\u5e74"}),(0,U.jsx)("option",{value:"YEAR",children:"\u8fd1\u4e00\u5e74"})]})]})]}),(0,U.jsxs)("div",{className:D,style:{display:"flex",gap:"15px",marginBottom:"15px"},children:[(0,U.jsxs)("div",{className:T,style:{flex:1,padding:"12px",border:"1px solid #ccc",borderRadius:"5px"},children:[(0,U.jsx)("h4",{style:{margin:"0 0 5px 0"},children:"\u7e3d\u5df2\u5be6\u73fe\u640d\u76ca"}),(0,U.jsx)("p",{style:{margin:0,fontSize:"1.5em",...n},children:g(t)})]}),(0,U.jsxs)("div",{className:T,style:{flex:1,padding:"15px",border:"1px solid #ccc",borderRadius:"5px"},children:[(0,U.jsx)("h4",{style:{margin:"0 0 5px 0"},children:"\u4ea4\u6613\u52dd\u7387"}),(0,U.jsxs)("p",{style:{margin:0,fontSize:"1.5em"},children:[i,"%"]})]})]}),(0,U.jsx)("h4",{style:{marginTop:"20px"},children:"\u500b\u80a1\u640d\u76ca\u8207\u6301\u5009 (\u6309\u6301\u5009\u91d1\u984d\u6392\u5e8f)"}),(0,U.jsx)("div",{style:{overflowX:"auto"},children:(0,U.jsxs)("table",{style:{width:"100%",borderCollapse:"collapse",textAlign:"left",fontSize:"0.9rem",minWidth:"400px"},children:[(0,U.jsx)("thead",{children:(0,U.jsxs)("tr",{style:{borderBottom:"1px solid #333"},children:[(0,U.jsx)("th",{style:{padding:"8px"},children:"\u80a1\u7968\u540d\u7a31/\u4ee3\u865f"}),(0,U.jsx)("th",{style:{padding:"8px"},children:"\u5e73\u5747\u6210\u672c"}),(0,U.jsx)("th",{style:{padding:"8px"},children:"\u6301\u5009\u91d1\u984d"}),(0,U.jsx)("th",{style:{padding:"8px"},children:"\u5df2\u5be6\u73fe\u640d\u76ca"})]})}),(0,U.jsx)("tbody",{children:0===o.length?(0,U.jsx)("tr",{children:(0,U.jsx)("td",{colSpan:"4",style:{padding:"10px",textAlign:"center"},children:"\u7121\u5339\u914d\u6578\u64da"})}):o.map(e=>{const t=0!==e.netQuantity?e.avgCost:0,i=Math.round(e.netQuantity*e.avgCost);return(0,U.jsxs)("tr",{style:{borderBottom:"1px solid #eee"},children:[(0,U.jsxs)("td",{style:{padding:"8px",fontWeight:"bold"},children:[e.name," (",e.code,")"]}),(0,U.jsx)("td",{style:{padding:"8px"},children:h(t)}),(0,U.jsx)("td",{className:L,style:{padding:"8px",fontWeight:"bold"},children:0!==i?`${Math.abs(i).toLocaleString()}`:"--"}),(0,U.jsx)("td",{style:{padding:"8px",color:u(e.realizedPnl)},children:g(e.realizedPnl)})]},e.code)})})]})})]})})(),(()=>{const t=O,i={padding:"5px 10px",backgroundColor:"white",color:"var(--ifm-color-primary)",border:"1px solid var(--ifm-color-primary)",cursor:"pointer",borderRadius:"3px"},o={...i,color:"red",borderColor:"red"},n={...i,color:"orange",borderColor:"orange"};return(0,U.jsxs)("div",{style:{marginTop:"30px",border:`1px solid ${m}`,borderRadius:"5px",padding:"15px",width:"100%",minWidth:"100%",flex:"1 0 auto",boxSizing:"border-box",minHeight:"450px"},children:[(0,U.jsxs)("div",{className:Q,style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"15px"},children:[(0,U.jsxs)("h3",{style:{minWidth:"220px",margin:0},children:["\u6b77\u53f2\u4ea4\u6613\u8a18\u9304 (",t.length," \u7b46)"]}),(0,U.jsxs)("div",{className:M,style:{display:"flex",gap:"10px"},children:[(0,U.jsx)("input",{type:"text",placeholder:"\u641c\u5c0b\u80a1\u7968\u4ee3\u865f/\u540d\u7a31",value:Y,onChange:e=>z(e.target.value),className:S}),(0,U.jsxs)("select",{value:x,onChange:e=>W(e.target.value),style:{padding:"8px",border:"1px solid #ccc"},children:[(0,U.jsx)("option",{value:"ALL",children:"\u5168\u90e8\u6642\u9593"}),(0,U.jsx)("option",{value:"WEEK",children:"\u7576\u9031"}),(0,U.jsx)("option",{value:"MONTH",children:"\u7576\u6708"}),(0,U.jsx)("option",{value:"QUARTER",children:"\u8fd1\u4e00\u5b63"}),(0,U.jsx)("option",{value:"HALFYEAR",children:"\u8fd1\u534a\u5e74"}),(0,U.jsx)("option",{value:"YEAR",children:"\u8fd1\u4e00\u5e74"})]})]})]}),0===t.length?(0,U.jsx)("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",width:"100%",padding:"80px 0",flex:"1 1 100%"},children:(0,U.jsx)("p",{style:{margin:0,color:"#888",fontSize:"1.1rem"},children:"\u5728\u9078\u5b9a\u7684\u7be9\u9078\u689d\u4ef6\u4e0b\u6c92\u6709\u4ea4\u6613\u8a18\u9304\u3002"})}):(0,U.jsx)("ul",{style:{listStyleType:"none",padding:0},children:t.map(t=>{return(0,U.jsxs)("li",{className:v,style:{border:"1px solid #ccc",padding:"10px",marginBottom:"10px",borderRadius:"5px"},children:[(0,U.jsxs)("div",{className:b,children:[(0,U.jsx)("div",{className:f,children:(0,U.jsxs)("strong",{children:["[",t.date,"] ",t.name," (",t.code,")"]})}),(0,U.jsx)("div",{className:j,children:(0,U.jsxs)("span",{className:I,children:[(0,U.jsx)("span",{style:{color:"BUY"===t.direction?"red":"green",fontWeight:"bold"},children:t.direction}),":",(i=t.quantity,null==i||isNaN(i)?"0":Math.round(i).toLocaleString("en-US",{minimumFractionDigits:0,maximumFractionDigits:0}))," \u80a1 @ ",h(t.price)]})})]}),(0,U.jsxs)("p",{className:w,style:{paddingLeft:"10px",borderLeft:"3px solid #ccc",fontSize:"0.9em"},children:["\u4ea4\u6613\u7406\u7531: ",t.reason||"\u7121\u5099\u8a3b"]}),(0,U.jsxs)("div",{className:C,children:[(0,U.jsx)("button",{onClick:()=>(e=>{r({...e,quantity:String(e.quantity),price:String(e.price)}),l(e.id)})(t),style:n,children:"\u7de8\u8f2f"}),(0,U.jsx)("button",{onClick:()=>(t=>{if(window.confirm("\u78ba\u5b9a\u8981\u522a\u9664\u9019\u7b46\u4ea4\u6613\u8a18\u9304\u55ce\uff1f")){const i=e.filter(e=>e.id!==t);K(i)}})(t.id),style:o,children:"\u522a\u9664"})]})]},t.id);var i})})]})})()]})}},4031:(e,t,i)=>{i.r(t),i.d(t,{default:()=>r});i(6540);var o=i(1656),n=i(8478),s=i(4848);function r(){return(0,s.jsx)(o.A,{title:"\u4ea4\u6613\u65e5\u8a8c",description:"\u8de8\u88dd\u7f6e\u540c\u6b65\u7684\u500b\u4eba\u4ea4\u6613\u65e5\u8a8c",children:(0,s.jsx)(n.A,{fallback:(0,s.jsx)("div",{children:"\u8f09\u5165\u500b\u4eba\u4ea4\u6613\u65e5\u8a8c\u4e2d..."}),children:()=>{const e=i(509).A;return(0,s.jsx)(e,{})}})})}}}]);